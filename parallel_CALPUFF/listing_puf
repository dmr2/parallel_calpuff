c----------------------------------------------------------------------
c --- COMMON BLOCK /AMBIENT/ -- Selected met. data at one       CALPUFF
c                               grid cell;  used in numerical
c                               plume rise computation
c----------------------------------------------------------------------
c
      common/AMBIENT/nza,nzap1,zfacea(mxprfp1),zgpta(mxprfz),
     1 uamb(mxprfz),ramb(mxprfz),dedz(mxprfp1),tamb(mxprfz),
     1 tamb0,ramb0,adia,ptgrad0
c
c --- COMMON BLOCK /AMBIENT/ Variables:
c
c                    NZA - integer - Number of layers
c                  NZAP1 - integer - Number of layers
c        ZFACEA(mxprfp1) - real    - Heights (m) of cell faces
c          ZGPTA(mxprfz) - real    - Heights (m) of grid points
c                                    (cell centers)
c           UAMB(mxprfz) - real    - Wind speed profile (m/s) - winds
c                                    defined at cell CENTERS
c           RAMB(mxprfz) - real    - Ambient air density profile
c                                    (kg/m^3) - defined at cell CENTERS
c          DEDZ(mxprfp1) - real    - Pot. temperature gradient profile
c                                    (K/m) - defined at cell FACES
c           TAMB(mxprfz) - real    - Temperature profile (K) - defined
c                                    at cell CENTERS
c                  TAMB0 - real    - Surface air temperature (K)
c                  RAMB0 - real    - Surface air density (kg/m^3)
c                   ADIA - real    - Dry adiabatic lapse rate (deg. K/m)
c                PTGRAD0 - real    - Minimum potential temperature lapse
c                                    rate (deg. K/m)
c----------------------------------------------------------------------
c --- COMMON BLOCK /AR1/ -- Constant Area source data           CALPUFF
c
c----------------------------------------------------------------------
      character*16 cnamar1
c
      common/AR1/XAR1GRD(mxvertp1,mxarea),YAR1GRD(mxvertp1,mxarea),
     1 NVERT1(mxarea),HTAR1(mxarea),ELAR1(mxarea),SZ0AR1(mxarea),
     2 QAR1(mxspec,mxarea),NEWAR1(mxarea),NAR1,AREA1(mxarea),
     3 IARU,ivar1(mxspec,mxarea),iq12ar1(mxspec,mxarea),
     4 cnamar1(mxarea)
c
c --- COMMON BLOCK /AR1/ Variables:
c
c *************  Discrete area source data ***************************
c
c XAR1GRD(mxvertp1,mxarea) - real     - X coordinate of a vertex of a
c                                       discrete area source in grid units
c                                       (i.e., origin at (0.0,0.0))
c YAR1GRD(mxvertp1,mxarea) - real     - Y coordinate of a vertex of a
c                                       discrete area source in grid units
c                                       (i.e., origin at (0.0,0.0))
c           NVERT1(mxarea) - real     - Number of sides bounding area
c
c (NOTE:  The mean x,y for the polygon is computed as vertex NVERT+1)
c
c            HTAR1(mxarea) - real     - Effective release height (m)
c            ELAR1(mxarea) - real     - Ground elevation (m) above sea
c                                       level
c           SZ0AR1(mxarea) - real     - Initial sigma z (m)
c
c (NOTE:  The initial sigma-y is computed as function of wind direction)
c
c      QAR1(mxspec,mxarea) - real     - Emission rate (g/s) for each
c                                       pollutant
c           NEWAR1(mxarea) - integer  - Number of puffs released by each
c                                       source during the current step
c                     NAR1 - integer  - Number of discrete area sources
c            AREA1(mxarea) - real     - Area of each source (m^2)
c                     IARU - integer  - Units for emission rates in
c                                       control file
c                                       1:   g/s/m**2
c                                       2:  kg/hr/m**2
c                                       3:  lb/hr/m**2
c                                       4:  ton/yr/m**2
c                                       5:  Odour Unit * m/s
c                                       6:  Odour Unit * m/min
c     IVAR1(mxspec,mxarea) - integer  - IVARY flag defining how emission
c                                       rate scaling factors vary
c                                       0:  NO variation
c                                       1:  Diurnal (24 values)
c                                       2:  Monthly (12 values)
c                                       3:  Hour & Season (96 values)
c                                       4:  Speed & Stability (36 values)
c                                       5:  Temperature (12 values)
c   IQ12AR1(mxspec,mxarea) - integer  - Pointer for starting address in
c                                       VQFAC array to assign scaling
c                                       factors for this source/species
c          CNAMAR1(mxarea) - c*16 arr - Source names
c----------------------------------------------------------------------
c --- COMMON BLOCK /AR2/ -- Variable Area source data           CALPUFF
c
c----------------------------------------------------------------------
c
      character*12 fname3,label3,cslst3
      character*16 cid3,baemunit
c
      common/AR2/NAR2,IUTMZ3,NSE3,
     1           XNLAT1AR2,XNLAT2AR2,RNLAT0AR2,RWLON0AR2,
     2           IVRS3(mxemdat),IBSRC3(mxemdat),IESRC3(mxemdat),
     3           IBDAT3(mxemdat),IBTIM3(mxemdat),IEDAT3(mxemdat),
     4           IETIM3(mxemdat),XMWEM3(mxspec),IXREM3(mxspec),
     5           IBEG3(mxemdat),IEND3(mxemdat),
     6           XAR2GRD(mxvertp1,mxarea),YAR2GRD(mxvertp1,mxarea),
     7           NVERT2(mxarea),HTAR2(mxarea),TKAR2(mxarea),
     8           ELAR2(mxarea),WEFAR2(mxarea),REFAR2(mxarea),
     9           SZ0AR2(mxarea),AREA2(mxarea),QAR2(mxspec,mxarea),
     &           NEWAR2(mxarea),NTR,XTR(mxrise,mxarea),
     1           ZTR(mxrise,mxarea),RTR(mxrise,mxarea),
     2           FNAME3,LABEL3(mxemdat),CSLST3(mxspec),
     3           CID3(mxarea),BAEMUNIT(mxarea)
c
c --- COMMON BLOCK /AR2/ Variables:
c
c             NAR2 - integer  - Number of discrete area sources
c           IUTMZ3 - integer  - UTM zone for coordinates
c             NSE3 - integer  - Number of emitted species in file
c        XNLAT1AR2 - real     - Standard parallel #1 for LC map
c                               projection (degrees N. Latitude)
c        XNLAT2AR2 - real     - Standard parallel #1 for LC map
c                               projection (degrees N. Latitude)
c        RNLAT0AR2 - real     - N. Latitude of origin of LC map
c                               projection (degrees)
c        RWLON0AR2 - real     - W. Longitude of origin of LC map
c                               projection (degrees)
c   IVRS3(mxemdat) - integer  - Data set version expressed as integer
c                               (5.4 is 54)
c  IBSRC3(mxemdat) - integer  - Index for first source in a
c                               BAEMARB.DAT file
c  IESRC3(mxemdat) - integer  - Index for last source in a
c                               BAEMARB.DAT file
c  IBDAT3(mxemdat) - integer  - Date of the first data record in the
c                               file  (YYYYJJJ, where YYYY=year,
c                               JJJ=Julian day)
c  IBTIM3(mxemdat) - integer  - Hour of the first data record in the
c                               file  (00-23 LST)
c  IEDAT3(mxemdat) - integer  - Date of the last data record in the
c                               file  (YYYYJJJ, where YYYY=year,
c                               JJJ=Julian day)
c  IETIM3(mxemdat) - integer  - Hour of the last data record in the
c                               file  (00-23 LST)
c   XMWEM3(mxspec) - real     - Molecular weight for each species
c   IXREM3(mxspec) - integer  - Cross referencing array of NSE3
c                               values relating species ordering
c                               in the emissions file to the
c                               ordering in the main conc. array
c
c ---  Variable data  ---
c
c  IBEG3(mxemdat) - integer  - Starting time for which emissions
c                               data in current set of
c                               records is valid (YYYYJJJHH)
c  IEND3(mxemdat) - integer  - Ending time for which emissions
c                               data in current set of
c                               records is valid (YYYYJJJHH)
c XAR2GRD(mxvertp1,mxarea) - real - X coordinate of a vertex of a
c                                   discrete area source in grid units
c                                   (i.e., origin at (0.0,0.0))
c YAR2GRD(mxvertp1,mxarea) - real - Y coordinate of a vertex of a
c                                   discrete area source in grid units
c                                   (i.e., origin at (0.0,0.0))
c   NVERT2(mxarea) - real     - Number of sides bounding area
c
c (NOTE:  The mean x,y for the polygon is computed as vertex NVERT+1)
c
c    HTAR2(mxarea) - real     - Effective release height (m)
c    TKAR2(mxarea) - real     - Temperature of release (K)
c    ELAR2(mxarea) - real     - Elevation of ground (m)
c   WEFAR2(mxarea) - real     - Effective rise velocity (m/s)
c   REFAR2(mxarea) - real     - Effective radius of source (m)
c   SZ0AR2(mxarea) - real     - Initial sigma-z of source (m)
c    AREA2(mxarea) - real     - Area of each source (m^2)
c
c (NOTE:  The initial sigma-y is computed as function of wind direction)
c
c QAR2(mxspec,mxarea) - real  - Emission rate (g/s) for each
c                                  pollutant
c   NEWAR2(mxarea) - integer  - Number of puffs released by each
c                               source during the current step
c
c
c ---  Numerical Plume Rise Data ---
c
c                NTR - integer  - Number of points in trajectory arrays
c XTR(mxrise,mxarea) - real     - Downwind distance (m) for trajectory
c ZTR(mxrise,mxarea) - real     - Height above ground (m) for trajectory
c RTR(mxrise,mxarea) - real     - Plume radius (m)
c
c ---  Character data ---
c           FNAME3 - char*12    - Data set name "BAEMARB"
c  LABEL3(mxemdat) - char*12    - Data set label
c   CSLST3(mxspec) - char*12    - Species identifiers
c     CID3(mxarea) - char*16    - Source identifiers
c BAEMUNIT(mxarea) - char*16    - Emissions units for each source
c                                 ('g/m2/s'  OR  'g/s')
c----------------------------------------------------------------------
c --- COMMON BLOCK /BCS/ -- Data for boundary condition         CALPUFF
c                           sources
c----------------------------------------------------------------------
c
      character*12 cnamtyp,fnamebc,lblbc,cspecbc,cunitsbc

      common/BCS/VRSBC,NSPECBC,NTYPEBC1,NTYPEBC2,XLENBC,YLENBC,
     1 IBCU,FUNITSBC(4),NBC,HTMINBC,RSAMPBC,CONBC0,
     2 XBCGRD(mxbc),YBCGRD(mxbc),ITYPEBC(mxbc),
     2 IBC(mxbc),NEWBC(mxbc),IRECBC(mxbc),JRECBC(mxbc),D2RECBC(mxbc),
     3 HTBC(mxbc),CONBC(mxspec,mxbc),
     4 XMWTBC(mxspec),IXREMBC(mxspec),
     5 ivbc(mxspec,mxbc),iq12bc(mxspec,mxbc),
     6 IBYDBC,IBHBC,IEYDBC,IEHBC,IBEGBC,IENDBC,
     7 FNAMEBC,LBLBC,CNAMTYP(mxbc),CSPECBC(mxspec),CUNITSBC(4)
c
c --- COMMON BLOCK /BCS/ Variables:
c
c                 VRSBC - real     - Data set version
c               NSPECBC - integer  - Number of species in BCON file
c              NTYPEBC1 - integer  - Number of air mass types defined
c                                    (constant or factored variation)
c              NTYPEBC2 - integer  - Number of air mass types defined
c                                    (arbitrary time variation)
c                XLENBC - real     - Length of each segment along X (m)
c                YLENBC - real     - Length of each segment along Y (m)
c                  IBCU - integer  - Units for boundary concentrations
c                                    1:  g/m**3
c                                    2:  ug/m**3
c                                    3:  ppm
c                                    4:  ppb
c           FUNITSBC(4) - real     - Units conversion factor to g/m**3
c                   NBC - integer  - Number of boundary condition
c                                    segments
c               HTMINBC - real     - Minimum layer depth (m) for BC
c                                    puffs when released (MBCON=2)
c               RSAMPBC - real     - Search radius (km) for sampling
c                                    BC puffs
c                CONBC0 - real     - Concentration (g/m3) of species
c                                    'BCON' imposed on all BC puffs
c                                    emitted (always generate active
c                                    BC puffs even when boundary air is
c                                    clean)
c
c -------- Section for data for each boundary segment ---------
c
c          XBCGRD(mxbc) - real     - X coordinate of each segment (met.
c                                    grid units w/ origin at (0.0,0.0))
c          YBCGRD(mxbc) - real     - Y coordinate of each segment (met.
c                                    grid units w/ origin at (0.0,0.0))
c         ITYPEBC(mxbc) - integer  - Type of air mass associated with
c                                    each segment
c             IBC(mxbc) - integer  - Boundary on which each segment is
c                                    located
c                                    1 = North
c                                    2 = South
c                                    3 = East
c                                    4 = West
c           NEWBC(mxbc) - integer  - Number of puffs released by each
c                                    segment during current time step
c
c -------- Section for MBCON=2 identifying CONC.DAT receptors ---------
c
c          IRECBC(mxbc) - integer  - receptor 'i' used for each segment
c          JRECBC(mxbc) - integer  - receptor 'j' used for each segment
c                                    (j=0 for discrete receptors)
c         D2RECBC(mxbc) - real     - squared distance from segment to
c                                    receptor (met grid units)
c
c -------- Section for data for each air-mass type and species ---------
c
c            HTBC(mxbc) - real     - 'Top' of air mass layer (m)
c    CONBC(mxspec,mxbc) - real     - Concentration of each modeled species
c                                    in air mass (g/m**3)
c        XMWTBC(mxspec) - real     - Molecular weight for each species
c       IXREMBC(mxspec) - integer  - Cross referencing array of NSPECBC
c                                    values relating species ordering
c                                    in the BCON file to the
c                                    ordering in the main conc. array
c     IVBC(mxspec,mxbc) - integer  - IVARY flag defining how air mass
c                                    concentration scaling factors vary
c                                    0:  NO variation
c                                    1:  Diurnal (24 values)
c                                    2:  Monthly (12 values)
c                                    3:  Hour & Season (96 values)
c                                    4:  Speed & Stability (36 values)
c                                    5:  Temperature (12 values)
c   IQ12BC(mxspec,mxbc) - integer  - Pointer for starting address in
c                                    VQFAC array to assign scaling
c                                    factors for this air mass/species
c
c -------- Section for date/time information in BCON file ---------
c
c                IBYDBC - integer  - Date of the first data record in
c                                    file  (YYYYJJJ, where YYYY=year,
c                                    JJJ=Julian day)
c                 IBHBC - integer  - Hour of the first data record in
c                                    file  (00-23 LST)
c                IEYDBC - integer  - Date of the last data record in
c                                    file  (YYYYJJJ, where YYYY=year,
c                                    JJJ=Julian day)
c                 IEHBC - integer  - Hour of the last data record in
c                                    file  (00-23 LST)
c                IBEGBC - integer  - Starting time for which emissions
c                                    data in current set of
c                                    records is valid (YYYYJJJHH)
c                IENDBC - integer  - Ending time for which emissions
c                                    data in current set of
c                                    records is valid (YYYYJJJHH)
c
c -------- Section for character data -----------
c
c               FNAMEBC - char*12  - Data set name "BCON"
c                 LBLBC - char*12  - Data set label
c         CNAMTYP(mxbc) - char*12  - Air-mass names
c       CSPECBC(mxspec) - char*12  - Species identifiers
c           CUNITSBC(4) - char*12  - Species concentration units
c
c----------------------------------------------------------------------
c --- COMMON BLOCK /CHEMDAT/ -- Chemistry data                  CALPUFF
c
c----------------------------------------------------------------------
c
      character*12 vrsoz,laboz,vrsh2o2,labh2o2
      character*12 ch2o2
      character*16 cidoz,cidh2o2
c
      common/CHEMDAT/MOZ,BCKO3,BCKO3M(12),BCKNH3,BCKNH3M(12),
     1 RNITE1,RNITE2,RNITE3,MH2O2,BCKH2O2,BCKH2O2M(12),
     2 BCKPMF(12),OFRAC(12),VCNX(12),
     3 CHEMT(24,3),NOZSTA,IUTMOZ,IBDATO,IBTIMO,IEDATO,IETIMO,VRSOZ,
     4 LABOZ,CIDOZ(mxoz),XOZM(mxoz),YOZM(mxoz),OZCONC(mxoz),
     5 NEAROZ(mxnx,mxny),ITIMOZ,
     6 NH2O2STA,IUTMH2O2,IBDATH,IBTIMH,IEDATH,IETIMH,VRSH2O2,
     7 LABH2O2,CIDH2O2(mxaq),XH2O2M(mxaq),YH2O2M(mxaq),
     8 H2O2CONC(mxaq),NEARH2O2(mxnx,mxny),CH2O2(2)
c
c --- COMMON BLOCK /CHEMDAT/ Variables:
c
c             MOZ - integer - Ozone data input flag
c                              (0 = use a monthly background O3 value)
c                               1 = read hourly O3 data)
c           BCKO3 - real    - Current background ozone conc (ppb)
c      BCKO3M(12) - real    - Monthly background ozone concs (ppb)
c          BCKNH3 - real    - Current background ammonia conc (ppb)
c     BCKNH3M(12) - real    - Monthly background ammonia concs (ppb)
c          RNITE1 - real    - Nighttime SO2 loss rate (percent/hr)
c          RNITE2 - real    - Nighttime NOx loss rate (percent/hr)
c          RNITE3 - real    - Nighttime HNO3 formation rate (percent/hr)
c           MH2O2 - integer - H2O2 data input flag
c                              (0 = use constant background H2O2 value)
c                               1 = read hourly H2O2 data)
c         BCKH2O2 - real    - Current background H2O2 conc (ppb)
c    BCKH2O2M(12) - real    - Monthly background H2O2 concs (ppb)
c     CHEMT(24,3) - real    - User-specified chemical transformation
c                             rates (percent/hr)
c                             (-,1) -- (k1)  SO2 --> SO4
c                             (-,2) -- (k2)  NOx --> All products
c                             (-,3) -- (k3)  NOx --> HNO3
c
c --- SOA (MCHEM=4) monthly background data
c      BCKPMF(12) - real    - Fine particulate concentration in ug/m^3
c       OFRAC(12) - real    - Organic fraction of fine particulates
c        VCNX(12) - real    - VOC / NOX ratio (after reaction)
c
c --- Data from OZONE.DAT data file
c ----------------------------------
c          NOZSTA - integer - Number of ozone stations in the OZONE.DAT
c                             file
c          IUTMOZ - integer - UTM zone in which the sozone station
c                             coordinates are specified
c          IBDATO - integer - Date of beginning of data (YYJJJ, where
c                             YY=year, JJJ=Julian day)
c          IBTIMO - integer - Hour of beginning of data (00-23, LST)
c          IEDATO - integer - Date of ending of data (YYJJJ, where
c                             YY=year, JJJ=Julian day)
c          IETIMO - integer - Hour of ending of data (00-23, LST)
c           VRSOZ - C*12    - Data set version
c           LABOZ - C*12    - Data set label
c     CIDOZ(mxoz) - C*16    - Station identifier
c      XOZM(mxoz) - real    - X coordinate (m) of the ozone station
c                             relative to the origin of the met. grid
c      YOZM(mxoz) - real    - Y coordinate (m) of the ozone station
c                             relative to the origin of the met. grid
c    OZCONC(mxoz) - real    - Ozone concentration (ppb) at each station
c
c --- Computed from data in OZONE.DAT
c NEAROZ(mxnx,mxny)-real    - Station number of closest ozone station to
c                             each grid point
c          ITIMOZ - integer - Flag for format of times in file
c                             1: End time as year, Julian day, hour
c                             2: Begin & End times as year, Julian
c                                day, hour and second (0-3599)
c
c --- Data from H2O2.DAT data file
c ----------------------------------
c        NH2O2STA - integer - Number of H2O2 stations in the H2O2.DAT
c                             file
c        IUTMH2O2 - integer - UTM zone in which the H2O2 station
c                             coordinates are specified
c          IBDATH - integer - Date of beginning of data (YYJJJ, where
c                             YY=year, JJJ=Julian day)
c          IBTIMH - integer - Hour of beginning of data (00-23, LST)
c          IEDATH - integer - Date of ending of data (YYJJJ, where
c                             YY=year, JJJ=Julian day)
c          IETIMH - integer - Hour of ending of data (00-23, LST)
c         VRSH2O2 - C*12    - Data set version
c         LABH2O2 - C*12    - Data set label
c   CIDH2O2(mxaq) - C*16    - Station identifier
c    XH2O2M(mxaq) - real    - X coordinate (m) of the H2O2 station
c                             relative to the origin of the met. grid
c    YH2O2M(mxaq) - real    - Y coordinate (m) of the H2O2 station
c                             relative to the origin of the met. grid
c  H2O2CONC(mxaq) - real    - H2O2 concentration (ppb) at each station
c        CH2O2(2) - C*12    - Data type name ('H2O2','h2o2')
c
c --- Computed from data in H2O2.DAT
cNEARH2O2(mxnx,mxny)-real   - Station number of closest H2O2 station
c                             to each grid point
c----------------------------------------------------------------------
c --- COMMON BLOCK /CHIFLX/ -- Concentration & flux arrays      CALPUFF
c----------------------------------------------------------------------
c
      common/CHIFLX/chisam(mxnxg,mxnyg,mxspec),chirec(mxrec,mxspec),
     1 chict(mxrect,mxspec),
     2 dfsam(mxnxg,mxnyg,mxspec),dfrec(mxrec,mxspec),
     3 wfsam(mxnxg,mxnyg,mxspec),wfrec(mxrec,mxspec),
     4 tchisam(mxnxg,mxnyg,mxspec),tchirec(mxrec,mxspec),
     5 tchict(mxrect,mxspec),
     6 tdfsam(mxnxg,mxnyg,mxspec),tdfrec(mxrec,mxspec),
     7 twfsam(mxnxg,mxnyg,mxspec),twfrec(mxrec,mxspec),
     8 cbcsam(mxnxg,mxnyg,mxspec),cbcrec(mxrec,mxspec),
     9 cbcct(mxrect,mxspec),
     & dbcsam(mxnxg,mxnyg,mxspec),dbcrec(mxrec,mxspec),
     1 wbcsam(mxnxg,mxnyg,mxspec),wbcrec(mxrec,mxspec),
     2 rbcsam(mxnxg,mxnyg),rbcrec(mxrec),rbcct(mxrect)
c
c --- COMMON BLOCK /CHIFLX/ Variables:
c
c     CHISAM(mxnxg,mxnyg,mxspec) - real   - Concentrations (g/m**3) at
c                                           gridded receptors
c           CHIREC(mxrec,mxspec) - real   - Concentrations (g/m**3) at
c                                           non-gridded receptors
c           CHICT(mxrect,mxspec) - real   - Concentrations (g/m**3) at
c                                           complex terrain (CTSG)
c                                           receptors
c
c      DFSAM(mxnxg,mxnyg,mxspec) - real   - Dry fluxes (g/m**2/s) at
c                                           gridded receptors
c            DFREC(mxrec,mxspec) - real   - Dry fluxes (g/m**2/s) at
c                                           non-gridded receptors
c
c      WFSAM(mxnxg,mxnyg,mxspec) - real   - Wet fluxes (g/m**2/s) at
c                                           gridded receptors
c            WFREC(mxrec,mxspec) - real   - Wet fluxes (g/m**2/s) at
c                                           non-gridded receptors
c
c --- Additional arrays to hold total contribution from all sources
c
c    TCHISAM(mxnxg,mxnyg,mxspec) - real   - Concentrations (g/m**3) at
c                                           gridded receptors
c          TCHIREC(mxrec,mxspec) - real   - Concentrations (g/m**3) at
c                                           non-gridded receptors
c          TCHICT(mxrect,mxspec) - real   - Concentrations (g/m**3) at
c                                           complex terrain (CTSG)
c                                           receptors
c
c     TDFSAM(mxnxg,mxnyg,mxspec) - real   - Dry fluxes (g/m**2/s) at
c                                           gridded receptors
c           TDFREC(mxrec,mxspec) - real   - Dry fluxes (g/m**2/s) at
c                                           non-gridded receptors
c
c     TWFSAM(mxnxg,mxnyg,mxspec) - real   - Wet fluxes (g/m**2/s) at
c                                           gridded receptors
c           TWFREC(mxrec,mxspec) - real   - Wet fluxes (g/m**2/s) at
c                                           non-gridded receptors
c
c --- Additional arrays to hold contribution from BC puff
c
c     CBCSAM(mxnxg,mxnyg,mxspec) - real   - Concentrations (g/m**3) at
c                                           gridded receptors
c           CBCREC(mxrec,mxspec) - real   - Concentrations (g/m**3) at
c                                           non-gridded receptors
c           CBCCT(mxrect,mxspec) - real   - Concentrations (g/m**3) at
c                                           complex terrain (CTSG)
c                                           receptors
c
c     DBCSAM(mxnxg,mxnyg,mxspec) - real   - Dry fluxes (g/m**2/s) at
c                                           gridded receptors
c           DBCREC(mxrec,mxspec) - real   - Dry fluxes (g/m**2/s) at
c                                           non-gridded receptors
c
c     WBCSAM(mxnxg,mxnyg,mxspec) - real   - Wet fluxes (g/m**2/s) at
c                                           gridded receptors
c           WBCREC(mxrec,mxspec) - real   - Wet fluxes (g/m**2/s) at
c                                           non-gridded receptors
c            RBCSAM(mxnxg,mxnyg) - real   - Nearest approach distance of
c                                           a BC puff to each gridded
c                                           receptor (grid cell units)
c                  RBCREC(mxrec) - real   - Nearest approach distance of
c                                           a BC puff to each discrete
c                                           receptor (grid cell units)
c                  RBCCT(mxrect) - real   - Nearest approach distance of
c                                           a BC puff to each  complex
c                                           terrain (CTSG) receptor
c                                           (grid cell units)
c
c----------------------------------------------------------------------
c --- COMMON BLOCK /COASTLN/ -- User-Supplied Coast Line Data   CALPUFF
c----------------------------------------------------------------------
c
      logical*1 lcoast(mxnx,mxny)
      common/COASTLN/ncoast,npcoast(2,mxcoast),coastgrd(2,mxptcst),
     &               ymxpb(2,mxptcst),lwcell(2,mxptcst),lcoast
c
c --- COMMON BLOCK /COASTLN/ Variables:
c
c               NCOAST - integer - Number of coasts defined
c   NPCOAST(2,mxcoast) - integer - Pointer to locations in COASTGRD
c                                  array containing data for each coast
c                                  where element 1 is the start and
c                                  element 2 is the end
c  COASTGRD(2,mxptcst) - real    - x,y coordinates (MET GRID UNITS) of
c                                  points along each coast line, where                                  
c                                  element 1 is x, element 2 is y
c     YMXPB(2,mxptcst) - real    - slope 'm' and intercept 'b' for line
c                                  defined by each coastline segment
c                                  element 1 is 'm', element 2 is 'b'
c    LWCELL(2,mxptcst) - integer - Cell index for nearest land cell and
c                                  and water cell to each point in
c                                  coast line, where element 1 is LAND,
c                                  and element 2 is WATER
c    LCOAST(mxnx,mxny) - logical - Logical marker indicating if a MET
c                                  GRID cell contains a coastline
c----------------------------------------------------------------------
c NOTE:1.More than 1 coast can be defined, but all are appended in the
c        COASTGRD array.  The NPCOAST provides the index for the start
c        and the end of each coast line.  Also, the ordering of the
c        points follows the convention that the water is to the RIGHT
c        of the line traced out by these points.
c      2.Cell index pointer LWCELL assumes that the nx*ny possible
c        locations correspond to 1D list in which ny rows of nx values
c        each are appended, where the first nx values are for iy=1.c----------------------------------------------------------------------
c --- COMMON BLOCK /COMPARM/ -- Computational variables         CALPUFF
c----------------------------------------------------------------------
c
      real wscat(5),plx0(6),ptg0(2),ppc(6),vqfac(12,mxq12)
      real svmin(6,2),swmin(6,2),cdiv(2),tibldist(3)
      real cnsplith(mxspec)
      integer iresplit(24),iqnum(5),iqnext
      logical lage
      common/COMPARM/xmxlen,mxnew,xsamlen,mxsam,ncount,sl2pf,cdiv,
     1               wscalm,wscat,vqfac,iqnum,iqnext,
     2               svmin,swmin,symin,szmin,xminzi,xmaxzi,
     3               plx0,ptg0,ppc,tbd,tibldist,
     4               nsplit,iresplit,zisplit,roldmax,
     5               nsplith,sysplith,cnsplith,shsplith,
     6               epsslug,epsarea,dsrise,trajincl,
     7               mxagehr,tsecmax,lage
c
c --- COMMON BLOCK /COMPARM/ Variables:
c           XMXLEN - real    - Maximum length of a newly-released slug/
c                              puff (in grid cells).  Used to determine
c                              the puff release rate.
c            MXNEW - integer - Maximum number of puffs that can be
c                              released from a single source during one
c                              time step.
c          XSAMLEN - real    - Maximum travel distance of a puff/slug
c                              (in grid cells) during one sampling step
c            MXSAM - integer - Maximum number of sampling steps per
c                              time step
c           NCOUNT - integer - Number of iterations used in RISEWIND to
c                              obtain mean wind for sampling step that
c                              includes gradual rise
c            SL2PF - real    - Ratio of minimum slug sigma-y to slug
c                              length at which transition from slug
c                              sampling to puff sampling takes place
c          CDIV(2) - real    - Threshold criterion for adjusting for
c                              significant vertical divergence (horiz.
c                              convergence) across puff (1/s)
c                              Partial adjustment begins at CDIV(1),
c                              and reaches full strength at CDIV(2)
c           WSCALM - real    - Wind speed threshold between "calm" and
c                              non-"calm" conditions.  Also used as
c                              lower limit on wind speed returned from
c                              power-law extrapolation (m/s)
c         WSCAT(5) - real    - Upper value (m/s) for first 5 wind speed
c                              classes (class 6 has no upper limit)
c  VQFAC(12,mxq12) - real    - Emission rate scaling factors for
c                              variable emissions.  Values are stored
c                              in blocks of 12, since all options result
c                              in multiples of 12 (see IQNUM)
c         IQNUM(5) - integer - Number of groups of 12 scaling factors
c                              for each of the 5 options
c                              1: 2     (Diurnal, 24 values)
c                              2: 1     (Monthly, 12 values)
c                              3: 8     (Hour/Season, 96 values)
c                              4: 3     (Speed/Stability, 36 values)
c                              5: 1     (Temperature, 12 values)
c           IQNEXT - integer - Pointer to the next available entry point
c                              in VQFAC
c       SVMIN(6,2) - real    - Minimum Turbulence Sigma-v (m/s) for
c                              stability classes 1-6 over land (1-6,1)
c                              and over water (1-6,2)
c       SWMIN(6,2) - real    - Minimum Turbulence Sigma-w (m/s) for
c                              stability classes 1-6 over land (1-6,1)
c                              and over water (1-6,2)
c            SYMIN - real    - Minimum Sigma y (m) applied to newly-
c                              released puffs
c            SZMIN - real    - Minimum Sigma z (m) applied to newly-
c                              released puffs
c           XMINZI - real    - Minimum mixing height (m)
c           XMAXZI - real    - Maxmimum mixing height (m)
c          PLX0(6) - real    - Wind profile power law exponents used as
c                              defaults (read from control file, or
c                              filled with ISC values for either rural
c                              or urban land use).  Power law is used
c                              to extrapolate winds in the vertical only
c                              when "single-point" met. data are used
c                              (ISCMET.DAT or PLMMET.DAT)
c          PTG0(2) - real    - Potential temperature gradient default
c                              values obtained from control file for
c                              stability classes E and F (degK/m)
c           PPC(6) - real    - Plume path coefficient values from
c                              file for use with partial plume height
c                              height correction option, MCTADJ = 3
c              TBD - real    - Variable determining switch-over pt. from
c                              Schulman-Scire scheme to Huber-Snyder
c                              scheme (SS used for Hs < Hb + TBD * HL,
c                              TBD < 0   ==> always use Huber-Synder
c                              TBD = 1.5 ==> always use Schulman-Scire
c                              TBD = 0.5 ==> ISC switch-point
c      TIBLDIST(3) - real    - Sub-grid TIBL distance (km) parameters:
c                              Pure TIBL growth from coast to dist.(1)
c                              Transition to CALMET Zi from (1) to (2)
c                              Search dist. for locating nearest coast
c----------------------------------------------------------------------
c -----   Puff Splitting Information  -----
c----------------------------------------------------------------------
c ---   Vertical  ---
c            NSPLIT - integer - Number of puffs/slugs that result
c                               (puff is sectioned NSPLIT-1 times)
c      IRESPLIT(24) - integer - Reset flag for puff-splitting (hourly)
c                               0: Do not change current ISPLIT values
c                               1: Reset all ISPLIT values to 1
c           ZISPLIT - real    - Split allowed if "ziold" mixing height
c                               exceeds ZISPLIT (m)
c           ROLDMAX - real    - Split allowed if ratio "ziold/zimax"
c                               is not greater than ROLDMAX
c ---   Horizontal  ---
c           NSPLITH - integer - Number of puffs that result
c          SYSPLITH - real    - Minimum sigma-y (m) of a puff before
c                               it may be split
c                               [grid cells in control file]
c  CNSPLITH(mxspec) - real    - Minimum average concentration (g/m^3)
c                               of each species in puff before
c                               it may be split
c          SHSPLITH - real    - Minimum puff elongation rate (m/s) due
c                               to wind shear before puff may be split.
c                               This is the radial wind speed difference
c                               between the puff center and a point
c                               located 1.2 SYSPLITH away (currently
c                               set as fd/2 in SPLIT).
c                               [Control file variable is entered as
c                               the relative elongation rate
c                               (SYSPLITH/hr)]
c----------------------------------------------------------------------
c -----   Integral Convergence Information  -----
c----------------------------------------------------------------------
c           EPSSLUG - real    - Fractional convergence criterion for
c                               numerical SLUG sampling integral
c           EPSAREA - real    - Fractional convergence criterion for
c                               numerical AREA-source integral
c            DSRISE - real    - Along-trajectory distance step used
c                               when marching in numerical plume rise
c                               solver
c----------------------------------------------------------------------
c -----   PRIME Downwash Information  -----
c----------------------------------------------------------------------
c          TRAJINCL - real    - Trajectory inclination angle (deg),
c                               ignoring streamline descent, at which
c                               check is made for wake influence
c----------------------------------------------------------------------
c -----   Puff Age Limit Information  -----
c----------------------------------------------------------------------
c          MXAGEHR - integer  - Maximum puff age allowed in run (hours)
c          TSECMAX - real     - Maximum puff age allowed in run (sec)
c             LAGE - logical  - Control flag for applying the puff age
c                               limit
c                               F: if MXAGEHR <= 0
c                               T: if MXAGEHR >  0
c-----------------------------------------------------------------------
c --- COMMON BLOCK /CONST/ --- CTSG constants                    CALPUFF
c-----------------------------------------------------------------------

      common/const/ zero,one,two,three,four,half,twoby3,rt2,
     *              pi,pii,piby2,twopi,rtpi,rtpii,rt2pi,dtor,
     *              alphai,small,expmax,hslfac,epsint,
     *              epsrefl,mxrefl
c-----------------------------------------------------------------------
c     DEFINITIONS       [i]=integer     [r]=real        [a]=array
c-----------------------------------------------------------------------
c rt2           square root of 2                                     [r]
c pi            (3.14159)                                            [r]
c pii           1/pi                                                 [r]
c piby2         pi/2                                                 [r]
c twopi         2*pi                                                 [r]
c rtpi          square root pi                                       [r]
c rtpii         1/rtpi                                               [r]
c rt2pi         square root 2*pi                                     [r]
c dtor          degrees-to-radians factor                            [r]
c alphai        factor for converting length scale at half the hill  [r]
c               height to length scale of the hill-shape function
c small         used to signify when a computed difference is        [r]
c               considered "zero"
c expmax        maximum argument allowed for EXP function            [r]
c hslfac        fraction of cut-off hill height used as a minimum    [r]
c               streamline height for obtaining distortion factors
c epsint        fractional convergence criterion used in integration [r]
c               subroutine QATR
c epsrefl       fractional convergence criterion used to exit loop   [r]
c               over reflection terms in vertical distribution factor
c mxrefl        maximum number of reflections allowed from mixing lid[i]
c----------------------------------------------------------------------
c-----------------------------------------------------------------------
c --- COMMON BLOCK /CSIGMA/ -- Dispersion coefficient constants  CALPUFF
c-----------------------------------------------------------------------
c
      common/csigma/ayt,azt(6),syh,szh,thfty,thftz,avefac,avefaci,
     1              tyidr,tzidr,tzisdr,
     2              aypgt(6),bypgt(6),aypgti(6),bypgti(6),
     3              azpgt(6),bzpgt(6),azpgti(6),bzpgti(6),
     4              ayurb(6),xiyurb(6),azurb(6),xizurb(6),
     5              nzbrur(6),xzbrur(10,6),szbrur(10,6),
     6              azrur(10,6),bzrur(10,6),azruri(10,6),bzruri(10,6),
     7              idoptys,idoptzs,irus,uavgs,kstabs,els,bvfs,mhftszs,
     8              tsigvs,tsigws,symins,szmins
c
c --- COMMON BLOCK /CSIGMA/ Variables:
c
c
c *** For MDISP = all
c     Heffter(1965) time dependent growth coeffs. for long range.
c                  AYT  - real const - Time dependent Y growth rate for
c                                      all PGT classes.
c               AZT(6)  - real array - Time dependent Z growth rates for
c                                      each PGT class.
c                  SYH  - real const - Horizontal sigma (m) beyond which
c                                      time dependent growth assumed.
c                  SZH  - real const - Vertical sigma (m) beyond which
c                                      time dependent growth assumed.
c                THFTY  - real       - Virtual travel time (s) associated
c                                      with SYH for "current" met.;
c                                      transition to Heffter growth law.
c                THFTZ  - real       - Virtual travel time (s) associated
c                                      with SZH for "current" met.;
c                                      transition to Heffter growth law.
c
c *** For MDISP = 3,4
c               AVEFAC  - real       - Averaging time adjustment factor
c                                      for sigma-y; (avet/3 min)**0.2
c                                      used for PG sigmas.
c              AVEFACI  - real       - 1./AVEFAC
c
c *** For MDISP = 1,2
c     Dispersion determined by local turbulence (sigv,sigw) and the
c     Irwin(1983) recommended forms of (fy,fz) of Draxler(1976):
c     fy = 1.0 / (1.0 + 0.9 * sqrt(tyidr * t) )
c     fz = 1.0 / (1.0 + 0.9 * sqrt(tzidr * t) )         for L < 0
c     fz = 1.0 / (1.0 + 0.945 * (tzisdr * t)**0.806 )   for L > 0
c                TYIDR  - real const - Reciprocal time scale (1/s) for
c                                      Draxler form of fy.
c                TZIDR  - real const - Reciprocal time scale (1/s) for
c                                      Draxler form of fz for L < 0
c               TZISDR  - real const - Reciprocal time scale (1/s) for
c                                      Draxler stable form of fz (L > 0)
c
c *** For MDISP = 4
c     Pasquill-Gifford-Turner(PGT) coeffs. for RURAL conditions.
c     Values of coeffs. and exponents from MESOPUFF II approximations.
c             AYPGT(6)  - real array - PGT Y coeffs. for each PGT class.
c             BYPGT(6)  - real array - PGT Y expons. for each PGT class.
c            AYPGTI(6)  - real array - Reciprocals of AYPGT(6).
c            BYPGTI(6)  - real array - Reciprocals of BYPGT(6).
c             AZPGT(6)  - real array - PGT Z coeffs. for each PGT class.
c             BZPGT(6)  - real array - PGT Z expons. for each PGT class.
c            AZPGTI(6)  - real array - Reciprocals of AZPGT(6).
c            BZPGTI(6)  - real array - Reciprocals of BZPGT(6).
c
c *** For MDISP = 3 and 4
c     Briggs urban coeffs. for each PGT class for URBAN conditions.
c             AYURB(6)  - real array - Urban Y coeffs. by PGT class.
c            XIYURB(6)  - real array - Reciprocal length scale (1/m)
c                                      for SIGY for each PGT class.
c             AZURB(6)  - real array - PGT Z coeffs. for each PGT class.
c            XIZURB(6)  - real array - Reciprocal length scale (1/m)
c                                      for SIGZ for each PGT class.
c
c *** For MDISP = 3
c     Pasquill-Gifford-Turner(PGT) coeffs. for RURAL conditions.
c     Values of coeffs. and exponents from ISC approximations.
c              NZBRUR(6)- int. array - Number segments per PGT class.
c           XZBRUR(10,6)- real array - Junction x's (km) per PGT class.
c           SZBRUR(10,6)- real array - Junction sigmas per PGT class.
c            AZRUR(10,6)- real array - PGT Z coeffs. for each PGT class.
c            BZRUR(10,6)- real array - PGT Z expons. for each PGT class.
c           AZRURI(10,6)- real array - Reciprocals of AZRUR(10,6).
c           BZRURI(10,6)- real array - Reciprocals of BZRUR(10,6).
c
c ---------------------------------------------------------------------
c --- Current configuration and meteorological information
c ---------------------------------------------------------------------
c     IDOPTYS - integer   - Dispersion method option for SIGY **
c     IDOPTZS - integer   - Dispersion method option for SIGZ **
c                          **  computed from:
c                               1,2 = SIGMA V,W
c                                 3 = PG curves (rural), MP (urban)
c                                 4 = MESOPUFF II curves (rural),
c                                     MP (urban)
c                                 5 = CTDM (neutral/stable),
c                                     IDOPT(1) (other)
c                               (All IDOPT - use Heffter eqns. for
c                                long travel times)
c        IRUS - integer   - Rural cell indicator (rural=0 ; urban=1)
c       UAVGS - real      - Mean transport speed (m/s)
c      KSTABS - integer   - PGT stability class at puff
c         ELS - real      - Current Monin-Obukhov length (m)
c        BVFS - real      - Current Brunt-Vaisala freq (1/s)
c     MHFTSZS - integer   - Flag indicating use of Heffter growth for z
c                              (0: NO Heffter   1: Heffter)
c      TSIGVS - real      - Current sigma-v velocity (m/s)
c      TSIGWS - real      - Current sigma-w velocity (m/s)
c      SYMINS - real      - Minimum value of sigma-y (m)
c      SZMINS - real      - Minimum value of sigma-z (m)
c-----------------------------------------------------------------------
c --- COMMON BLOCK /CTPASS/ --- CTSG Variables                   CALPUFF
c-----------------------------------------------------------------------

      real majaxw,minaxw
      logical ldb

      common/ctpass/nlev,ntpts,sz1,sz2,sy1,sy2,szr,syr,szmn,symn,
     *              frac,twokz,twoky,xrctm(mxrect),yrctm(mxrect),
     *              relief(mxhill),expo(2,mxhill),scale(2,mxhill),
     *              axmax(2,mxhill),xc(mxhill),yc(mxhill),
     *              thetah(mxhill),zgrid(mxhill),hda(mxhill),
     *              ubyna(mxhill),ih,ip,ir,iregl,iregu,
     *              z(mxlev),ws(mxlev),abvf(mxlev),
     *              q,u,hd,ubyn,zlid,thetaw,
     *              rotflo,rotang,alfw,beta,cbeta,d,
     *              h,baxi,r,
     *              xp,yp,xpf,ypf,zpuff,isc,
     *              xr,yr,xrf,yrf,xre,yre,zrec,
     *              x12f,x23f,xob,xbegin,xend,xspace,
     *              t12p,t12rl,t12ru,tstep,tstart,timpg,
     *              szimpg,syimpg,szesq,szosq,szpsq,szsq,at(2,mxtpts),
     *              mhillt,nzh(mxhill),zh(mxcntr,mxhill),
     *              majaxw(mxcntr,mxhill),minaxw(mxcntr,mxhill),
     *              ldb,idebug
c-----------------------------------------------------------------------
c     DEFINITIONS       [i]=integer     [r]=real        [a]=array
c-----------------------------------------------------------------------
c
c --- NOTE:  horizontal coordinates are relative to MET grid origin (m)
c
c nlev           number of levels of met data used to calc. Hd       [i]
c ntpts          number of points used to obtain flow factors        [i]
c                along trajectory of puff over hill (should be odd)
c sz1,sy1 (m)    puff sigmas at the start of the timestep            [r]
c sz2,sy2 (m)    puff sigmas at the end of the timestep              [r]
c szr,syr (m)    puff sigmas at the receptor                         [r]
c szmn,symn(m)   minimum sigma-z and sigma y allowed                 [r]
c frac           fraction of step from start to receptor position    [r]
c twokz,twoky    diffusivities over the timestep                     [r]
c xrctm,yrctm(m) CTSG receptor coordinates in meters                [ra]
c relief (m)     height of crest of hill above base elevation       [ra]
c expo           hill shape exponents for major and minor axes      [ra]
c scale (m)      horizontal length scale along major and minor axes [ra]
c axmax (m)      maximum axis lengths for major and minor axes      [ra]
c xc,yc (m)      coordinates of center of hill                      [ra]
c thetah (deg)   orientation of major axis of hill (CW from north)  [ra]
c zgrid (m)      height of "base-plane" of hill above mean sea level[ra]
c hda (m)        array of dividing-streamline heights               [ra]
c                (1 for each hill)
c ubyna (m)      array of U/N values (1 for each hill)              [ra]
c ih             current hill-number (receptor loop - 0 denotes      [i]
c                no hill)
c ip             current puff-number (receptor loop)                 [i]
c ir             current receptor-number (receptor loop)             [i]
c iregl,iregu    region containing the receptor (l:lower; u:upper)   [i]
c z (m)          height of met data level (above ground)            [ra]
c ws (m/s)       wind speed at height z                             [ra]
c abvf (1/s)     Brunt-Vaisala frequency in layer whose top is at z [ra]
c q (g)          mass contained in current puff                      [r]
c u (m/s)        wind speed for current puff                         [r]
c hd, ubyn (m)   Hd and U/N for current hill                         [r]
c zlid (m)       mixing lid for current puff                         [r]
c thetaw (deg)   wind direction (CW from north) for current puff     [r]
c rotflo (rad)   angle of rotation CCW from the geographic coord.    [r]
c                system to the coord. system with x along the flow
c rotang (rad)   angle of rotation CCW from hill-ellipse coord.      [r]
c                system to the coord. system with x along the flow
c alfw (rad)     wind direction CW from the major axis of            [r]
c                hill-ellipse
c beta (rad)     angle of rotation CCW from flow direction to the    [r]
c                normal to the hill-ellipse at the stagnation-point
c cbeta          COS(beta)                                           [r]
c d (m)          distance between puff trajectory and stagnation     [r]
c                streamline
c h (m)          height of the current hill above grid elevation     [r]
c baxi (1/m)     inverse of the minor semiaxis of the hill-ellipse   [r]
c r              ratio of major axis to the minor axis of            [r]
c                hill-ellipse
c xp,yp (m)      grid coordinates of current puff                    [r]
c xpf,ypf (m)    current puff position in flow coord. system         [r]
c zpuff (m)      height of current puff above grid elevation         [r]
c isc            stability class for current puff and timestep       [i]
c xr,yr (m)      grid coordinates of current receptor                [r]
c xrf,yrf (m)    current receptor position in flow coord. system     [r]
c xre,yre (m)    current receptor position in hill-ellipse coord.    [r]
c                system
c zrec (m)       height of current receptor above grid elevation     [r]
c                (note that receptors must be on the surface)
c x12f,x23f (m)  intersection of puff trajectory with boundaries     [r]
c                between regions 1&2, and 2&3 (flow coord. system)
c xob (m)        x-coord. of the stagnation point in beta coord.     [r]
c                system
c xbegin,xend (m)location of beginning and ending points along       [r]
c                trajectory for factors contained in array "at"
c xspace (m)     spacing between points contained in array "at"      [r]
c t12p (s)       travel time from puff position at start of period   [r]
c                to x12f
c t12rl,t12ru (s) travel time from x12f to the receptor position for [r]
c                receptors in the lower (l) and upper (u) flows
c tstep (s)      length of the time-step                             [r]
c tstart (s)     age of the current puff at the start of the period  [r]
c timpg (s)      age of the current puff at x12f                     [r]
c szimpg (m)     sigma-z at the impingement point                    [r]
c syimpg (m)     sigma-y at the impingement point                    [r]
c szesq (m**2)   square of the effective sigma-z of the puff at the  [r]
c                receptor
c szosq (m**2)   square of the sigma-z of the puff at the x12f       [r]
c                (or 1 sec. after release if timpg<0)
c szsq (m**2)    square of the sigma-z of the puff at the receptor   [r]
c                (no hill)
c szpsq (m**2)   szsq-szosq                                          [r]
c at             array of deformation factors (th,tl) at points     [ra]
c                along the trajectory [at(1,-)=th, at(2,-)=tl]
c
c -------------- New data used to allow CTDM hill specification --------
c mhillt         option to use hill information from:                [i]
c                   1 = CTDM preprocessor
c                   2 = original OPTHILL preprocessor
c nzh            number of heights for which ellipse variables are  [ia]
c                provided, specified for each hill
c zh  (m )       heights for which ellipse variables are provided   [ra]
c                (initially MSL, but referenced to grid cell elev
c                 in CTINIT)
c majaxw  (m)    length of major semi-axis of elliptical contour    [ra]
c                for a specific value of zh
c minaxw  (m)    length of minor semi-axis of elliptical contour    [ra]
c                for a specific value of zh
c ----------------------------------------------------------------------
c ldb            debug control logical                               [l]
c idebug         io unit for debug writes                            [l]
c-----------------------------------------------------------------------
c----------------------------------------------------------------------
c --- COMMON BLOCK /CTSGDAT/ -- Subgrid-scale complex terrain   CALPUFF
c                               information
c----------------------------------------------------------------------
c
      common/CTSGDAT/NHILL,NCTREC,MHILL,
     1 XHILL2M,ZHILL2M,XCTDMKM,YCTDMKM,XMETCT0M,YMETCT0M,
     2 HILLDAT(11,mxhill),XRCT(mxrect),YRCT(mxrect),ELRECT(mxrect),
     3 IHILL(mxrect)
c
c --- COMMON BLOCK /CTSGDAT/ Variables:
c
c                  NHILL - integer  - Number of subgrid-scale terrain
c                                     features
c                 NCTREC - integer  - Number of special complex terrain
c                                     receptors
c                  MHILL - integer  - Method for input of hill terrain
c                                     data
c                                       1 = Created by CTDM processor
c                                           programs (in CTDM format)
c                                       2 = Created by CALPUFF OPTHILL
c                                           processor & read in Input
c                                           Group (6b)
c                XHILL2M - real     - scale factor to convert horizontal
c                                     hill dimensions to meters for
c                                     MHILL=1 (CTDM Files)
c                ZHILL2M - real     - scale factor to convert vertical
c                                     hill dimensions to meters for
c                                     MHILL=1 (CTDM Files)
c                XCTDMKM - real     - x-origin of CTDM coordinate system
c                                     referenced to "UTM" coordinate
c                                     system used in CALPUFF (km)
c                                     MHILL=1 (CTDM Files)
c                YCTDMKM - real     - y-origin of CTDM coordinate system
c                                     referenced to "UTM" coordinate
c                                     system used in CALPUFF (km)
c                                     MHILL=1 (CTDM Files)
c               XMETCT0M - real     - x-origin of CTDM coordinate system
c                                     referenced to SW corner of
c                                     CALPUFF MET grid (m)
c                                     MHILL=1 (CTDM Files)
c               YMETCT0M - real     - y-origin of CTDM coordinate system
c                                     referenced to SW corner of
c                                     CALPUFF MET grid (m)
c                                     MHILL=1 (CTDM Files)
c     HILLDAT(11,mxhill) - real     - Hill data for MHILL=2
c                          (1,-)= XC -- X coordinate of center of hill
c                                 (met. grid units)
c                          (2,-)= YC -- Y coordinate of center of hill
c                                 (met. grid units)
c                          (3,-)= THETAH -- Orientation of major axis of
c                                 hill (clockwise from North)
c                          (4,-)= ZGRID -- Height of the "zero-plane"
c                                 of the grid above mean sea level
c                          (5,-)= RELIEF -- Height of the crest of the
c                                 hill above the grid elevation
c                          (6,-)= EXPO 1 -- Hill-shape exponent for the
c                                 major axis
c                          (7,-)= EXPO 2 -- Hill-shape exponent for the
c                                 major axis
c                          (8,-)= SCALE 1 -- Horizontal length scale
c                                 along the major axis
c                          (9,-)= SCALE 2 -- Horizontal length scale
c                                 along the minor axis
c                         (10,-)= AMAX -- Maximum allowed axis length
c                                 for the major axis
c                         (11,-)= BMAX -- Maximum allowed axis length
c                                 for the major axis
c           XRCT(mxrect) - real     - X coordinate of complex terrain
c                                     receptor (met. grid units)
c           YRCT(mxrect) - real     - Y coordinate of complex terrain
c                                     receptor (met. grid units)
c         ELRECT(mxrect) - real     - Ground elevation (m MSL) of each
c                                     complex terrain receptor
c          IHILL(mxrect) - integer  - Hill number associated with each
c                                     complex terrain receptor
c----------------------------------------------------------------------
c --- COMMON BLOCK /CURRENT/ -- Info. for current puff/slug     CALPUFF
c----------------------------------------------------------------------
c
      logical lup1,lup2
c
      common/CURRENT/xb1,yb1,zb1,syb1,szb1,
     1               xe1,ye1,ze1,sye1,sze1,
     2               vtyb1,vtzb1,vtye1,vtze1,
     3               vdyb1,vdzb1,vdye1,vdze1,
     4               xb2,yb2,zb2,syb2,szb2,
     5               xttb1,xtte1,tb1,te1,sym1,szm1,zm1,
     6               xe2,ye2,ze2,sye2,sze2,
     7               vtyb2,vtzb2,vtye2,vtze2,
     8               vdyb2,vdzb2,vdye2,vdze2,
     9               xttb2,xtte2,tb2,te2,
     1               fracz1,fracz2,lup1,lup2,
     2               ipnum,isnum,istype,icode,imet,
     3               iage,speedi,srat,temis,bidsq,xfrise,zfrise,
     4               sy0sq,vsetl,zplat,
c ----------- POLYGON area source data ---------------
     5               nside,xvert(mxvert),yvert(mxvert),
     6               xv(mxvert),yv(mxvert),aream2,
c ----------- POLYGON line source data ---------------
     7               xshift,xupedge,
c ----------- DISPERSION OPTION  data  ---------------
     8               idopty,idoptz
c
c
c --- COMMON BLOCK /CURRENT/ Variables:
c
c Puff or Older end of Slug -----
c       XB1,YB1,ZB1 - real      -Coordinates (m) of the PUFF or OLDER
c                                end of the SLUG at the BEGINNING (B)
c                                of the time step (i.e., time = T).
c         SYB1,SZB1 - real     - are the corresponding Sigmas (m) with
c                                BID (note SX = SY assumed).
c       XE1,YE1,ZE1 - real      -Coordinates (m) of the PUFF or OLDER
c                                end of the SLUG at the END (E) of
c                                the time step (i.e., time = T+DT).
c         SYE1,SZE1 - real     - are the corresponding Sigmas (m) with
c                                BID (note SX = SY assumed).
c       VTYB1,VTZB1 - real     - Virtual travel TIME (s) for sigmas of
c                                PUFF or OLDER end of SLUG at BEGINNING
c                                of step
c       VTYE1,VTZE1 - real     - Virtual travel TIME (s) for sigmas of
c                                PUFF or OLDER end of SLUG at END
c                                of step
c       VDYB1,VDZB1 - real     - Virtual travel DIST (km) for sigmas of
c                                PUFF or OLDER end of SLUG at BEGINNING
c                                of step
c       VDYE1,VDZE1 - real     - Virtual travel DIST (km) for sigmas of
c                                PUFF or OLDER end of SLUG at END
c                                of step
c             XTTB1 - real     - Total travel distance of PUFF or OLDER
c                                end of SLUG at the BEGINNING of the
c                                time step.
c             XTTE1 - real     - Total travel distance of PUFF or OLDER
c                                end of SLUG at the END of the
c                                time step.
c               TB1 - real     - Total travel time of PUFF or OLDER
c                                end of SLUG at the BEGINNING of the
c                                time step.
c               TE1 - real     - Total travel time of PUFF or OLDER
c                                end of SLUG at the END of the
c                                time step.
c     SYM1,SZM1,ZM1 - real     - PUFF sigmas and ht (m) at midpoint
c                                with BID
c
c Younger end of Slug ----------
c       XB2,YB2,ZB2 - real     - Coordinates (m) of the YOUNGER end
c                                of the SLUG at the BEGINNING (B) of
c                                the time step (i.e., time = T).
c         SYB2,SZB2 - real     - are the corresponding Sigmas (m) with
c                                BID (note SX = SY assumed).
c       XE2,YE2,ZE2 - real      -Coordinates (m) of the YOUNGER end
c                                of the SLUG at the END (E) of
c                                the time step (i.e., time = T+DT).
c         SYE2,SZE2 - real     - are the corresponding Sigmas (m) with
c                                BID (note SX = SY assumed).
c       VTYB2,VTZB2 - real     - Virtual travel TIME (s) for sigmas of
c                                YOUNGER end of SLUG at BEGINNING
c                                of step
c       VTYE2,VTZE2 - real     - Virtual travel TIME (s) for sigmas of
c                                YOUNGER end of SLUG at END of step
c       VDYB2,VDZB2 - real     - Virtual travel DIST (km) for sigmas of
c                                YOUNGER end of SLUG at BEGINNING
c                                of step
c       VDYE2,VDZE2 - real     - Virtual travel DIST (km) for sigmas of
c                                YOUNGER end of SLUG at END of step
c             XTTB2 - real     - Total travel distance of YOUNGER end
c                                at the BEGINNING of the time step.
c             XTTE2 - real     - Total travel distance of YOUNGER end
c                                at the END of the time step.
c               TB2 - real     - Total travel time of YOUNGER end
c                                at the BEGINNING of the time step.
c               TE2 - real     - Total travel distance of YOUNGER end
c                                at the END of the time step.
c
c Misc. Puff/Slug --------------
c    FRACZ1, FRACZ2 - real     - Fraction of step beyond which puff ht
c                                is constant for upslope flow, or up
c                                to which puff height is constant for
c                                downslope flow, for puff (1);
c                                or for old (1) and new (2) end of slug
c         LUP1,LUP2 - logical  - Flag for upslope flow when .TRUE. for
c                                puff (1);   or for old (1) and new (2)
c                                end of slug
c             IPNUM - integer  - Current "Puff(Slug)" index number
c             ISNUM - integer  - Associated source index
c            ISTYPE - integer  - Associated source type:
c                                1 = Point         Constant Emissions
c                               (2)= Point         Variable Emissions
c                                3 = Poly. Area    Constant Emissions
c                               (4)= Poly. Area    Variable Emissions
c                                5 = Line          Constant Emissions
c                                6 = Volume        Constant Emissions
c                               (7)= Grid Volume   Constant Emissions
c                               (8)= Grid Volume   Variable Emissions
c             ICODE - integer  - Current "Puff(Slug)" code
c                                (see IPUFCD in /PUFF/)
c              IMET - integer  - Met index for source tabulations such
c                                as numerical plume rise
c                                =1 current meteorology
c                                =2 previous meteorology
c                                =3 previous previous meteorology
c                                =4 (etc.)
c                                Limited by MXMETSAV parameter
c              IAGE - integer  - Age indicator.
c                                =0 implies material is being emitted.
c                                >0 implies material is older.
c            SPEEDI - real     - Wind speed at emission time (m/s)
c              SRAT - real     - Ratio of the vector mean wind speed
c                                to scalar speed at emission time
c             TEMIS - real     - Duration of the original emission (s)
c             BIDSQ - real     - Square of buoyancy-induced sigma at
c                                final rise (m^2)
c            XFRISE - real     - Distance to final rise (m)
c            ZFRISE - real     - Final puff/slug rise (m) -- not height
c             SY0SQ - real     - Square of sigma-y associated with area
c                                source (m^2)
c             VSETL - real     - Gravitational settling velocity (m/s)
c                                for current puff
c             ZPLAT - real     - Platform (downwash) ht above surface (m)
c
c             NSIDE - integer  - # sides of the polygon area source.
c     XVERT(mxvert) - real     - X coordinates (m) of the vertices of
c                                the polygon area source.
c     YVERT(mxvert) - real     - Y coordinates (m) of the vertices of
c                                the polygon area source.
c        XV(mxvert) - real     - Upwind distances (m) from a receptor
c                                to vertices of polygon area source.
c        YV(mxvert) - real     - Crosswind distances (m) from receptor
c                                to vertices of polygon area source.
c            AREAM2 - real     - Area of source (m^2)
c            XSHIFT - real     - Distance from upwind edge of block
c                                of line sources to source of current
c                                slug (m)
c           XUPEDGE - real     - Distance from upwind edge of block
c                                of line sources to receptor, along
c                                current flow direction (m)
c     IDOPTY,IDOPTZ - integer  - Dispersion option for sigma-y and
c                                sigma-z (Derived from MDISP:1-5)
c
c *** Notes:
c
c --- Note that for IAGE = 0, (XB2,YB2,ZB2) = (XE2,YE2,ZE2) = (XS,YS,ZS)
c     (i.e., where (XS,YS,ZS) are source coordinates) and
c     (SYB2,SZB2) = (SYE2,SZE2) = (SY0,SZ0)  (i.e., where (SY0,SZ0) are
c     the initial sigmas at the source).
c
c --- SRAT is the ratio of the vector mean wind speed at emission time
c     to SPEEDI.  It is needed for model self-consistency and to avoid
c     absurd results as the VMWS goes to zero.  Note that for most
c     reasonable winds, SRAT > 0.95 so there are few significant
c     problems.
c --------------------------------------------------------------------
c----------------------------------------------------------------------
c --- COMMON BLOCK /DATEHR/ -- Date/time variables              CALPUFF
c----------------------------------------------------------------------
c
      common/datehr/nyr,nmo,nday,njul,nhr,nhrind,ndathr,xbtz
c
c --- COMMON BLOCK /DATEHR/ Variables:
c           NYR - integer    - 4 digit year
c           NMO - integer    - Month
c          NDAY - integer    - Day of month
c          NJUL - integer    - Julian day
c           NHR - integer    - Current hour (00-23)
c        NHRIND - integer    - Hour index (01-24)
c        NDATHR - integer    - Code date and time (YYYYJJJHH, where
c                              YYYY=year, JJJ=Julian day, HH=hour)
c          XBTZ - real       - Base time zone for current date/time
c----------------------------------------------------------------------
c --- COMMON BLOCK /DISPDAT/ -- Dispersion parameters           CALPUFF
c
c----------------------------------------------------------------------
c
      common/DISPDAT/SYTDEP,JSUP,CONK1,CONK2,IURB1,IURB2,AVET,PGTIME
c
c --- COMMON BLOCK /DISPDAT/ Variables:
c
c        SYTDEP - real     - Horizontal sigma (m) beyond which
c                            time dependent growth assumed.
c          JSUP - integer  - Stability class used to determine plume
c                            growth rates for puffs above the boundary
c                            layer
c         CONK1 - real     - Vertical dispersion constant for stable
c                            conditions
c         CONK2 - real     - Vertical dispersion constant for neutral/
c                            unstable conditions
c        IURB1, - integers - Range of land use categories for which
c        IURB2               urban dispersion is assumed
c          AVET - real     - Averaging time of concentrations (minutes)
c                            (used to adjust PG sigma y with eqn.
c                            (AVET/PGTIME)**0.2
c        PGTIME - real     - Averaging time (minutes) assumed for
c                            PG sigma y curves
c----------------------------------------------------------------------
c --- COMMON BLOCK /DRYDEP/ -- Dry deposition flags             CALPUFF
c----------------------------------------------------------------------
c
      common/DRYDEP/idryflg(mxspec),vduser(24,mxspec),nvduser,
     1 zref,iveg
c
c --- COMMON BLOCK /DRYDEP/ Variable:
c
c     IDRYFLG(mxspec) - integer  - Array of dry deposition flags for
c                                  each pollutant
c                                    0 = No deposition
c                                    1 = Resistance model - gas
c                                    2 = Resistance model - particle
c                                    3 = User-specified dep. velocities
c   VDUSER(24,mxspec) - real     - Deposition velocity (m/s) for each
c                                  hour of the day and species
c                                  (missing values indicated by -999.)
c             NVDUSER - integer  - Number of species for which the
c                                  user-specified deposition velocities
c                                  are used
c                ZREF - real     - Reference height (m) for computing
c                                  the atmospheric resistance
c                IVEG - integer  - Vegetation index in unirrigated areas
c                                   1=vegetation is active & unstressed
c                                   2=vegetation is active & stressed
c                                   3=vegetation is inactive
c----------------------------------------------------------------------
c --- COMMON BLOCK /DRYGAS/ -- Dry deposition parameters        CALPUFF
c----------------------------------------------------------------------
c
      common/DRYGAS/pdiff(mxspec),alphas(mxspec),react(mxspec),
     1 rm(mxspec),henry(mxspec),rgg(mxspec),rgw1(mxspec),rcut(mxspec),
     2 rd1(mxspec),rcutr,rgr,reactr,pconst,bmin,bmax,qswmax,dconst1,
     3 dconst2,dconst3
c
c --- COMMON BLOCK /DRYGAS/ Variables:
c       PDIFF(mxspec) - real    - Molecular diffusivity (m**2/s)
c                                 of each pollutant.
c                                 SEE NOTE #1
c      ALPHAS(mxspec) - real    - Solubility enhancement factor due
c                                 to the aqueous phase reactivity of
c                                 the pollutant.
c       REACT(mxspec) - real    - Reactivity factor for each
c                                 pollutant.
c          RM(mxspec) - real    - Mesophyll resistance (s/m)
c                                 SEE NOTE #2
c       HENRY(mxspec) - real    - Henry's law constant (ratio of
c                                 gas to aqueous phase concentration
c                                 of the pollutant).
c         RGG(mxspec) - real    - Resistance (s/m) to direct
c                                 transfer of the pollutant to the
c                                 ground.
c        RGW1(mxspec) - real    - Ratio of HENRY(i)/(ALPHAS(i)*d3)
c                                 where d3 is a constant.  Used in
c                                 computing resistance directly to
c                                 water surface.
c        RCUT(mxspec) - real    - Cuticle resistance (s/m).
c         RD1(mxspec) - real    - Ratio d1*SC**d2/k, where d1,d2 are
c                                 constants, SC is the Schmidt
c                                 number, and k is the von Karman
c                                 constant
c               RCUTR - real    - Reference cuticle resistance (s/m)
c                                 SEE NOTE #2
c                 RGR - real    - Reference ground resistance (s/m)
c                                 SEE NOTE #2
c              REACTR - real    - Reference pollutant reactivity
c              PCONST - real    - Stomatal constant (m**2)
c                BMIN - real    - Minimum width of the stomatal
c                                 opening (m)
c                BMAX - real    - Maximum width of the stomatal
c                                 opening (m)
c              QSWMAX - real    - Short-wave solar radiation (W/m**2)
c                                 level at which full opening of the
c                                 stomata occurs
c     DCONST1,DCONST2 - real    - Empirical constants in deposition
c                                 layer resistance equation
c             DCONST3 - real    - Constant in the "ground" resistance
c                                 to water surfaces
c
c  NOTE #1: Input units of this variable are cm**2/s.  Conversion to m**2/s
c           is made internally in the SETUP phase.
c
c  NOTE #2: Input units of s/cm are converted to s/m in the SETUP phase.
c----------------------------------------------------------------------
c --- COMMON BLOCK /DRYPART/ -- Particle dry dep. parameters    CALPUFF
c----------------------------------------------------------------------
c
      common/DRYPART/nspart,gdiam(mxpdep),gsig(mxpdep),rho(mxpdep),
     1 npsint,dconst4,pdiam(mxint,mxpdep),sc23(mxint,mxpdep),
     2 vgrav(mxint,mxpdep),tstop(mxint,mxpdep),fract(mxint,mxpdep),
     3 vairms
c
c --- COMMON BLOCK /DRYPART/ Variables:
c                  NSPART - real    - Number of particle species
c           GDIAM(mxpdep) - real    - Geometric mass mean diameter
c                                     (microns)
c            GSIG(mxpdep) - real    - Geometric standard deviation of
c                                     particle distribution (microns)
c             RHO(mxpdep) - real    - Particle density (g/cm**3)
c                  NPSINT - integer - Number of size intervals used to
c                                     evaluate the effective particle
c                                     deposition velocity
c                 DCONST4 - real    - Empirical constant in particle 
c                                     deposition layer resistance eqn.
c     PDIAM(mxint,mxpdep) - real    - Geometric mean diameter (microns)
c                                     of each interval
c      SC23(mxint,mxpdep) - real    - Schmidt number ** DCONST4
c     VGRAV(mxint,mxpdep) - real    - Gravitational settling velocity
c                                     (m/s)
c     TSTOP(mxint,mxpdep) - real    - Stopping time (s)
c     FRACT(mxint,mxpdep) - real    - Mass fraction in each size interval
c                  VAIRMS - real    - Viscosity of air (m**2/s)
c----------------------------------------------------------------------
c --- COMMON BLOCK /FILNAM/ -- CALPUFF file names               CALPUFF
c----------------------------------------------------------------------
c
      character*132 pufinp,metdat,iscdat,plmdat,puflst,condat,
     1 dfdat,wfdat,visdat,t2ddat,rhodat,lndat,ozdat,vddat,
     2 chemdat,hildat,rctdat,prfdat,sfcdat,rstartb,rstarte,
     3 cstdat,bdydat,flxdat,baldat,bcndat,fogdat,h2o2dat,debug
      character*132 metdatl(mxmetdat)
      character*132 ptdat(mxemdat),ardat(mxemdat),voldat(mxemdat)
      logical lcfiles
c
      common/filnam/nmetdat,imetdat,nptdat,nardat,nvoldat,
     1 pufinp,metdat,metdatl,iscdat,plmdat,puflst,condat,
     2 dfdat,wfdat,visdat,t2ddat,rhodat,ptdat,voldat,ardat,lndat,ozdat,
     3 vddat,chemdat,hildat,rctdat,prfdat,sfcdat,rstartb,rstarte,
     4 cstdat,bdydat,flxdat,baldat,bcndat,fogdat,h2o2dat,debug
      common/fillog/lcfiles
c
c --- COMMON BLOCK /FILNAM/, /FILLOG/ Variables:
c         NMETDAT - integer - Number of names provided in METDATL
c         IMETDAT - integer - Current METDATL file being used
c          NPTDAT - integer - Number of names provided in PTDAT
c          NARDAT - integer - Number of names provided in ARDAT
c         NVOLDAT - integer - Number of names provided in VOLDAT
c          PUFINP - c*132   - Path & filename for the control file
c                             (default: CALPUFF.INP)
c          METDAT - c*132   - Path & filename for the CALMET
c                             binary meteorological file in
c                             CALPUFF/CALGRID format
c                             (default: CALMET.DAT)
cMETDATL(mxmetdat) - c*132   - Path & filename for the LIST of CALMET
c                   array     binary meteorological files
c          ISCDAT - c*132   - Path & filename for the ISC-type of
c                             ASCII meteorological file
c                             (default: ISCMET.DAT)
c          PLMDAT - c*132   - Path & filename for the AUSPLUME-type of
c                             ASCII meteorological file
c                             (default: PLMMET.DAT)
c          PUFLST - c*132   - Path & filename for the output CALPUFF
c                             list file
c                             (default: CALPUFF.LST)
c          CONDAT - c*132   - Path & filename for the output CALPUFF
c                             unformatted concentration file
c                             (default: CONC.DAT)
c           DFDAT - c*132   - Path & filename for the output CALPUFF
c                             unformatted dry deposition flux file
c                             (default: DF.DAT)
c           WFDAT - c*132   - Path & filename for the output CALPUFF
c                             unformatted wet deposition flux file
c                             (default: WF.DAT)
c          VISDAT - c*132   - Path & filename for the output CALPUFF
c                             RH data file for visibility calculations
c                             (default: VISB.DAT)
c          T2DDAT - c*132   - Path & filename for the output CALPUFF
c                             2D Temperature data file for visibility
c                             related processing
c                             (default: TK2D.DAT)
c          RHODAT - c*132   - Path & filename for the output CALPUFF
c                             2D Density data file for visibility
c                             related processing
c                             (default: RHO2D.DAT)
c  PTDAT(mxemdat) - c*132   - Path & filename for the input CALPUFF
c                             file(s) containing point source emissions
c                             with arbitrarily-varying source and
c                             emission parameters
c                             (default: PTEMARB.DAT, for 1 file)
c VOLDAT(mxemdat) - c*132   - Path & filename for the input CALPUFF
c                             file(s) containing volume sources
c                             with arbitrarily-varying source and
c                             emission parameters
c                             (default: VOLEMARB.DAT, for 1 file)
c  ARDAT(mxemdat) - c*132   - Path & filename for the input CALPUFF
c                             file(s) containing buoyant area sources
c                             with arbitrarily-varying location and
c                             emissions
c                             (default: BAEMARB.DAT, for 1 file)
c           LNDAT - c*132   - Path & filename for the input CALPUFF
c                             file containing buoyant line sources
c                             with arbitrarily-varying location and
c                             emissions
c                             (default: LNEMARB.DAT)
c           OZDAT - c*132   - Path & filename for the input CALPUFF
c                             file with hourly ozone monitoring data
c                             (default: OZONE.DAT)
c           VDDAT - c*132   - Path & filename for the input CALPUFF
c                             file with user-specified deposition
c                             velocities
c                             (default: VD.DAT)
c         CHEMDAT - c*132   - Path & filename for the input CALPUFF
c                             file with user-specified chemical
c                             transformation rates
c                             (default: CHEM.DAT)
c          HILDAT - c*132   - Path & filename for the input CALPUFF
c                             file with CTSG hill specifications from
c                             the CTDM terrain processor
c                             (default: HILL.DAT)
c          RCTDAT - c*132   - Path & filename for the input CALPUFF
c                             file with CTSG receptors from the
c                             CTDM receptor generator
c                             (default: HILLRCT.DAT)
c          PRFDAT - c*132   - Path & filename for the input CALPUFF
c                             file for "tower" met data, including
c                             turbulence data
c                             (default: PROFILE.DAT)
c          SFCDAT - c*132   - Path & filename for the input CALPUFF
c                             file of surface parameters
c                             (default: SURFACE.DAT)
c         RSTARTB - c*132   - Path & filename for the RESTART file used
c                             at beginning of continuation run
c         RSTARTE - c*132   - Path & filename for the RESTART file made
c                             during current run (last update at end)
c          CSTDAT - c*132   - Path & filename for the input CALPUFF
c                             file with coast line data used with
c                             sub-grid TIBL module
c                             (default: COASTLN.DAT)
c          BDYDAT - c*132   - Path & filename for the input CALPUFF
c                             file with boundary data used for mass
c                             flux module
c                             (default: FLUXBDY.DAT)
c          FLXDAT - c*132   - Path & filename for the output CALPUFF
c                             file with hourly mass flux data
c                             (default: MASSFLX.DAT)
c          BALDAT - c*132   - Path & filename for the output CALPUFF
c                             file with hourly mass balance data
c                             (default: MASSBAL.DAT)
c          BCNDAT - c*132   - Path & filename for the input CALPUFF
c                             file with boundary condition data
c                             (default: BCON.DAT)
c          FOGDAT - c*132   - Path & filename for the output CALPUFF
c                             file with data for FOG processor
c                             (default: FOG.DAT)
c         H2O2DAT - c*132   - Path & filename for the input CALPUFF
c                             file with hourly H2O2 monitoring data
c                             (default: H2O2.DAT)
c           DEBUG - c*132   - Path & filename for the output CALPUFF
c                             file containing debug puff/slug data
c                             (default: DEBUG.DAT)
c         LCFILES - logical - Switch indicating if all characters in the
c                             filenames are to be converted to lower case
c                             letters (LCFILES=T) or converted to UPPER
c                             case letters (LCFILES=F).
c----------------------------------------------------------------------
c --- COMMON BLOCK /FLAGS/ -- Module control flags              CALPUFF
c----------------------------------------------------------------------
c
      logical ldevel
c
      common/flags/mgauss,mctadj,mctsg,mslug,mtrans,mchem,mdry,mwet,
     1  mdisp,mdisp2,mtauly,mcturb,mturbvw,mrough,mtip,mshear,msplit,
     2  mpartl,mtinv,mhftsz,mpdf,msgtibl,mbcon,mfog,maqchem,mbdw,mreg,
     3  mdepbc,mtilt,mtauadv,ldevel
c
c --- COMMON BLOCK /FLAGS/ Variables:
c
c        MGAUSS - integer - Gaussian vertical distribution in the
c                           near field ?
c                            0 = no  (i.e., uniform distribution assumed
c                                     in the vertical
c                            1 = yes (i.e., Gaussian distribution with
c                                     reflections used)
c        MCTADJ - integer - Terrain adjustment method
c                            0 = no terrain adjustment
c                            1 = ISC-type of terrain adjustment
c                            2 = simple, CALPUFF-type of terrain
c                                adjustment
c                            3 = partial plume height adjustment
c                                using a plume-path coefficient
c                                (e.g. half-height correction)
c         MCTSG - integer - Subgrid-scale complex terrain modeled ?
c                           (0 = no, 1 = yes)
c         MSLUG - integer - Near-field puffs modeled as elongated
c                           "slugs" ?
c                            0 = no  (i.e., circular puffs always used)
c                            1 = yes (i.e., slug model used in the
c                                     near field)
c        MTRANS - integer - Transitional plume rise computed ?
c                            0 = no  (i.e., final rise only)
c                            1 = yes (i.e., transitional rise computed)
c         MCHEM - integer - Chemical transformation mechanism flag
c                            0 = no chemistry
c                            1 = MESOPUFF II transformation scheme
c                            2 = user-specified transformation rates
c                            3 = transformation rates computed
c                                internally (RIVAD/ARM3 scheme)
c          MDRY - integer - Dry deposition modeled ?
c                            0 = no
c                            1 = yes
c          MWET - integer - Wet deposition modeled ?
c                            0 = no
c                            1 = yes
c         MDISP - integer - Method flag for computation of dispersion
c                           coefficients
c                            1 = sigma y, sigma z computed from values
c                                of measured sigma v, sigma w read from
c                                file
c                            2 = sigma y, sigma z computed from micro-
c                                meteorological variables (u*, w*, L)
c                            3 = PG dispersion coefficients for RURAL
c                                areas (computed using the ISCST multi-
c                                segment approximation and MP coef-
c                                ficients in URBAN areas
c                            4 = same as 3 except PG coefficients are
c                                computed using the MESOPUFF II eqns.
c                            5 = CTDM sigmas used for stable and neutral
c                                conditions.  For unstable conditions,
c                                sigmas are computed as in MDISP=1.
c                                MDISP=5 assumes that turbulence data
c                                are read.
c        MDISP2 - integer - Method flag for BACKUP computation of
c                           dispersion coefficients (no meas. turb.)
c                            2 = sigma y, sigma z computed from micro-
c                                meteorological variables (u*, w*, L)
c                            3 = PG dispersion coefficients for RURAL
c                                areas (computed using the ISCST multi-
c                                segment approximation and MP coef-
c                                ficients in URBAN areas
c                            4 = same as 3 except PG coefficients are
c                                computed using the MESOPUFF II eqns.
c        MTAULY - integer - Method flag for assigning Lagrangian time
c                           scale for Fy formulation
c                            0 = Draxler default 617.284 (s)
c                            1 = Computed as Lag. Length / (.75 q)
c                                 -- after SCIPUFF
c                           10 = Direct user input (s)
c       MTAUADV - integer - Method flag for assigning advective-decay
c                           timescale for turbulence advection
c                            0 = No turbulence advection
c                            1 = NOT IMPLEMENTED
c                           10 = Direct user input of timescale (s)
c        MCTURB - integer - Method flag for computating turbulence
c                           sigma-v & sigma-w
c                            1 = Standard CALPUFF subroutines
c                            2 = AERMOD subroutines
c       MTURBVW - integer - Use sigma-v and/or sigma-w measurements?
c                            1 = yes, use sigma-v or sigma-theta
c                                from PROFILE.DAT to compute sigma-y
c                                (valid for METFM=1,2,3,4,5)
c                            2 = yes, use sigma-w measurements
c                                from PROFILE.DAT to compute sigma-z
c                                (valid for METFM=1,2,3,4,5)
c                            3 = yes, use BOTH measurements from
c                                PROFILE.DAT to compute sig-y and sig-z
c                                (valid for METFM=1,2,3,4,5)
c                            4 = yes, use sigma-theta measurements
c                                from PLMMET.DAT to compute sigma-y
c                                (valid only if METFM=3)
c        MROUGH - integer - Roughness adjustment applied to PG sigma-z?
c                            0 = no
c                            1 = yes
c          MTIP - integer - Stack tip downwash modeled ?
c                            0 = no
c                            1 = yes
c        MSHEAR - integer - vertical wind shear above stack top
c                           modeled in plume rise?
c                            0 = no
c                            1 = yes
c        MSPLIT - integer - Split puffs in vertical to track vertical
c                           wind shear ?
c                            0 = no
c                            1 = yes
c        MPARTL - integer - partial penetration of elevated inversion
c                           modeled ?
c                            0 = no
c                            1 = yes
c        MTINV  - integer - Strength of inversion above CBL read from
c                           PROFILE.DAT for partial penetration?
c                            0 = no
c                            1 = yes
c        MHFTSZ - integer - Heffter sigma-z growth at large distance
c                           modeled ?
c                            0 = no
c                            1 = yes
c          MPDF - integer - Prob. Dist. Fcn. used for Convective B.L. ?
c                            0 = no
c                            1 = yes
c         MBCON - integer - Boundary Conditions (concentration) applied ?
c                            0 = no
c                            1 = yes, BCON.DAT file
c                            2 = yes, CONC.DAT file
c       MSGTIBL - integer - Sub-Grid TIBL module used for shoreline ?
c                            0 = no
c                            1 = yes
c          MFOG - integer - FOG model computations ?
c                            0 = no
c                            1 = Plume-length Mode
c                            2 = Receptor Mode
c       MAQCHEM - integer - Aqueous phase transformation flag
c                           (Valid for MCHEM = 1 or 3)
c                            0 = no aqueous phase transformation
c                            1 = transformation rates adjusted
c                                for aqueous phase reactions
c          MBDW - integer - Method to simulate buiding downwash
c                            1 = ISC method
c                            2 = PRIME method
c          MREG - integer - Impose regulatory options?
c                            0 = no
c                            1 = yes - USEPA short range (e.g.ISC)
c                            2 = yes - USEPA long range/visibility
c                            3 = yes - Australia EPA short range
c        MDEPBC - integer  - Flag for concentration profile adj. for
c                            surface depletion effects with BC puffs
c                            0: Do not adjust
c                            1: Adjust for depletion
c         MTILT - integer - Gravitational settling (plume tilt)?
c                           (puff center falls at the gravitational
c                            settling velocity for 1 particle species)
c                            0 = no
c                            1 = yes
c        LDEVEL - logical - Report output associated with new features
c                            or options currently under development
c-----------------------------------------------------------------------
c --- COMMON BLOCK /FLVAR/ --- FLOPUFF Variables                 CALPUFF
c-----------------------------------------------------------------------

      REAL*4 LX,LY,LXI,LYI,LXI2,LYI2,LYI3,LZ,LZI,LN,LNI
      COMMON/FLVAR/     LX,LY,LXI, LXI2, LYI, LYI2, LYI3, LZI,
     1                  LZ, LN, LNI, HASYM, BVUI, BVUI2, S, S2, B0N2,
     2                  B0, B02, FR,
     3                  GAM, HH
C-----------------------------------------------------------------------
C     DEFINITIONS       [i]=integer     [r]=real        [a]=array
C-----------------------------------------------------------------------
C LX (m)            LENGTH SCALE OF HILL IN THE X-DIRECTION          [r]
C LY (m)            LENGTH SCALE OF HILL IN THE Y-DIRECTION          [r]
C LXI,LXI2          1/LX AND 1/LX**2                                 [r]
C       (m^-1[2])
C LYI,LYI(2,3)      1/LY, 1/LY**2, 1/LY**3                           [r]
C     (m^-1[2,3])
C LZ,LZI (m),(1/m)  VERTICAL LENGTH SCALE AND ITS INVERSE            [r]
C LN,LNI (m),(1/m)  ABOVE, SCALED .5*SQRT(PI)                        [r]
C HASYM             HILL ASYMMETRY FACTOR                            [r]
C BVUI,BVUI2        BRUNT-VAISALA FREQ/U, AND ITS SQUARE             [r]
C       (m^-1[2])
C S,S2              STRATIFICATION FACTOR, AND ITS SQUARE            [r]
C B0N2              SQUARE OF NEUTRAL VALUE OF PARAMETER B0          [r]
C B0,B02            STRATIFIED VALUE OF PARAMETER B0, AND ITS SQUARE [r]
C FR                FROUDE NUMBER FOR CUT-OFF HILL                   [r]
C GAM (m^-2)        ROTATION TERM                                    [r]
C HH (m)            HEIGHT OF HILL AT THE CREST (THE CUT-OFF HILL)   [r]
C-----------------------------------------------------------------------
c----------------------------------------------------------------------
c --- COMMON BLOCK /FOG/ -- FOG option data                     CALPUFF
c----------------------------------------------------------------------
c
      parameter (mxpt=mxpt1+mxpt2)
      real xrfog(mxrfog)
      real zrfog(mxrfog,mxpt)
      integer ipcp(51), ifdays(366), ipfog(mxpt)
      character*20 ftitle(4)
      logical lpmode,ladtfog
c
      common/FOG/ftitle,nfrec,nfpts,ipcp,ifyr,ifdays,nipfog,ipfog,
     &           xrfog,zrfog,issta,ixsrc,iysrc,txsmxfog,
     &           lpmode,ladtfog
c
c --- COMMON BLOCK /FOG/ Variables:
c --------------------------------------------------------------------
c --- Output file header variables
c --------------------------------
c      FTITLE - character*4  - Title line for FOG output file
c       NFREC - integer      - Number of discrete receptors (ndrec)
c       NFPTS - integer      - Number of point sources
c        IPCP - integer      - Array of 51*0 (not used in Fog Model)
c        IFYR - integer      - Year of simulation (assumes only 1 year)
c      IFDAYS - integer      - Days to process in year 
c                                0:  Do Not Process Day
c                                1:  Process Day
c                             (All days set to 0 to signal CALPUFF run)
c      LPMODE - logical      - Plume-mode indicator (T/F)
c --------------------------------------------------------------------
c --- Computational variables (Plume Mode)
c ----------------------------------------
c      NIPFOG - integer      - Number of active fog sources this hour
c       IPFOG - integer      - Puff index for first puff released
c                              from each active source this hour
c       XRFOG - real         - Receptor distances from source (m)
c                              for output -- MXRFOG values
c       ZRFOG - real         - Receptor height (m AGL) at the XRFOG
c                              distances for each each source
c --------------------------------------------------------------------
c --- Computational variables 
c ----------------------------
c       ISSTA - integer      - Surface met station nearest source
c IXSRC,IYSRC - integer      - Met grid cell nearest sources
c    TXSMXFOG - real         - Maximum temperature excess (K) allowed
c                              when summing contributions at receptor
c     LADTFOG - logical      - Use summmed temperature excess at
c                              receptor, from all puffs (T/F)
c----------------------------------------------------------------------
c --- COMMON BLOCK /GEN/ -- General run control information,    CALPUFF
c                           file types
c----------------------------------------------------------------------
c
      character*12 cspec,cgrup
c
      common/gen/ibyr,ibmo,ibdy,ibhr,irlg,nspec,nsdd,nse,ngrup,
     1 isplst(4,mxspec),cspec(mxspec),xmol(mxspec),cgrup(mxgrup),
     2 ispgrp(mxspec),metfm,mprffm,metrun,mrestart,nrespd
c
c --- COMMON BLOCK /GEN/ Variables:
c             IBYR - integer - Beginning year of run (4 digits)
c             IBMO - integer - Beginning month of run
c             IBDY - integer - Beginning day of run
c             IBHR - integer - Beginning hour of run
c             IRLG - integer - Run length (hours)
c            NSPEC - integer - Total number of chemical species
c                              (advected + steady-state species)
c             NSDD - integer - Number of species dry deposited
c              NSE - integer - Number of species emitted
c            NGRUP - integer - Number of Species-Groups
c ISPLST(4,mxspec) - integer - Flags indicating which species are
c                              (1,-)=modeled, (2,-) emitted (0=NO, 1=YES),
c                              (3,-)=dry deposition flag (0=no dep.,
c                              1=resistance model (gas), 2=resistance
c                              model (particle), 3=user-specified)
c                              (4,-)=species-group flag (0=not in group,
c                              1=group1, 2=group2, etc.)
c    CSPEC(mxspec) - char*12 - List of chemical species
c     XMOL(mxspec) - real    - Molecular weight for each species
c    CGRUP(mxgrup) - char*12 - List of names for grouped species
c   ISPGRP(mxspec) - integer - Index of group to which species belong
c            METFM - integer - Meteorological data input format flag
c                                 1 = CALMET/AUSMET binary format
c                                     (CALMET.DAT, AUSMET.DAT)
c                                 2 = ISC ASCII file (ISCMET.DAT)
c                                 3 = AUSPLUME ASCII file (PLMMET.DAT)
c                                 4 = CTDM PROFILE & SURFACE files
c                                 5 = AERMET PROFILE & SURFACE files
c           MPRFFM - integer - Meteorological Profile Data Format
c                                 1 = CTDM plus tower file (PROFILE.DAT)
c                                 2 = AERMET tower file (PROFILE.DAT)
c           METRUN - integer - Option to run ALL of the met periods
c                              found in the met files
c                                 0 = Run period defined by the user
c                                 1 = Run all periods found
c         MRESTART - integer - Option to create/use a restart file
c                                 0 = No restart files read or written
c                                 1 = Old restart file used at start
c                                     of a continuation run with "old"
c                                     puffs from the preceding period;
c                                 2 = New restart file made during run
c                                 3 = Old restart file used at start
c                                     of a continuation run with "old"
c                                     puffs from the preceding period;
c                                     << AND >>
c                                     New restart file made during run
c           NRESPD - integer - Number of periods in Restart output cycle
c                                 0 = File written only at last period
c                                >0 = File updated every NRESPD periods
c----------------------------------------------------------------------
c --- COMMON BLOCK /GRID/ -- Grid parameters                    CALPUFF
c----------------------------------------------------------------------
c
      logical lsamp
c
      common/GRID/nx,ny,nz,dgrid,dgridi,xorig,yorig,
     1 zface(mxnzp1),xtz,ibcomp,jbcomp,iecomp,jecomp,
     2 lsamp,ibsamp,jbsamp,iesamp,jesamp,meshdn,nxcmp,nycmp,
     3 nxsam,nysam,delsam,sam2grid,nxm1,nxm2,nym1,nym2,nzp1,
     4 zgpt(mxnz),elevg(mxnxg,mxnyg),relief(5,mxnx,mxny),
     5 dzval,ivalw(mxvalz,mxnx,mxny),
     6 xlatm(mxnx,mxny),xlonm(mxnx,mxny)
c
c --- COMMON BLOCK /GRID/ Variables:
c              NX - integer    - Number of METEOROLOGICAL grid points
c                                in X direction
c              NY - integer    - Number of METEOROLOGICAL grid points
c                                in Y direction
c              NZ - integer    - Number of vertical levels
c           DGRID - real       - METEOROLOGICAL grid spacing (m)
c          DGRIDI - real       - 1./DGRID
c           XORIG - real       - Reference X coordinate (m) of
c                                southwest corner of grid
c           YORIG - real       - Reference Y coordinate (m) of
c                                southwest corner of grid
c   ZFACE(mxnzp1) - real       - Cell face heights (m) (NZP1 values)
c             XTZ - real       - Base time zone
c                                (5.=EST, 6.=CST, 7.=MST, 8.=PST)
c          IBCOMP - integer    - Element number of the met. grid
c                                defining the beginning of the
c                                computational grid in the X direction
c          JBCOMP - integer    - Element number of the met. grid
c                                defining the beginning of the
c                                computational grid in the Y direction
c          IECOMP - integer    - Element number of the met. grid
c                                defining the end of the computational
c                                grid in the X direction
c          JECOMP - integer    - Element number of the met. grid
c                                defining the end of the computational
c                                grid in the Y direction
c           LSAMP - logical    - Flag indicating if gridded receptor
c                                (sampling) grid is used (T=yes, F=no)
c          IBSAMP - integer    - Element number of the met. grid
c                                defining the beginning of the
c                                sampling grid in the X direction
c          JBSAMP - integer    - Element number of the met. grid
c                                defining the beginning of the
c                                sampling grid in the Y direction
c          IESAMP - integer    - Element number of the met. grid
c                                defining the end of the sampling
c                                grid in the X direction
c          JESAMP - integer    - Element number of the met. grid
c                                defining the end of the sampling
c                                grid in the Y direction
c          MESHDN - integer    - Nesting factor of the sampling grid.
c                                The sampling grid spacing (in meters)
c                                is DGRID/MESHDN
c
c --- Computed variables
c           NXCMP - integer    - Number of COMPUTATIONAL grid points in
c                                the X direction
c           NYCMP - integer    - Number of COMPUTATIONAL grid points in
c                                the Y direction
c           NXSAM - integer    - Number of SAMPLING grid points in the
c                                X direction
c           NYSAM - integer    - Number of SAMPLING grid points in the
c                                Y direction
c          DELSAM - real       - SAMPLING grid spacing (m)
c        SAM2GRID - real       - SAMPLING grid spacing (met grid)
c            NZP1 - integer    - Number of vertical cell faces (NZ+1)
c            NXM1 - integer    - NX-1
c            NXM2 - integer    - NX-2
c            NYM1 - integer    - NY-1
c            NYM2 - integer    - NY-2
c      ZGPT(mxnz) - real       - Grid point heights (m) (NZ values)
c
c --- Terrain for Gridded Receptors
c ELEVG(mxngx,mxngy) - real    - Terrain elevation (m MSL) at rec.
c
c --- Local Terrain Relief and Valley Width for MCTADJ = 2
c RELIEF(5,mxnx,mxny) - real   - Local terrain elevation differences (m)
c                                along 4 directions for each Met cell
c                                1: N/S
c                                2: NE/SW
c                                3: E/W
c                                4: SE/NW
c                                And
c                                5: the peak elevation (m MSL)
c           DZVAL - real       - Height increment (m) for the MXVALZ
c                                elements stored in IVALW array
c IVALW(mxvalz,mxnx,mxny)
c                 - integer    - Local valley width (met grid cells)
c      XLATM(mxnx,mxny) - real - N.Latitude of MET gridpoints 
c      XLONM(mxnx,mxny) - real - W.Longitude of MET gridpoints 
c-----------------------------------------------------------------------
c --- COMMON BLOCK /HEADBC2/ --- MBCON=2 CONC.DAT Header        CALPUFF
c-----------------------------------------------------------------------
c --- After HEAD.PST from CALPOST:  Add BC to each variable name
c ---                               Add logicals for D and CT receptors
c ----------------------------------------------------------------------
      logical LSGRIDBC,LCOMPRSBC
      logical ldiscBC,lctsgBC
      character*6 avtimeBC
      character*12 amodelBC,averBC,alevBC
      character*15 asplstBC(mxspec)
      character*80 atitleBC(3)

      character*4 utmhemBC
      character*8 datumBC,pmapBC
      character*12 datenBC
      character*16 clat0BC,clon0BC,clat1BC,clat2BC

      common/headbc2/msyrBC,mjsdayBC,mshrBC,mssecBC,nsecdtBC,
     *            mnrunBC,mavgpdBC,mnperBC,mavgBC,ipverBC,irhverBC,
     *            ielmetBC,jelmetBC,delxBC,delyBC,nzBC,
     *            xorigkmBC,yorigkmBC,nsstaBC,
     *            iastarBC,iastopBC,jastarBC,jastopBC,
     *            isastrBC,isastpBC,jsastrBC,jsastpBC,
     *            ngxBC,ngyBC,ngrecBC,
     *            meshdnBC,nptsBC,nareasBC,nlinesBC,nvolsBC,
     *            ndrecBC,nctrecBC,LSGRIDBC,ldiscBC,lctsgBC,nszoutBC,
     *            xgrdBC(mxnxg,mxnyg),ygrdBC(mxnxg,mxnyg),
     *            xrecBC(mxrec),yrecBC(mxrec),zrecBC(mxrec),
     *            xctrBC(mxrect),yctrBC(mxrect),zctrBC(mxrect),
     *            ihillBC(mxrect),
     *            xkmstaBC(mxss),ykmstaBC(mxss),nearsBC(mxnxg,mxnyg),
     *            lcomprsBC,i2drhBC,iutmznBC,feastBC,fnorthBC,
     *            rnlat0BC,relon0BC,xlat1BC,xlat2BC,
     *            amodelBC,averBC,alevBC,atitleBC,avtimeBC,asplstBC,
     *            pmapBC,utmhemBC,datumBC,datenBC,
     *            clat0BC,clon0BC,clat1BC,clat2BC
c-----------------------------------------------------------------------
c     DEFINITIONS       [i]=integer     [r]=real        [a]=array
c                       [c]=character   [L]=logical
c-----------------------------------------------------------------------
c ldiscBC       Discrete receptors in file? (T/F)
c lctsgBC       CTSG receptors in file? (T/F)
c-----------------------------------------------------------------------
c msyr,mjsday,  Starting time of run: yr, Julian day, hour, second   [i]
c   mshr,mssec
c nsecdt        Number of seconds in one model step                  [i]
c mnrun         Number of model steps in model run                   [i]
c mavgpd        Averaging time in model steps for results reported   [i]
c               by model
c mnper         Number of averaging periods contained in model output[i]
c mavg          Averaging time in AVTIME units                       [i]
c               computed as  mavg*nsecdt/[1, 60, or 3600]seconds
c ipver         CALPUFF output file version flag                     [i]
c               0:  Current version with begin-time/end-time format
c               1:  Older version with end-time format
c irhver        CALPUFF VISB file version flag                       [i]
c ielmet        Number of met. grid points (x-direction)             [i]
c jelmet        Number of met. grid points (y-direction)             [i]
c delx (km)     Grid spacing in x-direction                          [r]
c dely (km)     Grid spacing in y-direction                          [r]
c nz            Number of layers (=1 for CALPUFF)                    [i]
c iastar        Start of computational grid (x-direction)            [i]
c iastop        End of computational grid (x-direction)              [i]
c jastar        Start of computational grid (y-direction)            [i]
c jastop        End of computational grid (y-direction)              [i]
c isastr        Start of sampling grid (x-direction)                 [i]
c isastp        End of sampling grid (x-direction)                   [i]
c jsastr        Start of sampling grid (y-direction)                 [i]
c jsastp        End of sampling grid (y-direction)                   [i]
c ngx,ngy       Actual dimensions of gridded receptor array          [i]
c ngrec         Actual number of gridded receptors                   [i]
c meshdn        Sampling grid spacing factor                         [i]
c npts          Number of point sources                              [i]
c nareas        Number of area sources                               [i]
c ndrec         Number of discrete receptors                         [i]
c nctrec        Number of complex terrain receptors                  [i]
c LSGRID        Gridded receptors included? (T=yes)                  [L]
c nszout        Number of chemical species/level combinations        [i]
c xgrd (km)     X-coordinate gridded receptors                      [ra]
c ygrd (km)     Y-coordinate gridded receptors                      [ra]
c xrec (km)     X-coordinate discrete receptors                     [ra]
c yrec (km)     Y-coordinate discrete receptors                     [ra]
c zrec (m)      Height of discrete receptors above sea level        [ra]
c xctr (km)     X-coordinate discrete receptors (complex terrain)   [ra]
c yctr (km)     Y-coordinate discrete receptors (complex terrain)   [ra]
c zctr (m)      Height of complex terrain receptors above sea level [ra]
c ihill         Hill identification number for complex terrain      [ia]
c               receptors
c lcomprs       Logical indicating whether data on disk are          [L]
c               compressed
c i2drh         Flag for 2D array of relative humidity               [i]
c amodel        Name of the model used to produce concentrations     [c]
c aver          Version number of model                              [c]
c alev          Level of revision of model                           [c]
c atitle        Title for run                                       [ca]
c avtime        Averaging time units (second, minute, or hour)       [c]
c asplst        List of species/level names                         [ca]
c-----------------------------------------------------------------------
c IUTMZN        - integer   - UTM zone for UTM projection
c FEAST  (km)   - real      - False Easting at projection origin
c FNORTH (km)   - real      - False Northing at projection origin
c RNLAT0,       - real      - N. latitude & E. longitude of x=0 and y=0
c RELON0 (deg)                of map projection (Used only if PMAP =
c                             LCC, PS, EM, TTM or LAZA) 
c                             NOTE: longitude neg in western hemisphere
c XLAT1,        - real      - Matching N. latitude(s) for projection
c XLAT2 (deg)                 (Used only if PMAP= LCC, PS, or EM)
c                             LCC :  Projection cone slices through
c                                    Earth's surface at XLAT1 and XLAT2
c                             PS  :  Projection plane slices through
c                                    Earth at XLAT1
c                             EM  :  Projection cylinder slices through
c                                    Earth at [+/-] XLAT1
c-----------------------------------------------------------------------
c PMAP          - character - Character code for output map projection
c                             UTM :  Universal Transverse Mercator
c                             LCC :  Lambert Conformal Conic
c                             PS  :  Polar Stereographic
c                             EM  :  Equatorial Mercator
c                             LAZA:  Lambert Azimuthal Equal Area
c                             TTM :  Tangential Transverse Mercator
c UTMHEM        - character - Base hemisphere for UTM projection
c                             (S=southern, N=northern)
c DATUM         - character - Datum-Region for grid coordinates
c DATEN         - character - NIMA date for datum parameters
c                             (MM-DD-YYYY  )
c CLAT0         - character - Character version of RNLAT0
c CLON0         - character - Character version of RELON0
c CLAT1         - character - Character version of XLAT1
c CLAT2         - character - Character version of XLAT2
c-----------------------------------------------------------------------
c----------------------------------------------------------------------
c --- COMMON BLOCK /LN1/ -- Emission parameters for buoyant     CALPUFF
c                           line sources
c----------------------------------------------------------------------
      character*16 cnamln1
c
      common/LN1/NLINES,XL,HBL,WBL,WML,DXL,FPRIMEL,WSEP,FPTOT,FBPT,
     1 XLBEGGRD(mxlines),YLBEGGRD(mxlines),XLENDGRD(mxlines),
     2 YLENDGRD(mxlines),HSL(mxlines),BELEVL(mxlines),
     3 XVERTL(4,mxlines),YVERTL(4,mxlines),ARLINE(mxlines),
     4 XLBAR,YLBAR,ORIENTL,MXNSEG,NSEG(mxlines),QTL(mxspec,mxlines),
     5 NEWLN1(mxlines),NLRISE,XLRISE(mxrise,2),ZLRISE(mxrise,2),
     6 ILNU,ivln1(mxspec,mxlines),iq12ln1(mxspec,mxlines),
     7 CNAMLN1(mxlines)
c
c --- COMMON BLOCK /LINES/ variables:
c                NLINES - integer    - Number of line sources
c                    XL - real       - Average line source length (m)
c                   HBL - real       - Average line source height (m)
c                   WBL - real       - Average building width (m)
c                   WML - real       - Average line source width (m)
c                   DXL - real       - Average building separation (m)
c               FPRIMEL - real       - Average buoyancy parameter/line
c                                      in units of (m**4/s**3)
c                  WSEP - real       - Average separation between lines
c                                      (WBL+DXL)  (m)
c                 FPTOT - real       - Total buoyancy parameter
c                                      (FPRIMEL*NLINES)
c                  FBPT - real       - "Point Source" buoyancy parameter
c                                      (FPTOT/pi)
c     XLBEGGRD(mxlines) - real array - Beginning X coordinate of the lines
c                                      (in met. grid units w/ origin at
c                                      (0.0,0.0))
c     YLBEGGRD(mxlines) - real array - Beginning Y coordinate of the lines
c                                      (in met. grid units w/ origin at
c                                      (0.0,0.0))
c     XLENDGRD(mxlines) - real array - Ending X coordinate of the lines
c                                      (in met. grid units w/ origin at
c                                      (0.0,0.0))
c     YLENDGRD(mxlines) - real array - Ending Y coordinate of the lines
c                                      (in met. grid units w/ origin at
c                                      (0.0,0.0))
c          HSL(mxlines) - real array - Pollutant release height (m)
c       BELEVL(mxlines) - real array - Base elevation (MSL) of line
c     XVERTL(4,mxlines) - real array - X-coord. (met grid) of vertices
c                                      defining 4 corners of each line
c     YVERTL(4,mxlines) - real array - Y-coord. (met grid) of vertices
c                                      defining 4 corners of each line
c       ARLINE(mxlines) - real array - Area of line source (m**2)
c           XLBAR,YLBAR - real       - Center of array of lines (met grid)
c               ORIENTL - real       - Orientation of array of lines
c                                      (radians, CW from N)
c                MXNSEG - integer    - Upper limit on number of segments
c                                      along line from which slugs are
c                                      generated
c         NSEG(mxlines) - real array - Number of segments used for line
c                                      in current step
c   QTL(mxspec,mxlines) - real array - Pollutant emission rates (g/s)
c                                      for each line
c       NEWLN1(mxlines) - integer arr- Number of puffs released by each
c                                      source during the current step
c                NLRISE - integer    - Number of points used to tabulate
c                                      plume rise from block of lines
c      XLRISE(mxrise,2) - real array - Distance from furthest upwind
c                                      part of group of line sources,
c                                      to points at which rise is
c                                      tabulated (m); element 2=1 is for
c                                      current met., element 2=2 is for
c                                      previous period of met.
c      ZLRISE(mxrise,2) - real array - Computed rise at each XLRISE dist,
c                                      for puff released at the point
c                                      farthest upwind (m); element 2=1
c                                      is for current met., element 2=2
c                                      is for previous period of met.
c                       - ** note ** - Element 1 is at "XFB", the point
c                                      in the group of line sources that
c                                      is furthest downwind, while element
c                                      NLRISE is at final rise.
c                  ILNU - integer    - Units for emission rates in
c                                      control file
c                                      1:   g/s
c                                      2:  kg/hr
c                                      3:  lb/hr
c                                      4:  ton/yr
c                                      5:  Odour Unit * m**3/s
c                                      6:  Odour Unit * m**3/min
c IVLN1(mxspec,mxlines) - integer arr- IVARY flag defining how emission
c                                      rate scaling factors vary
c                                      0:  NO variation
c                                      1:  Diurnal (24 values)
c                                      2:  Monthly (12 values)
c                                      3:  Hour & Season (96 values)
c                                      4:  Speed & Stability (36 values)
c                                      5:  Temperature (12 values)
c IQ12LN1(mxspec,mxlines) - int. arr - Pointer for starting address in
c                                      VQFAC array to assign scaling
c                                      factors for this source/species
c        CNAMLN1(mxlines) - c*16 arr - Source names
c----------------------------------------------------------------------
c --- COMMON BLOCK /LN2/ -- Emission parameters for buoyant     CALPUFF
c                           line sources (variable)
c----------------------------------------------------------------------
c
      character*12 fname5,label5,cslst5
      character*16 cid5
c
      common/LN2/FNAME5,NLN2,NSE5,XNLAT1LN2,XNLAT2LN2,RNLAT0LN2,
     1 RWLON0LN2,IVRS5,IBDAT5,IBTIM5,IEDAT5,IETIM5,
     2 LABEL5,CSLST5(mxspec),XMWEM5(mxspec),IXREM5(mxspec),
     3 CID5(mxlines),MXNSEG2,NLRISE2,IBEG5,IEND5,NLINES2,NL2(mxlngrp),
     4 XL2(mxlngrp),HBL2(mxlngrp),WBL2(mxlngrp),WML2(mxlngrp),
     5 DXL2(mxlngrp),FPRIMEL2(mxlngrp),WSEP2(mxlngrp),FPTOT2(mxlngrp),
     6 FBPT2(mxlngrp),XL2BAR(mxlngrp),YL2BAR(mxlngrp),ORIENTL2(mxlngrp),
     7 ILNGRP(mxlines),XL2BEGGRD(mxlines),YL2BEGGRD(mxlines),
     8 XL2ENDGRD(mxlines),YL2ENDGRD(mxlines),HSL2(mxlines),
     9 BELEVL2(mxlines),XVERTL2(4,mxlines),YVERTL2(4,mxlines),
     & ARLINE2(mxlines),NSEG2(mxlines),QTL2(mxspec,mxlines),
     1 NEWLN2(mxlines),
     2 XLRISE2(mxrise,2,mxlngrp),ZLRISE2(mxrise,2,mxlngrp)
c
c --- COMMON BLOCK /LN2/ variables:
c
c           FNAME5 - char*12  - Data set name "LNEMARB"
c             NLN2 - integer  - Total number of line sources
c             NSE5 - integer  - Number of emitted species in file
c        XNLAT1LN2 - real     - Standard parallel #1 for LC map
c                               projection (degrees N. Latitude)
c        XNLAT2LN2 - real     - Standard parallel #1 for LC map
c                               projection (degrees N. Latitude)
c        RNLAT0LN2 - real     - N. Latitude of origin of LC map
c                               projection (degrees)
c        RWLON0LN2 - real     - W. Longitude of origin of LC map
c                               projection (degrees)
c            IVRS5 - integer  - Data set version expressed as integer
c                               (5.4 is 54)
c           IBDAT5 - integer  - Date of the first data record in the
c                               file  (YYJJJ, where YY=year,
c                               JJJ=Julian day)
c           IBTIM5 - integer  - Hour of the first data record in the
c                               file  (00-23 LST)
c           IEDAT5 - integer  - Date of the last data record in the
c                               file  (YYJJJ, where YY=year,
c                               JJJ=Julian day)
c           IETIM5 - integer  - Hour of the last data record in the
c                               file  (00-23 LST)
c           LABEL5 - char*12  - Data set label
c   CSLST5(mxspec) - char*12  - Species identifiers
c   XMWEM5(mxspec) - real ar  - Species molecular weight
c   IXREM5(mxspec) - int ar   - Cross-referencing array of "NSE5"
c                               values relating species ordering
c                               in the emissions file to the
c                               ordering in the main conc. array
c    CID5(mxlines) - char*16  - Line source names
c          MXNSEG2 - integer  - Upper limit on number of segments
c                               along line from which slugs are
c                               generated
c          NLRISE2 - integer  - Number of points used to tabulate
c                               plume rise from group of lines
c
c ---  Variable data  -------------------------------------------------
c
c                 IBEG5 - integer    - Starting time for which emissions
c                                      data in current set of
c                                      records is valid (YYJJJHH)
c                 IEND5 - integer    - Ending time for which emissions
c                                      data in current set of
c                                      records is valid (YYJJJHH)
c               NLINES2 - integer    - Number of active line sources
c
c ---  Group Properties
c
c          NL2(mxlngrp) - int  array - Number of lines in each group
c          XL2(mxlngrp) - real array - Average line source length (m)
c         HBL2(mxlngrp) - real array - Average line source height (m)
c         WBL2(mxlngrp) - real array - Average building width (m)
c         WML2(mxlngrp) - real array - Average line source width (m)
c         DXL2(mxlngrp) - real array - Average building separation (m)
c     FPRIMEL2(mxlngrp) - real array - Average buoyancy parameter/line
c                                      in units of (m**4/s**3)
c        WSEP2(mxlngrp) - real array - Average separation between lines
c                                      (WBL+DXL)  (m)
c       FPTOT2(mxlngrp) - real array - Total buoyancy parameter
c                                      (FPRIMEL*NLINES)
c        FBPT2(mxlngrp) - real array - "Point Source" buoyancy parameter
c                                      (FPTOT/pi)
c       XL2BAR(mxlngrp) - real array - X-center of group (met grid)
c       YL2BAR(mxlngrp) - real array - Y-center of group (met grid)
c     ORIENTL2(mxlngrp) - real array - Orientation of group
c                                      (radians, CW from N)
c ---  Line Properties
c
c       ILNGRP(mxlines) - int array  - Group ID for each line
c    XL2BEGGRD(mxlines) - real array - Beginning X coordinate of the lines
c                                      (in met. grid units w/ origin at
c                                      (0.0,0.0))
c    YL2BEGGRD(mxlines) - real array - Beginning Y coordinate of the lines
c                                      (in met. grid units w/ origin at
c                                      (0.0,0.0))
c    XL2ENDGRD(mxlines) - real array - Ending X coordinate of the lines
c                                      (in met. grid units w/ origin at
c                                      (0.0,0.0))
c    YL2ENDGRD(mxlines) - real array - Ending Y coordinate of the lines
c                                      (in met. grid units w/ origin at
c                                      (0.0,0.0))
c         HSL2(mxlines) - real array - Pollutant release height (m)
c      BELEVL2(mxlines) - real array - Base elevation (MSL) of line
c    XVERTL2(4,mxlines) - real array - X-coord. (met grid) of vertices
c                                      defining 4 corners of each line
c    YVERTL2(4,mxlines) - real array - Y-coord. (met grid) of vertices
c                                      defining 4 corners of each line
c      ARLINE2(mxlines) - real array - Area of line source (m**2)
c        NSEG2(mxlines) - real array - Number of segments used for line
c                                      in current step
c  QTL2(mxspec,mxlines) - real array - Pollutant emission rates (g/s)
c                                      for each line
c       NEWLN2(mxlines) - integer arr- Number of puffs released by each
c                                      source during the current step
c     XLRISE2(mxrise,2,mxlngrp)
c                       - real array - Distance from furthest upwind
c                                      part of group of line sources,
c                                      to points at which rise is
c                                      tabulated (m); element 2=1 is for
c                                      current met., element 2=2 is for
c                                      previous period of met.
c     ZLRISE2(mxrise,2,mxlngrp)
c                       - real array - Computed rise at each XLRISE2,
c                                      for puff released at the point
c                                      farthest upwind (m); element 2=1
c                                      is for current met., element 2=2
c                                      is for previous period of met.
c                       - ** note ** - Element 1 is at "XFB", the point
c                                      in the group of line sources that
c                                      is furthest downwind, while element
c                                      NLRISE2 is at final rise.
c----------------------------------------------------------------------
c --- COMMON BLOCK /MAP/ -- Map Projection & Datum              CALPUFF
c----------------------------------------------------------------------
      logical*4 lutm,llcc,lps,lem,llaza,lttm
      character*4 utmhem
      character*8 datum,pmap
      character*12 daten
      character*16 clat0,clon0,clat1,clat2
c
      common/map/lutm,llcc,lps,lem,llaza,lttm,
     &           iutmzn,feast,fnorth,
     &           rnlat0,relon0,rlat0,rlon0,xlat1,xlat2,
     &           pmap,utmhem,datum,daten,clat0,clon0,clat1,clat2
c
c --- COMMON BLOCK /MAP/ Variables:
c
c LUTM          - logical*4 - Flag for Universal Transverse Mercator
c LLCC          - logical*4 - Flag for Lambert Conformal Conic
c LPS           - logical*4 - Flag for Polar Stereographic
c LEM           - logical*4 - Flag for Equatorial Mercator
c LLAZA         - logical*4 - Flag for Lambert Azimuthal Equal Area
c LTTM          - logical*4 - Flag for Tangential Transverse Mercator
c
c IUTMZN        - integer   - UTM zone for UTM projection
c FEAST  (km)   - real      - False Easting at projection origin
c FNORTH (km)   - real      - False Northing at projection origin
c RNLAT0,       - real      - N. latitude & E. longitude of x=0 and y=0
c RELON0 (deg)                of map projection (Used only if PMAP =
c                             LCC, PS, EM, TTM or LAZA) 
c                             NOTE: longitude neg in western hemisphere
c RLAT0,RLON0   - real      - N. latitude & W. longitude of x=0 and y=0
c                             of map projection (degrees, + = N,W)
c                             (Much of code written for W. Longitude,
c                              so RLAT0=RNLAT0 and RLON0=-RELON0
c XLAT1,        - real      - Matching N. latitude(s) for projection
c XLAT2 (deg)                 (Used only if PMAP= LCC, PS, or EM)
c                             LCC :  Projection cone slices through
c                                    Earth's surface at XLAT1 and XLAT2
c                             PS  :  Projection plane slices through
c                                    Earth at XLAT1
c                             EM  :  Projection cylinder slices through
c                                    Earth at [+/-] XLAT1
c PMAP          - character - Character code for output map projection
c                             UTM :  Universal Transverse Mercator
c                             LCC :  Lambert Conformal Conic
c                             PS  :  Polar Stereographic
c                             EM  :  Equatorial Mercator
c                             LAZA:  Lambert Azimuthal Equal Area
c                             TTM :  Tangential Transverse Mercator
c UTMHEM        - character - Base hemisphere for UTM projection
c                             (S=southern, N=northern)
c DATUM         - character - Datum-Region for grid coordinates
c DATEN         - character - NIMA date for datum parameters
c                             (MM-DD-YYYY  )
c CLAT0         - character - Character version of RNLAT0
c CLON0         - character - Character version of RELON0
c CLAT1         - character - Character version of XLAT1
c CLAT2         - character - Character version of XLAT2

c----------------------------------------------------------------------
c --- COMMON BLOCK /METHD/ -- Header record information from    CALPUFF
c                             meteorological data file(s)
c----------------------------------------------------------------------
c
      logical lcalgrd
      logical*4 llconfm
      character*8 levmet
      character*4 utmhemm
      character*8 datumm,pmapm
      character*12 datenm
c
      common/METHD/levmet,dversm,nxm,nym,nzm,xgridm,xorigm,yorigm,
     1 xbtzm,xlat0m,xlon0m,llconfm,rlat0m,rlon0m,xlat1m,xlat2m,
     2 nssta,nusta,npsta,nlu,iwat1,iwat2,zfacem(mxnzp1),
     3 xssta(mxss),yssta(mxss),xlatss(mxss),xlonss(mxss),
     4 xusta(mxus),yusta(mxus),xpsta(mxps),ypsta(mxps),
     5 z0(mxnx,mxny),ilandu(mxnx,mxny),elev(mxnx,mxny),
     6 xlai(mxnx,mxny),nears(mxnx,mxny),lcalgrd,
     7 anemht,imixctdm,isigmav,ilanduin,z0in,xlaiin,
     8 elevin,xlatin,xlonin,nss,i2dmet,
     9 iutmznm,feastm,fnorthm,pmapm,datumm,datenm,utmhemm
c
c --- COMMON BLOCK /METHD/ Variables:
c           LEVMET - character- Level of CALMET that generated met file
c           DVERSM - real     - Dataset version number for CALMET file
c              NXM - integer  - Number of CALMET grid points in
c                               X direction
c              NYM - integer  - Number of CALMET grid points in
c                               Y direction
c              NZM - integer  - Number of CALMET vertical levels
c           XGRIDM - real     - CALMET grid spacing (m)
c           XORIGM - real     - Reference X coordinate (m) of
c                               southwest corner of CALMET grid
c           YORIGM - real     - Reference Y coordinate (m) of
c                               southwest corner of CALMET grid
c            XBTZM - real     - Base time zone of CALMET data
c           XLAT0M - real     - Reference N LATITUDE (deg) of
c                               southwest corner of CALMET grid
c           XLON0M - real     - Reference W LONGITUDE (deg) of
c                               southwest corner of CALMET grid
c          LLCONFM - logical  - Lambert Conformal Map Projection used
c                               instead of UTM when TRUE
c RLAT0M,       - real      - N. latitude & W. longitude of x=0 and y=0
c RLON0M (deg)                of map projection (Used only if PMAP =
c                             LCC, PS, EM, TTM or LAZA) 
c                             NOTE: longitude POS in western hemisphere
c XLAT1M,       - real      - Matching N. latitude(s) for projection
c XLAT2M (deg)                (Used only if PMAP= LCC, PS, or EM)
c                             LCC :  Projection cone slices through
c                                    Earth's surface at XLAT1 and XLAT2
c                             PS  :  Projection plane slices through
c                                    Earth at XLAT1
c                             EM  :  Projection cylinder slices through
c                                    Earth at [+/-] XLAT1
c            NSSTA - integer  - Number of surface met. stations
c            NUSTA - integer  - Number of upper air stations
c            NPSTA - integer  - Number of preciitation stations
c              NLU - integer  - Number of land use categories
c     IWAT1, IWAT2 - integers - Land use categories from IWAT1 through
c                               IWAT2 correspond to water
c   ZFACEM(mxnzp1) - real     - CALMET cell face heights (m)
c                               (NZM+1 values)
c      XSSTA(mxss) - real     - X coordinate of each surface
c                               meteorological station
c      YSSTA(mxss) - real     - Y coordinate of each surface
c                               meteorological station
c     XLATSS(mxss) - real     - N Latitude of each surface
c                               meteorological station (degrees)
c     YLONSS(mxss) - real     - W Longitude of each surface
c                               meteorological station (degrees)
c      XUSTA(mxus) - real     - X coordinate of each upper air
c                               meteorological station
c      YUSTA(mxus) - real     - Y coordinate of each upper air
c                               meteorological station
c      XPSTA(mxps) - real     - X coordinate of each precipitation
c                               station
c      YPSTA(mxps) - real     - Y coordinate of each precipitation
c                               station
c    Z0(mxnx,mxny) - real     - Average surface roughness lengths (m)
c                               for each grid cell
c ILANDU(mxnx,mxny)- real     - Land use category for each grid cell
c                               NOTE: negative values indicate IRRIGATED
c                               land use
c  ELEV(mxnx,mxny) - real     - Average terrain height (m) above sea
c                               level for each grid cell
c  XLAI(mxnx,mxny) - real     - Leaf area index for each grid cell
c NEARS(mxnx,mxny) - integer  - Closest surface met. station to each
c                               grid point
c          LCALGRD - logical  - Control variable indicating if special
c                               meteorological fields required by
c                               CALGRID are stored in the met. file
c *** For METFM = 2,3
c           ANEMHT - real     - Height (m) at which single-point wind
c                               measurements are made
c *** For METFM = 4
c         IMIXCTDM - integer  - Flag to select mixing height from CTDM
c                               SURFACE file
c                                0:  select calculated mixing ht.
c                                1:  select observed mixing ht.
c
c         ISIGMAV  - integer  - Flag for units of PROFILE.DAT sigma
c                                0:  sigma-theta (deg)
c                                1:  sigma-v (m/s)
c *** For METFM = 2,3,4 --- Used to initialize 2-D arrays
c        ILANDUIN  - integer  - Single land use code for domain
c            Z0IN  - integer  - Single roughness length (m) for domain
c          XLAIIN  - integer  - Single leaf area index for domain
c          ELEVIN  - real     - Single elevation (m MSL) for domain
c *** For METFM = 2,3,4 --- Used to initialize 1-D arrays
c          XLATIN  - real     - N Latitude for single met station (deg)
c          XLONIN  - real     - W Longitude for single met station (deg)
c *** For METFM = 1     --- Used to place surface station lat/lon
c                               in control file
c             NSS - integer   - Number of surface met. stations
c          I2DMET - integer   - Flag for 2 D array of sfc met
c                                0: 2D arrays NOT available
c                                1: 2D array available
c IUTMZNM       - integer   - UTM zone for UTM projection
c FEASTM (km)   - real      - False Easting at projection origin
c FNORTHM(km)   - real      - False Northing at projection origin
c PMAPM         - character - Character code for output map projection
c                             UTM :  Universal Transverse Mercator
c                             LCC :  Lambert Conformal Conic
c                             PS  :  Polar Stereographic
c                             EM  :  Equatorial Mercator
c                             LAZA:  Lambert Azimuthal Equal Area
c                             TTM :  Tangential Transverse Mercator
c UTMHEMM       - character - Base hemisphere for UTM projection
c                             (S=southern, N=northern)
c DATUMM        - character - Datum-Region for grid coordinates
c DATENM        - character - NIMA date for datum parameters
c                             (MM-DD-YYYY  )
c----------------------------------------------------------------------
c --- COMMON BLOCK /METHR/ -- Hourly meteorological fields      CALPUFF
c                             from the meteorological data
c                             file(s)
c----------------------------------------------------------------------
c
      common/METHR/umet(mxnx,mxny,mxnz),vmet(mxnx,mxny,mxnz),
     1 tmet(mxnx,mxny,mxnz),ipgt(mxnx,mxny),htmix(mxnx,mxny),
     2 ustar(mxnx,mxny),xmonin(mxnx,mxny),wstar(mxnx,mxny),
     3 rmm(mxnx,mxny),tempss(mxss),rhoss(mxss),qswss(mxss),
     4 ccss(mxss),czenss(mxss),
     5 irhss(mxss),ipcode(mxss),ptg(2),plexp,dptinvo,
     6 wsprf(mxprfz),wdprf(mxprfz),tprf(mxprfz),svprf(mxprfz),
     7 swprf(mxprfz),ssprf(mxprfz),zprf(mxprfz),nzprf,
     8 wdiv(mxnx,mxny,mxnz),
c frr (09/01) - 2D fields for CALMET version >= V5.3 Lev 010901
     : temp2d(mxnx,mxny),rho2d(mxnx,mxny),qsw2d(mxnx,mxny),
     : cc2d(mxnx,mxny),czen2d(mxnx,mxny),
     : irh2d(mxnx,mxny),ipcode2d(mxnx,mxny)
c
c --- COMMON BLOCK /METHR/ Variables:
c
c   UMET(mxnx,mxny,mxnz) - real    - U-component of the wind (m/s) at
c                                    each grid point
c   VMET(mxnx,mxny,mxnz) - real    - V-component of the wind (m/s)
c   TMET(mxnx,mxny,mxnz) - real    - 3-D temperature field (deg. K)
c        IPGT(mxnx,mxny) - integer - PGT stability class (1-6)
c       HTMIX(mxnx,mxny) - real    - Mixing height (m)
c       USTAR(mxnx,mxny) - real    - Friction velocity (m/s)
c      XMONIN(mxnx,mxny) - real    - Monin-Obukhov length (m)
c       WSTAR(mxnx,mxny) - real    - Convective velocity scale (m/s)
c         RMM(mxnx,mxny) - real    - Precipitation rate (mm/hr)
c           TEMPSS(mxss) - real    - Temperature (deg. K) at each
c                                    surface met. station
c            RHOSS(mxss) - real    - Air density (kg/m**3)
c            QSWSS(mxss) - real    - Short-wave solar radiation (W/m**2)
c             CCSS(mxss) - real    - Cloud cover (tenths)
c           CZENSS(mxss) - real    - Cosine of solar zenith angle
c            IRHSS(mxss) - integer - Relative humidity (%)
c           IPCODE(mxss) - integer - Precipitation code at each surface
c                                    met. station
c                 PTG(2) - real    - Default potential temperature grad.
c                                     for stability 5,6 (deg. K/m)
c                  PLEXP - real    - Power law exponent for wind profile
c                DPTINVO - real    - Strength of inversion above CBL
c                                    (jump in potential temperature K)
c          WSPRF(mxprfz) - real    - Vector avg. wind speed (m/s) from
c                                    PROFILE.DAT
c          WDPRF(mxprfz) - real    - Vector wind direction (deg) from
c                                    PROFILE.DAT
c           TPRF(mxprfz) - real    - Temperature (K) from PROFILE.DAT
c          SVPRF(mxprfz) - real    - Sigma-v (m/s) from PROFILE.DAT
c          SWPRF(mxprfz) - real    - Sigma-w (m/s) from PROFILE.DAT
c          SSPRF(mxprfz) - real    - Scalar avg. wind speed (m/s) from
c                                    PROFILE.DAT
c           ZPRF(mxprfz) - real    - Heights at which PROFILE.DAT data
c                                    are provided (m)
c                  NZPRF - integer - Number of heights in PROFILE.DAT
c   WDIV(mxnx,mxny,mxnz) - real    - Vertical divergence dw/dz (1/s)
c
c frr (09/01) - additional fields needed for CALMET V5.3 level 010901 and up  
c      TEMP2D(mxnx,mxny) - real    - Surface Temperature (deg. K)
c       RHO2D(mxnx,mxny) - real    - Air density (kg/m**3)
c       QSW2D(mxnx,mxny) - real    - Short-wave solar radiation (W/m**2)
c        CC2D(mxnx,mxny) - real    - Cloud cover (tenths)
c      CZEN2D(mxnx,mxny) - real    - Cosine of solar zenith angle
c       IRH2D(mxnx,mxny) - integer - Relative humidity (%)
c    IPCODE2D(mxnx,mxny) - integer - Precipitation code 
c----------------------------------------------------------------------
c --- COMMON BLOCK /MFLUX/ -- User-Supplied Boundary Lines      CALPUFF
c                             and arrays for Mass Flux Output
c----------------------------------------------------------------------
c
      logical*1 lbndry(mxnx,mxny)
      character*16 cnambdy(mxbndry)
      common/MFLUX/nbndry,npbndry(2,mxbndry),bndrygrd(2,mxptbdy),
     &             ymxpbm(2,mxptbdy),flxin(mxspec,mxbndry),
     &             flxout(mxspec,mxbndry),cnambdy,lbndry
c
c --- COMMON BLOCK /MFLUX/ Variables:
c
c               NBNDRY - integer - Number of boundaries defined
c   NPBNDRY(2,mxbndry) - integer - Pointer to locations in BNDRYGRD
c                                  array containing data for each line
c                                  where element 1 is the start and
c                                  element 2 is the end
c  BNDRYGRD(2,mxptbdy) - real    - x,y coordinates (MET GRID UNITS) of
c                                  points along each line, where
c                                  element 1 is x, element 2 is y
c    YMXPBM(2,mxptbdy) - real    - Slope 'm' and intercept 'b' for line
c                                  defined by each boundary segment
c                                  element 1 is 'm', element 2 is 'b'
cFLXIN(mxspec,mxbndry) - real    - Mass flux of each species INTO
c                                  region for each boundary (g/s)
cFLXOUT(mxspec,mxbndry)- real    - Mass flux of each species OUT of
c                                  region for each boundary (g/s)
c     CNAMBDY(mxptbdy) - C*16    - Name of boundary
c    LBNDRY(mxnx,mxny) - logical - Logical marker indicating if a MET
c                                  GRID cell contains a boundary line
c----------------------------------------------------------------------
c NOTE:  More than 1 boundary can be defined, but all are appended in
c        the BNDRYGRD array.  The NPBNDRY provides the index for the
c        start and the end of each coast line.  Also, the ordering of
c        the points follows the convention that the region INTO which
c        the mass moves is to the RIGHT of the line traced out by these
c        points.  
c        Mass flux from LEFT to RIGHT is summed in the FLXIN array.
c        Mass flux from RIGHT to LEFT is summed in the FLXOUT array.c----------------------------------------------------------------------
c --- COMMON BLOCK /MSBAL/ -- arrays for Mass Balance Output     CALPUFF
c----------------------------------------------------------------------
c
      logical lbc
      common/MSBAL/balinp(mxspec),balout(mxspec),baltrn(mxspec),
     &             balwet(mxspec),baldry(mxspec),baltot(mxspec,2),
     &             balinpbc(mxspec),baloutbc(mxspec),baltrnbc(mxspec),
     &             balwetbc(mxspec),baldrybc(mxspec),baltotbc(mxspec,2),
     &             lbc
c
c --- COMMON BLOCK /MSBAL/ Variables:
c
c       BALINP(mxspec) - real    - Mass of each species emitted
c                                  during current hour (g)
c       BALOUT(mxspec) - real    - Mass of each species advected
c                                  during current hour (g)
c       BALTRN(mxspec) - real    - Mass of each species transformed
c                                  during current hour ( +/- g)
c       BALWET(mxspec) - real    - Mass of each species removed (wet
c                                  depletion) during current hour (g)
c       BALDRY(mxspec) - real    - Mass of each species removed (dry
c                                  depletion) during current hour (g)
c     BALTOT(mxspec,2) - real    - Mass of each species in domain at
c                                  end of current hour (g) below(1)
c                                  and above(2) surface mixed layer
c
c --- Above array names are repeated with 'BC' appended to store the
c --- corresponding information for mass that enters domain through
c --- the boundary conditions
c
c                  LBC - logical - Boundary condition mass reported?
c----------------------------------------------------------------------
c --- COMMON BLOCK /NONGRD/ - Discrete (non-gridded) receptor   CALPUFF
c                             information                              
c----------------------------------------------------------------------
c
      common/NONGRD/NREC,XNG(mxrec),YNG(mxrec),ZNG(mxrec),ELEVNG(mxrec)
c
c
c --- COMMON BLOCK /NONGRD/ Variables:
c                  NREC - integer  - Number of discrete (non-gridded)
c                                    receptors
c            XNG(mxrec) - real     - X coordinate of the receptor (met.
c                                    grid units w/ origin at (0.0,0.0))
c            YNG(mxrec) - real     - Y coordinate of the receptor (met.
c                                    grid units w/ origin at (0.0,0.0))
c            ZNG(mxrec) - real     - Z coordinate of the receptor
c                                    (height above ground, m)
c         ELEVNG(mxrec) - real     - Ground-level elevation (m) above
c                                    sea level at the receptor
c----------------------------------------------------------------------
c --- COMMON BLOCK /NUMPARM/ -- Parameters used in the          CALPUFF
c                               numerical plume rise algorithm
c----------------------------------------------------------------------
c
      common/NUMPARM/gravi,rgas,zmin,ds0,nstep,slast,rp,alphap(mxent),
     1 betap(mxent),xcat(mxentp1),nent,phicheck
c
c --- COMMON BLOCK /NUMPARM/ Variables:
c
c         GRAVI - real    - Acceleration due to gravity (m/s**2)
c          RGAS - real    - Gas constant (m**2/s**2/deg. K)
c          ZMIN - real    - Minimum plume centerline height (m)
c           DS0 - real    - Step size (m) in the numerical plume
c                           rise algorithm
c         NSTEP - integer - Internal save frequency of plume rise
c                           calculations (i.e., every DS*NSTEP meters)
c                           (NOTE: this the frequency with which the
c                           results are saved internally -- not that
c                           passed back from the NUMRISE routine)
c         SLAST - real    - Termination distance (m) of the plume rise
c                           calculation
c            RP - real    - Radiation coefficient (kg/m**2/deg. K**3/s)
c   ALPHAP(mxent) - real array - Perturbed entrainment coefficients
c                                (parallel)
c    BETAP(mxent) - real array - Perturbed entrainment coefficients
c                                (normal)
c   XCAT(mxentp1) - real array - Downwind distances (m) for which each
c                                perturbed entrainment coefficient
c                                (ALPHAP, BETAP) is valid (NENT+1 values
c                                for NENT entrainment coefficients).
c            NENT - integer    - Number of perturbed entrainment
c                                coefficients entered
c       PHICHECK - real   - plume axis elevation angle (radians) at
c                           which PRIME module checks for building
c                           wake 'capture'
c----------------------------------------------------------------------
c --- COMMON BLOCK /OPTIONS/ -- Slug specific information       CALPUFF
c----------------------------------------------------------------------
c
      logical lsigex
c
      common/OPTIONS/lsigex
c
c --- COMMON BLOCK /OPTIONS/ Variable:
c
c              LSIGEX - real      -.TRUE. implies use of exact receptor
c                                  specific sigma values (sy,sz).
c                                 -.FALSE. implies use of interpolated
c                                  slug end-point sigma values (sy,sz).
c
c ---------------------------------------------------------------------
c----------------------------------------------------------------------
c --- COMMON BLOCK /OUTPT/ -- Output option flags               CALPUFF
c----------------------------------------------------------------------
c
      logical ldebug,lcomprs
      common/OUTPT/icon,ivis,it2d,irho,idry,iwet,ifog,icprt,idprt,
     1 iwprt,icfrq,idfrq,iwfrq,iprtu,ioutop(7,mxspec),imesg,
     2 imflx,imbal,iqaplot,msource,ldebug,ipfdeb,npfdeb,nn1,nn2,lcomprs
c
c --- COMMON BLOCK /OUTPT/ Variables:
c
c              ICON - integer    - Flag controlling creation of an
c                                  output CONCENTRATION file
c                                  (0=do not create, 1=create)
c              IVIS - integer    - Flag controlling creation of an
c                                  output VISIBILITY file
c                                  (0=do not create, 1=create)
c              IT2D - integer    - Flag controlling creation of an
c                                  output 2D Temperature file
c                                  (0=do not create, 1=create)
c              IRHO - integer    - Flag controlling creation of an
c                                  output 2D Density file
c                                  (0=do not create, 1=create)
c              IDRY - integer    - Flag controlling creation of an
c                                  output DRY FLUX file
c                                  (0=do not create, 1=create)
c              IWET - integer    - Flag controlling creation of an
c                                  output WET FLUX file
c                                  (0=do not create, 1=create)
c              IFOG - integer    - Flag controlling creation of an
c                                  output FOG Model file
c                                  (0=do not create, 1=create)
c             ICPRT - integer    - Flag controlling line printer output
c                                  of concentrations
c                                  (0=do not print, 1=print)
c             IDPRT - integer    - Flag controlling line printer output
c                                  of dry fluxes
c                                  (0=do not print, 1=print)
c             IWPRT - integer    - Flag controlling line printer output
c                                  of wet fluxes
c                                  (0=do not print, 1=print)
c             ICFRQ - integer    - Print interval (hours) for line
c                                  printer concentration output
c             IDFRQ - integer    - Print interval (hours) for line
c                                  printer dry flux output
c             IWFRQ - integer    - Print interval (hours) for line
c                                  printer wet flux output
c             IPRTU - integer    - Units for printing output:
c                                   1)  g/m**3 (conc)  g/m**2/s (dep)
c                                   2) mg/m**3 (conc) mg/m**2/s (dep)
c                                   3) ug/m**3 (conc) ug/m**2/s (dep)
c                                   4) ng/m**3 (conc) ng/m**2/s (dep)
c                                   5) odour units
c  IOUTOP(7,mxspec) - real       - Control variables indicating
c                                  which species concentrations are
c                                  printed (1,-), stored on disk (2,-),
c                                  which dry fluxes are
c                                  printed (3,-), stored on disk (4,-),
c                                  which wet fluxes are
c                                  printed (5,-), stored on disk (6,-),
c                                  which mass fluxes are
c                                  stored on disk (7,-)
c             IMESG - integer    - Flag controlling output of runtime
c                                  messages to the screen tracking the
c                                  progress of the run
c            IMFLX - integer     - Flag controlling creation of an
c                                  output MASS FLUX file
c                                  (0=do not create, 1=create)
c            IMBAL - integer     - Flag controlling creation of an
c                                  output MASS BALANCE file
c                                  (0=do not create, 1=create)
c          IQAPLOT - integer     - Flag controlling creation of set of
c                                  QA plot files
c                                  (0=do not create, 1=create)
c          MSOURCE - integer     - Individual source contribution saved?
c                                  (0 = no,  1 = yes)
c           LDEBUG - logical     - Debug switch (debug output if .TRUE.)
c           IPFBUG - integer     - ID of first puff tracked in DEBUG
c           NPFBUG - integer     - Number of puffs tracked in DEBUG
c              NN1 - integer     - Met. period to start DEBUG output
c              NN2 - integer     - Met. period to endt DEBUG output
c          LCOMPRS - logical     - Compress option for binary output
c                                  fields (T=compress on, F=compress
c                                  off)
c----------------------------------------------------------------------
c --- PARAMETER statements                                      CALPUFF
c----------------------------------------------------------------------
c --- Specify model version
      character*12 mver, mlevel, mmodel
      parameter(mver='5.8',mlevel='070623')
      parameter(mmodel='CALPUFF')
c
c --- Specify parameters
      parameter(mxpuff=100000)
      parameter(mxspec=20)
      parameter(mxnx=265,mxny=265,mxnz=12)
      parameter(mxnxg=265,mxnyg=265,mxrec=11000)
      parameter(mxrfog=40)
      parameter(mxss=350,mxus=99,mxps=700)
      parameter(mxpt1=200,mxpt2=200,mxarea=200,mxvert=5)
      parameter(mxlines=24,mxlngrp=1,mxvol=200)
      parameter(mxrise=50)
      parameter(mxpdep=20,mxint=9)
      parameter(mxoz=725,mxaq=1)
      parameter(mxhill=20,mxtpts=25,mxrect=1000,mxcntr=21)
      parameter(mxprfz=50)
      parameter(mxent=10,mxntr=50,mxnw=5000)
      parameter(mxvalz=10)
      parameter(mxcoast=10,mxptcst=5000)
      parameter(mxbndry=10,mxptbdy=5000)   ! keep mxbndry LE 20
      parameter(mxmetdat=48, mxemdat=12)
      parameter(mxmetsav=2)
      parameter(mxsg=30)
      parameter(io3=3,io4=4,io5=1,io6=2,io7=7,io8=8,io9=9)
      parameter(io10=10,io11=11,io12=12,io13=13,io14=14,io15=15)
      parameter(io19=19,io20=20,io22=22,io23=23,io24=24)
      parameter(io25=25,io28=28,io29=29,io30=30,io31=31,io32=32)
      parameter(io35=35,io36=36,io37=37)
      parameter(iomesg=0)
      parameter(iox=99)
      parameter(iopt2=100)
      parameter(ioar2=iopt2+mxemdat)
      parameter(iovol=ioar2+mxemdat)
c
c
c --- Compute derived parameters
      parameter(mxbc=2*mxnx+2*mxny)
      parameter(mxnzp1=mxnz+1)
      parameter(mxvertp1=mxvert+1)
      parameter(mxnxy=mxnx*mxny)
      parameter(mxnxyg=mxnxg*mxnyg)
      parameter(mxgsp=mxnxg*mxnyg*mxspec)
      parameter(mxrsp=mxrec*mxspec)
      parameter(mxcsp=mxrect*mxspec)
      parameter(mx2=2*mxspec,mx5=5*mxspec,mx7=7*mxspec)
      parameter(mxp2=2+mxspec,mxp3=3+mxspec)
      parameter(mxp4=4+mxspec,mxp6=6+mxspec)
      parameter(mxp7=7+mxspec,mxp8=8+mxspec,mxp14=mxspec+14)
      parameter(mxpuf6=6*mxpuff)
      parameter(mxlev=mxprfz)
      parameter(mxprfp1=mxprfz+1)
      parameter(mxentp1=mxent+1)
      parameter(mxgrup=mxspec)
      parameter(mxq12=mxspec*(mxpt1+mxarea)*2)
      parameter(mxspar=mxspec*mxarea,mxspln=mxspec*mxlines)
      parameter(mxsppt1=mxspec*mxpt1,mxspvl=mxspec*mxvol)
      parameter(mxspbc=mxspec*mxbc)
c
c --- Specify parameters for sizing GUI:
      parameter(mxavar=1)
      parameter(mxlvar=1)
      parameter(mxpvar=1)
      parameter(mxvvar=1)
c
c --- GENERAL PARAMETER definitions:
c        MXPUFF - Maximum number of active puffs allowed on the
c                 computational grid at one time
c        MXSLUG - Maximum number of active slugs allowed on the
c                 computational grid at one time (can be set to
c                 one if the slug option is not used)
c        MXSPEC - Maximum number of chemical species.  N.B.: Changes
c                 to MXSPEC may also require code changes to BLOCK DATA
c                 and READCF.
c        MXGRUP - Maximum number of Species-Groups.  Results for grouped
c                 species are added together and reported using the
c                 name of the group, rather than the name of one of the
c                 species in the group. (MXGRUP = MXSPEC since specie
c                 names are used as group names whenever group names are
c                 not provided)
c          MXNX - Maximum number of METEOROLOGICAL grid cells in
c                 the X direction
c          MXNY - Maximum number of METEOROLOGICAL grid cells in
c                 the Y direction
c          MXNZ - Maximum number of vertical layers in
c                 the METEOROLOGICAL grid
c         MXNXG - Maximum number of SAMPLING grid cells in
c                 the X direction
c         MXNYG - Maximum number of SAMPLING grid cells in
c                 the Y direction
c         MXREC - Maximum number of non-gridded receptors
c        MXRFOG - Maximum number of distances used when MFOG=1
c                 NOTE:  There are NPT1+NPT2 receptor 'trails', with
c                        MXRFOG receptors on each, so
c                        MXREC >= (NPT1+NPT2)*MXRFOG
c          MXSS - Maximum number of surface meteorological stations
c                 in the CALMET data
c          MXUS - Maximum number of upper air stations in the CALMET
c                 data
c          MXPS - Maximum number of precipitation stations in the
c                 CALMET data
c          MXBC - Maximum number of sources used to represent boundary
c                 conditions (inlux of background mass);  source
c                 segments span the computational domain perimeter
c         MXPT1 - Maximum number of point sources with constant
c                 emission parameters
c         MXPT2 - Maximum number of point sources with time-varying
c                 emission parameters
c        MXAREA - Maximum number of polygon area sources with constant
c                 emission parameters (i.e., non-gridded area sources)
c        MXVERT - Maximum number of vertices in polygon area source
c        MXLINES- Maximum number of line sources
c        MXLNGRP- Maximum number of groups of line sources
c         MXVOL - Maximum number of volume sources
c        MXRISE - Maximum number of points in computed plume rise
c                 tabulation for buoyant area and line sources
c        MXPDEP - Maximum number of particle species dry deposited
c                 (typically set to MXSPEC)
c         MXINT - Maximum number of particle size intervals used
c                 in defining mass-weighted deposition velocities
c          MXOZ - Maximum number of ozone data stations (for use in the
c                 chemistry module)
c          MXAQ - Maximum number of Air Quality data stations (e.g.
c                 H2O2 data stations for aqueous chemistry module)
c        MXHILL - Maximum number of subgrid-scale (CTSG) terrain
c                 features
c        MXTPTS - Maximum number of points used to obtain flow
c                 factors along the trajectory of a puff over the hill
c        MXRECT - Maximum number of complex terrain (CTSG) receptors
c        MXCNTR - Maximum number of hill height contours (CTDM ellipses)
c        MXPRFZ - Maximum number of vertical levels of met. data in
c                 CTDM PROFILE file
c         MXLEV - Maximum number of vertical levels of met. data
c                 allowed in the CTSG module (set to MXPRFZ in the
c                 current implementation of CALPUFF)
c         MXENT - Maximum number of perturbed entrainment coefficients
c                 entered
c         MXNTR - Maximum number of downwind distances for which
c                 numerical plume rise will be reported
c          MXNW - Maximum number of downwind distances for numerical
c                 plume rise integration (should be set equal to
c                 SLAST/DS)
c        MXVALZ - Maximum number of heights above ground at which valley
c                 widths are found for each grid cell
c       MXCOAST - Maximum number of coasts provided in COASTLN.DAT file
c       MXPTCST - Maximum number of points used to store all coastlines
c       MXBNDRY - Maximum number of boundaries provided in FLUXBDY.DAT
c       MXPTBDY - Maximum number of points used to store all boundaries
c      MXMETDAT - Maximum number of CALMET.DAT files used in run
c       MXEMDAT - Maximum number of variable emissions files (each type)
c      MXMETSAV - Maximum number of met periods for which source tables
c                 (e.g. numerical rise) are saved
c         MXQ12 - Maximum number of groups of 12 emission rate scaling
c                 factors.  Factors come in groups of 12,24,36, or 96.
c                 These are specified for source-species combinations,
c                 but not all combinations will be filled.  Default
c                 value of MXQ12 assumes that no more than 24 factors
c                 are provided for each source-species combination for
c                 point and area sources.
c
c --- CONTROL FILE READER definitions:
c          MXSG - Maximum number of input groups in control file
c
c --- FORTRAN I/O unit numbers:
c           IO3 - Restart file (RESTARTB.DAT)   - input  - unformatted
c           IO4 - Restart file (RESTARTE.DAT)   - output - unformatted
c           IO5 - Control file (CALPUFF.INP)    - input  - formatted
c           IO6 - List file (CALPUFF.LST)       - output - formatted
c
c           IO7 - Meteorological data file      - input  - unformatted
c                 (CALMET.DAT)
c
c           IO8 - Concentration output file     - output - unformatted
c                 (CONC.DAT)
c           IO9 - Dry flux output file          - output - unformatted
c                 (DFLX.DAT)
c          IO10 - Wet flux output file          - output - unformatted
c                 (WFLX.DAT)
c          IO11 - Visibility output file        - output - unformatted
c                 (VISB.DAT)
c          IO12 - Fog plume data output file    - output - unformatted
c                 (FOG.DAT)
c          IO13 - 2D Temperature output file    - output - unformatted
c                 (TK2D.DAT)
c          IO14 - 2D Density output file        - output - unformatted
c                 (RHO2D.DAT)
c          IO15 - Boundary Condition file       - input  - unformatted
c                 (BCON.DAT)
c          IO19 - Buoyant line sources file     - input  - free format
c                 (LNEMARB.DAT) with arbitrarily
c                 varying location & emissions
c          IO20 - User-specified deposition     - input  - formatted
c                 velocities (VD.DAT)
c          IO22 - Hourly ozone monitoring data  - input  - formatted
c                 (OZONE.DAT)
c          IO23 - Hourly H2O2 monitoring data   - input  - formatted
c                 (H2O2.DAT)
c          IO24 - User-specified chemical       - input  - formatted
c                 transformation rates
c                 (CHEM.DAT)
c          IO25 - User-specified coast line(s)  - input  - free format
c                 for sub-grid TIBL module
c                 (COASTLN.DAT)
c          IO28 - CTSG hill specifications from - input  - formatted
c                 CTDM terrain processor
c                 (HILL.DAT)
c          IO29 - CTSG receptor specifications  - input  - formatted
c                 from CTDM receptor generator
c                 (RECS.DAT)
c          IO30 - Tracking puff/slug data       - output - formatted
c                 (DEBUG.DAT)
c          IO31 - CTDM "tower" data             - input  - formatted
c                 (PROFILE.DAT)
c          IO32 - CTDM surface layer parameters - input  - formatted
c                 (SURFACE.DAT)
c          IO35 - User-specified boundary lines(s)- input- free format
c                 for mass flux calculations
c                 (FLUXBDY.DAT)
c          IO36 - Mass flux data                - output - formatted
c                 (MASSFLX.DAT)
c          IO37 - Mass balance data             - output - formatted
c                 (MASSBAL.DAT)
c         IOPT2 - 1st Pt. source emissions file - input  - unformatted
c                 (PTEMARB.DAT) with arbitrarily           or free fmt
c                 varying point source emissions
c         IOAR2 - 1st Buoyant area sources file - input  - free format
c                 (BAEMARB.DAT) with arbitrarily
c                 varying location & emissions
c         IOVOL - 1st Volume source file        - input  - unformatted
c                 (VOLEMARB.DAT) with arbitrarily          of free fmt
c                 varying location & emissions
c        IOMESG - Fortran unit number for screen- output - formatted
c                 output (NOTE: This unit is
c                 NOT opened -- it must be a
c                 preconnected unit to the screen
c                 -- Screen output can be suppressed
c                 by the input "IMESG" in the
c                 control file)
c           IOX - Fortran unit number for      - scratch - formatted
c                 temporary file of "doc" records
c                 written to header of output files
c
c
c --- GUI memory control parameters:  variable emissions scaling factors
c     for areas, lines, points, and volumes require much memory in GUI.
c     To reduce GUI memory requirement, set one or more of the
c     following parameters to ZERO when such scaling is not required.
c     These parameters have no effect on CALPUFF, but are read by the
c     GUI at execution time.
c
c        MXAVAR - Using scaled area sources?   (1:yes, 0:no)
c        MXLVAR - Using scaled line sources?   (1:yes, 0:no)
c        MXPVAR - Using scaled point sources?  (1:yes, 0:no)
c        MXVVAR - Using scaled volume sources? (1:yes, 0:no)
c
c
c -----------------------------------------------------------------

 c----------------------------------------------------------------------
c --- PARAMETER statements                                      CALPUFF
c----------------------------------------------------------------------
c --- Specify model version
      character*12 mver, mlevel, mmodel
      parameter(mver='5.8',mlevel='070623')
      parameter(mmodel='CALPUFF')
c
c --- Specify parameters
      parameter(mxpuff=20000)
      parameter(mxspec=20)
      parameter(mxnx=230,mxny=260,mxnz=12)
      parameter(mxnxg=230,mxnyg=260,mxrec=4000)
      parameter(mxrfog=40)
      parameter(mxss=250,mxus=99,mxps=300)
      parameter(mxpt1=100,mxpt2=100,mxarea=100,mxvert=5)
      parameter(mxlines=20,mxlngrp=1,mxvol=100)
      parameter(mxrise=50)
      parameter(mxpdep=20,mxint=9)
      parameter(mxoz=725,mxaq=1)
      parameter(mxhill=20,mxtpts=25,mxrect=1000,mxcntr=21)
      parameter(mxprfz=50)
      parameter(mxent=10,mxntr=50,mxnw=5000)
      parameter(mxvalz=10)
      parameter(mxcoast=10,mxptcst=5000)
      parameter(mxbndry=10,mxptbdy=5000)   ! keep mxbndry LE 20
      parameter(mxmetdat=48, mxemdat=12)
      parameter(mxmetsav=2)
      parameter(mxsg=30)
      parameter(io3=3,io4=4,io5=1,io6=2,io7=7,io8=8,io9=9)
      parameter(io10=10,io11=11,io12=12,io13=13,io14=14,io15=15)
      parameter(io19=19,io20=20,io22=22,io23=23,io24=24)
      parameter(io25=25,io28=28,io29=29,io30=30,io31=31,io32=32)
      parameter(io35=35,io36=36,io37=37)
      parameter(iomesg=0)
      parameter(iox=99)
      parameter(iopt2=100)
      parameter(ioar2=iopt2+mxemdat)
      parameter(iovol=ioar2+mxemdat)
c
c
c --- Compute derived parameters
      parameter(mxbc=2*mxnx+2*mxny)
      parameter(mxnzp1=mxnz+1)
      parameter(mxvertp1=mxvert+1)
      parameter(mxnxy=mxnx*mxny)
      parameter(mxnxyg=mxnxg*mxnyg)
      parameter(mxgsp=mxnxg*mxnyg*mxspec)
      parameter(mxrsp=mxrec*mxspec)
      parameter(mxcsp=mxrect*mxspec)
      parameter(mx2=2*mxspec,mx5=5*mxspec,mx7=7*mxspec)
      parameter(mxp2=2+mxspec,mxp3=3+mxspec)
      parameter(mxp4=4+mxspec,mxp6=6+mxspec)
      parameter(mxp7=7+mxspec,mxp8=8+mxspec,mxp14=mxspec+14)
      parameter(mxpuf6=6*mxpuff)
      parameter(mxlev=mxprfz)
      parameter(mxprfp1=mxprfz+1)
      parameter(mxentp1=mxent+1)
      parameter(mxgrup=mxspec)
      parameter(mxq12=mxspec*(mxpt1+mxarea)*2)
      parameter(mxspar=mxspec*mxarea,mxspln=mxspec*mxlines)
      parameter(mxsppt1=mxspec*mxpt1,mxspvl=mxspec*mxvol)
      parameter(mxspbc=mxspec*mxbc)
c
c --- Specify parameters for sizing GUI:
      parameter(mxavar=1)
      parameter(mxlvar=1)
      parameter(mxpvar=1)
      parameter(mxvvar=1)
c
c --- GENERAL PARAMETER definitions:
c        MXPUFF - Maximum number of active puffs allowed on the
c                 computational grid at one time
c        MXSLUG - Maximum number of active slugs allowed on the
c                 computational grid at one time (can be set to
c                 one if the slug option is not used)
c        MXSPEC - Maximum number of chemical species.  N.B.: Changes
c                 to MXSPEC may also require code changes to BLOCK DATA
c                 and READCF.
c        MXGRUP - Maximum number of Species-Groups.  Results for grouped
c                 species are added together and reported using the
c                 name of the group, rather than the name of one of the
c                 species in the group. (MXGRUP = MXSPEC since specie
c                 names are used as group names whenever group names are
c                 not provided)
c          MXNX - Maximum number of METEOROLOGICAL grid cells in
c                 the X direction
c          MXNY - Maximum number of METEOROLOGICAL grid cells in
c                 the Y direction
c          MXNZ - Maximum number of vertical layers in
c                 the METEOROLOGICAL grid
c         MXNXG - Maximum number of SAMPLING grid cells in
c                 the X direction
c         MXNYG - Maximum number of SAMPLING grid cells in
c                 the Y direction
c         MXREC - Maximum number of non-gridded receptors
c        MXRFOG - Maximum number of distances used when MFOG=1
c                 NOTE:  There are NPT1+NPT2 receptor 'trails', with
c                        MXRFOG receptors on each, so
c                        MXREC >= (NPT1+NPT2)*MXRFOG
c          MXSS - Maximum number of surface meteorological stations
c                 in the CALMET data
c          MXUS - Maximum number of upper air stations in the CALMET
c                 data
c          MXPS - Maximum number of precipitation stations in the
c                 CALMET data
c          MXBC - Maximum number of sources used to represent boundary
c                 conditions (inlux of background mass);  source
c                 segments span the computational domain perimeter
c         MXPT1 - Maximum number of point sources with constant
c                 emission parameters
c         MXPT2 - Maximum number of point sources with time-varying
c                 emission parameters
c        MXAREA - Maximum number of polygon area sources with constant
c                 emission parameters (i.e., non-gridded area sources)
c        MXVERT - Maximum number of vertices in polygon area source
c        MXLINES- Maximum number of line sources
c        MXLNGRP- Maximum number of groups of line sources
c         MXVOL - Maximum number of volume sources
c        MXRISE - Maximum number of points in computed plume rise
c                 tabulation for buoyant area and line sources
c        MXPDEP - Maximum number of particle species dry deposited
c                 (typically set to MXSPEC)
c         MXINT - Maximum number of particle size intervals used
c                 in defining mass-weighted deposition velocities
c          MXOZ - Maximum number of ozone data stations (for use in the
c                 chemistry module)
c          MXAQ - Maximum number of Air Quality data stations (e.g.
c                 H2O2 data stations for aqueous chemistry module)
c        MXHILL - Maximum number of subgrid-scale (CTSG) terrain
c                 features
c        MXTPTS - Maximum number of points used to obtain flow
c                 factors along the trajectory of a puff over the hill
c        MXRECT - Maximum number of complex terrain (CTSG) receptors
c        MXCNTR - Maximum number of hill height contours (CTDM ellipses)
c        MXPRFZ - Maximum number of vertical levels of met. data in
c                 CTDM PROFILE file
c         MXLEV - Maximum number of vertical levels of met. data
c                 allowed in the CTSG module (set to MXPRFZ in the
c                 current implementation of CALPUFF)
c         MXENT - Maximum number of perturbed entrainment coefficients
c                 entered
c         MXNTR - Maximum number of downwind distances for which
c                 numerical plume rise will be reported
c          MXNW - Maximum number of downwind distances for numerical
c                 plume rise integration (should be set equal to
c                 SLAST/DS)
c        MXVALZ - Maximum number of heights above ground at which valley
c                 widths are found for each grid cell
c       MXCOAST - Maximum number of coasts provided in COASTLN.DAT file
c       MXPTCST - Maximum number of points used to store all coastlines
c       MXBNDRY - Maximum number of boundaries provided in FLUXBDY.DAT
c       MXPTBDY - Maximum number of points used to store all boundaries
c      MXMETDAT - Maximum number of CALMET.DAT files used in run
c       MXEMDAT - Maximum number of variable emissions files (each type)
c      MXMETSAV - Maximum number of met periods for which source tables
c                 (e.g. numerical rise) are saved
c         MXQ12 - Maximum number of groups of 12 emission rate scaling
c                 factors.  Factors come in groups of 12,24,36, or 96.
c                 These are specified for source-species combinations,
c                 but not all combinations will be filled.  Default
c                 value of MXQ12 assumes that no more than 24 factors
c                 are provided for each source-species combination for
c                 point and area sources.
c
c --- CONTROL FILE READER definitions:
c          MXSG - Maximum number of input groups in control file
c
c --- FORTRAN I/O unit numbers:
c           IO3 - Restart file (RESTARTB.DAT)   - input  - unformatted
c           IO4 - Restart file (RESTARTE.DAT)   - output - unformatted
c           IO5 - Control file (CALPUFF.INP)    - input  - formatted
c           IO6 - List file (CALPUFF.LST)       - output - formatted
c
c           IO7 - Meteorological data file      - input  - unformatted
c                 (CALMET.DAT)
c
c           IO8 - Concentration output file     - output - unformatted
c                 (CONC.DAT)
c           IO9 - Dry flux output file          - output - unformatted
c                 (DFLX.DAT)
c          IO10 - Wet flux output file          - output - unformatted
c                 (WFLX.DAT)
c          IO11 - Visibility output file        - output - unformatted
c                 (VISB.DAT)
c          IO12 - Fog plume data output file    - output - unformatted
c                 (FOG.DAT)
c          IO13 - 2D Temperature output file    - output - unformatted
c                 (TK2D.DAT)
c          IO14 - 2D Density output file        - output - unformatted
c                 (RHO2D.DAT)
c          IO15 - Boundary Condition file       - input  - unformatted
c                 (BCON.DAT)
c          IO19 - Buoyant line sources file     - input  - free format
c                 (LNEMARB.DAT) with arbitrarily
c                 varying location & emissions
c          IO20 - User-specified deposition     - input  - formatted
c                 velocities (VD.DAT)
c          IO22 - Hourly ozone monitoring data  - input  - formatted
c                 (OZONE.DAT)
c          IO23 - Hourly H2O2 monitoring data   - input  - formatted
c                 (H2O2.DAT)
c          IO24 - User-specified chemical       - input  - formatted
c                 transformation rates
c                 (CHEM.DAT)
c          IO25 - User-specified coast line(s)  - input  - free format
c                 for sub-grid TIBL module
c                 (COASTLN.DAT)
c          IO28 - CTSG hill specifications from - input  - formatted
c                 CTDM terrain processor
c                 (HILL.DAT)
c          IO29 - CTSG receptor specifications  - input  - formatted
c                 from CTDM receptor generator
c                 (RECS.DAT)
c          IO30 - Tracking puff/slug data       - output - formatted
c                 (DEBUG.DAT)
c          IO31 - CTDM "tower" data             - input  - formatted
c                 (PROFILE.DAT)
c          IO32 - CTDM surface layer parameters - input  - formatted
c                 (SURFACE.DAT)
c          IO35 - User-specified boundary lines(s)- input- free format
c                 for mass flux calculations
c                 (FLUXBDY.DAT)
c          IO36 - Mass flux data                - output - formatted
c                 (MASSFLX.DAT)
c          IO37 - Mass balance data             - output - formatted
c                 (MASSBAL.DAT)
c         IOPT2 - 1st Pt. source emissions file - input  - unformatted
c                 (PTEMARB.DAT) with arbitrarily           or free fmt
c                 varying point source emissions
c         IOAR2 - 1st Buoyant area sources file - input  - free format
c                 (BAEMARB.DAT) with arbitrarily
c                 varying location & emissions
c         IOVOL - 1st Volume source file        - input  - unformatted
c                 (VOLEMARB.DAT) with arbitrarily          of free fmt
c                 varying location & emissions
c        IOMESG - Fortran unit number for screen- output - formatted
c                 output (NOTE: This unit is
c                 NOT opened -- it must be a
c                 preconnected unit to the screen
c                 -- Screen output can be suppressed
c                 by the input "IMESG" in the
c                 control file)
c           IOX - Fortran unit number for      - scratch - formatted
c                 temporary file of "doc" records
c                 written to header of output files
c
c
c --- GUI memory control parameters:  variable emissions scaling factors
c     for areas, lines, points, and volumes require much memory in GUI.
c     To reduce GUI memory requirement, set one or more of the
c     following parameters to ZERO when such scaling is not required.
c     These parameters have no effect on CALPUFF, but are read by the
c     GUI at execution time.
c
c        MXAVAR - Using scaled area sources?   (1:yes, 0:no)
c        MXLVAR - Using scaled line sources?   (1:yes, 0:no)
c        MXPVAR - Using scaled point sources?  (1:yes, 0:no)
c        MXVVAR - Using scaled volume sources? (1:yes, 0:no)
c
c
c -----------------------------------------------------------------

 c----------------------------------------------------------------------
c --- PARAMETER statements                                      CALPUFF
c----------------------------------------------------------------------
c --- Specify model version
      character*12 mver, mlevel, mmodel
      parameter(mver='5.8',mlevel='070623')
      parameter(mmodel='CALPUFF')
c
c --- Specify parameters
      parameter(mxpuff=100000)
      parameter(mxspec=20)
      parameter(mxnx=321,mxny=291,mxnz=12)
      parameter(mxnxg=321,mxnyg=291,mxrec=11000)
      parameter(mxrfog=40)
      parameter(mxss=350,mxus=99,mxps=700)
      parameter(mxpt1=200,mxpt2=200,mxarea=200,mxvert=20)
      parameter(mxlines=24,mxlngrp=1,mxvol=200)
      parameter(mxrise=50)
      parameter(mxpdep=20,mxint=9)
      parameter(mxoz=725,mxaq=1)
      parameter(mxhill=20,mxtpts=25,mxrect=1000,mxcntr=21)
      parameter(mxprfz=50)
      parameter(mxent=10,mxntr=50,mxnw=5000)
      parameter(mxvalz=10)
      parameter(mxcoast=10,mxptcst=5000)
      parameter(mxbndry=10,mxptbdy=5000)   ! keep mxbndry LE 20
      parameter(mxmetdat=48, mxemdat=12)
      parameter(mxmetsav=2)
      parameter(mxsg=30)
      parameter(io3=3,io4=4,io5=1,io6=2,io7=7,io8=8,io9=9)
      parameter(io10=10,io11=11,io12=12,io13=13,io14=14,io15=15)
      parameter(io19=19,io20=20,io22=22,io23=23,io24=24)
      parameter(io25=25,io28=28,io29=29,io30=30,io31=31,io32=32)
      parameter(io35=35,io36=36,io37=37)
      parameter(iomesg=0)
      parameter(iox=99)
      parameter(iopt2=100)
      parameter(ioar2=iopt2+mxemdat)
      parameter(iovol=ioar2+mxemdat)
c
c
c --- Compute derived parameters
      parameter(mxbc=2*mxnx+2*mxny)
      parameter(mxnzp1=mxnz+1)
      parameter(mxvertp1=mxvert+1)
      parameter(mxnxy=mxnx*mxny)
      parameter(mxnxyg=mxnxg*mxnyg)
      parameter(mxgsp=mxnxg*mxnyg*mxspec)
      parameter(mxrsp=mxrec*mxspec)
      parameter(mxcsp=mxrect*mxspec)
      parameter(mx2=2*mxspec,mx5=5*mxspec,mx7=7*mxspec)
      parameter(mxp2=2+mxspec,mxp3=3+mxspec)
      parameter(mxp4=4+mxspec,mxp6=6+mxspec)
      parameter(mxp7=7+mxspec,mxp8=8+mxspec,mxp14=mxspec+14)
      parameter(mxpuf6=6*mxpuff)
      parameter(mxlev=mxprfz)
      parameter(mxprfp1=mxprfz+1)
      parameter(mxentp1=mxent+1)
      parameter(mxgrup=mxspec)
      parameter(mxq12=mxspec*(mxpt1+mxarea)*2)
      parameter(mxspar=mxspec*mxarea,mxspln=mxspec*mxlines)
      parameter(mxsppt1=mxspec*mxpt1,mxspvl=mxspec*mxvol)
      parameter(mxspbc=mxspec*mxbc)
c
c --- Specify parameters for sizing GUI:
      parameter(mxavar=1)
      parameter(mxlvar=1)
      parameter(mxpvar=1)
      parameter(mxvvar=1)
c
c --- GENERAL PARAMETER definitions:
c        MXPUFF - Maximum number of active puffs allowed on the
c                 computational grid at one time
c        MXSLUG - Maximum number of active slugs allowed on the
c                 computational grid at one time (can be set to
c                 one if the slug option is not used)
c        MXSPEC - Maximum number of chemical species.  N.B.: Changes
c                 to MXSPEC may also require code changes to BLOCK DATA
c                 and READCF.
c        MXGRUP - Maximum number of Species-Groups.  Results for grouped
c                 species are added together and reported using the
c                 name of the group, rather than the name of one of the
c                 species in the group. (MXGRUP = MXSPEC since specie
c                 names are used as group names whenever group names are
c                 not provided)
c          MXNX - Maximum number of METEOROLOGICAL grid cells in
c                 the X direction
c          MXNY - Maximum number of METEOROLOGICAL grid cells in
c                 the Y direction
c          MXNZ - Maximum number of vertical layers in
c                 the METEOROLOGICAL grid
c         MXNXG - Maximum number of SAMPLING grid cells in
c                 the X direction
c         MXNYG - Maximum number of SAMPLING grid cells in
c                 the Y direction
c         MXREC - Maximum number of non-gridded receptors
c        MXRFOG - Maximum number of distances used when MFOG=1
c                 NOTE:  There are NPT1+NPT2 receptor 'trails', with
c                        MXRFOG receptors on each, so
c                        MXREC >= (NPT1+NPT2)*MXRFOG
c          MXSS - Maximum number of surface meteorological stations
c                 in the CALMET data
c          MXUS - Maximum number of upper air stations in the CALMET
c                 data
c          MXPS - Maximum number of precipitation stations in the
c                 CALMET data
c          MXBC - Maximum number of sources used to represent boundary
c                 conditions (inlux of background mass);  source
c                 segments span the computational domain perimeter
c         MXPT1 - Maximum number of point sources with constant
c                 emission parameters
c         MXPT2 - Maximum number of point sources with time-varying
c                 emission parameters
c        MXAREA - Maximum number of polygon area sources with constant
c                 emission parameters (i.e., non-gridded area sources)
c        MXVERT - Maximum number of vertices in polygon area source
c        MXLINES- Maximum number of line sources
c        MXLNGRP- Maximum number of groups of line sources
c         MXVOL - Maximum number of volume sources
c        MXRISE - Maximum number of points in computed plume rise
c                 tabulation for buoyant area and line sources
c        MXPDEP - Maximum number of particle species dry deposited
c                 (typically set to MXSPEC)
c         MXINT - Maximum number of particle size intervals used
c                 in defining mass-weighted deposition velocities
c          MXOZ - Maximum number of ozone data stations (for use in the
c                 chemistry module)
c          MXAQ - Maximum number of Air Quality data stations (e.g.
c                 H2O2 data stations for aqueous chemistry module)
c        MXHILL - Maximum number of subgrid-scale (CTSG) terrain
c                 features
c        MXTPTS - Maximum number of points used to obtain flow
c                 factors along the trajectory of a puff over the hill
c        MXRECT - Maximum number of complex terrain (CTSG) receptors
c        MXCNTR - Maximum number of hill height contours (CTDM ellipses)
c        MXPRFZ - Maximum number of vertical levels of met. data in
c                 CTDM PROFILE file
c         MXLEV - Maximum number of vertical levels of met. data
c                 allowed in the CTSG module (set to MXPRFZ in the
c                 current implementation of CALPUFF)
c         MXENT - Maximum number of perturbed entrainment coefficients
c                 entered
c         MXNTR - Maximum number of downwind distances for which
c                 numerical plume rise will be reported
c          MXNW - Maximum number of downwind distances for numerical
c                 plume rise integration (should be set equal to
c                 SLAST/DS)
c        MXVALZ - Maximum number of heights above ground at which valley
c                 widths are found for each grid cell
c       MXCOAST - Maximum number of coasts provided in COASTLN.DAT file
c       MXPTCST - Maximum number of points used to store all coastlines
c       MXBNDRY - Maximum number of boundaries provided in FLUXBDY.DAT
c       MXPTBDY - Maximum number of points used to store all boundaries
c      MXMETDAT - Maximum number of CALMET.DAT files used in run
c       MXEMDAT - Maximum number of variable emissions files (each type)
c      MXMETSAV - Maximum number of met periods for which source tables
c                 (e.g. numerical rise) are saved
c         MXQ12 - Maximum number of groups of 12 emission rate scaling
c                 factors.  Factors come in groups of 12,24,36, or 96.
c                 These are specified for source-species combinations,
c                 but not all combinations will be filled.  Default
c                 value of MXQ12 assumes that no more than 24 factors
c                 are provided for each source-species combination for
c                 point and area sources.
c
c --- CONTROL FILE READER definitions:
c          MXSG - Maximum number of input groups in control file
c
c --- FORTRAN I/O unit numbers:
c           IO3 - Restart file (RESTARTB.DAT)   - input  - unformatted
c           IO4 - Restart file (RESTARTE.DAT)   - output - unformatted
c           IO5 - Control file (CALPUFF.INP)    - input  - formatted
c           IO6 - List file (CALPUFF.LST)       - output - formatted
c
c           IO7 - Meteorological data file      - input  - unformatted
c                 (CALMET.DAT)
c
c           IO8 - Concentration output file     - output - unformatted
c                 (CONC.DAT)
c           IO9 - Dry flux output file          - output - unformatted
c                 (DFLX.DAT)
c          IO10 - Wet flux output file          - output - unformatted
c                 (WFLX.DAT)
c          IO11 - Visibility output file        - output - unformatted
c                 (VISB.DAT)
c          IO12 - Fog plume data output file    - output - unformatted
c                 (FOG.DAT)
c          IO13 - 2D Temperature output file    - output - unformatted
c                 (TK2D.DAT)
c          IO14 - 2D Density output file        - output - unformatted
c                 (RHO2D.DAT)
c          IO15 - Boundary Condition file       - input  - unformatted
c                 (BCON.DAT)
c          IO19 - Buoyant line sources file     - input  - free format
c                 (LNEMARB.DAT) with arbitrarily
c                 varying location & emissions
c          IO20 - User-specified deposition     - input  - formatted
c                 velocities (VD.DAT)
c          IO22 - Hourly ozone monitoring data  - input  - formatted
c                 (OZONE.DAT)
c          IO23 - Hourly H2O2 monitoring data   - input  - formatted
c                 (H2O2.DAT)
c          IO24 - User-specified chemical       - input  - formatted
c                 transformation rates
c                 (CHEM.DAT)
c          IO25 - User-specified coast line(s)  - input  - free format
c                 for sub-grid TIBL module
c                 (COASTLN.DAT)
c          IO28 - CTSG hill specifications from - input  - formatted
c                 CTDM terrain processor
c                 (HILL.DAT)
c          IO29 - CTSG receptor specifications  - input  - formatted
c                 from CTDM receptor generator
c                 (RECS.DAT)
c          IO30 - Tracking puff/slug data       - output - formatted
c                 (DEBUG.DAT)
c          IO31 - CTDM "tower" data             - input  - formatted
c                 (PROFILE.DAT)
c          IO32 - CTDM surface layer parameters - input  - formatted
c                 (SURFACE.DAT)
c          IO35 - User-specified boundary lines(s)- input- free format
c                 for mass flux calculations
c                 (FLUXBDY.DAT)
c          IO36 - Mass flux data                - output - formatted
c                 (MASSFLX.DAT)
c          IO37 - Mass balance data             - output - formatted
c                 (MASSBAL.DAT)
c         IOPT2 - 1st Pt. source emissions file - input  - unformatted
c                 (PTEMARB.DAT) with arbitrarily           or free fmt
c                 varying point source emissions
c         IOAR2 - 1st Buoyant area sources file - input  - free format
c                 (BAEMARB.DAT) with arbitrarily
c                 varying location & emissions
c         IOVOL - 1st Volume source file        - input  - unformatted
c                 (VOLEMARB.DAT) with arbitrarily          of free fmt
c                 varying location & emissions
c        IOMESG - Fortran unit number for screen- output - formatted
c                 output (NOTE: This unit is
c                 NOT opened -- it must be a
c                 preconnected unit to the screen
c                 -- Screen output can be suppressed
c                 by the input "IMESG" in the
c                 control file)
c           IOX - Fortran unit number for      - scratch - formatted
c                 temporary file of "doc" records
c                 written to header of output files
c
c
c --- GUI memory control parameters:  variable emissions scaling factors
c     for areas, lines, points, and volumes require much memory in GUI.
c     To reduce GUI memory requirement, set one or more of the
c     following parameters to ZERO when such scaling is not required.
c     These parameters have no effect on CALPUFF, but are read by the
c     GUI at execution time.
c
c        MXAVAR - Using scaled area sources?   (1:yes, 0:no)
c        MXLVAR - Using scaled line sources?   (1:yes, 0:no)
c        MXPVAR - Using scaled point sources?  (1:yes, 0:no)
c        MXVVAR - Using scaled volume sources? (1:yes, 0:no)
c
c
c -----------------------------------------------------------------

 
c----------------------------------------------------------------------
c --- PARAMETER statements                                      CALPUFF
c----------------------------------------------------------------------
c --- Specify model version
      character*12 mver, mlevel, mmodel
      parameter(mver='5.8',mlevel='070623')
      parameter(mmodel='CALPUFF')
c
c --- Specify parameters
      parameter(mxpuff=10000)
      parameter(mxspec=20)
      parameter(mxnx=160,mxny=180,mxnz=12)
      parameter(mxnxg=160,mxnyg=180,mxrec=4000)
      parameter(mxrfog=40)
      parameter(mxss=250,mxus=99,mxps=300)
      parameter(mxpt1=100,mxpt2=100,mxarea=100,mxvert=5)
      parameter(mxlines=20,mxlngrp=1,mxvol=20)
      parameter(mxrise=50)
      parameter(mxpdep=20,mxint=9)
      parameter(mxoz=725,mxaq=1)
      parameter(mxhill=20,mxtpts=25,mxrect=1000,mxcntr=21)
      parameter(mxprfz=50)
      parameter(mxent=10,mxntr=50,mxnw=5000)
      parameter(mxvalz=10)
      parameter(mxcoast=10,mxptcst=5000)
      parameter(mxbndry=10,mxptbdy=5000)   ! keep mxbndry LE 20
      parameter(mxmetdat=48, mxemdat=12)
      parameter(mxmetsav=2)
      parameter(mxsg=30)
      parameter(io3=3,io4=4,io5=1,io6=2,io7=7,io8=8,io9=9)
      parameter(io10=10,io11=11,io12=12,io13=13,io14=14,io15=15)
      parameter(io19=19,io20=20,io22=22,io23=23,io24=24)
      parameter(io25=25,io28=28,io29=29,io30=30,io31=31,io32=32)
      parameter(io35=35,io36=36,io37=37)
      parameter(iomesg=0)
      parameter(iox=99)
      parameter(iopt2=100)
      parameter(ioar2=iopt2+mxemdat)
      parameter(iovol=ioar2+mxemdat)
c
c
c --- Compute derived parameters
      parameter(mxbc=2*mxnx+2*mxny)
      parameter(mxnzp1=mxnz+1)
      parameter(mxvertp1=mxvert+1)
      parameter(mxnxy=mxnx*mxny)
      parameter(mxnxyg=mxnxg*mxnyg)
      parameter(mxgsp=mxnxg*mxnyg*mxspec)
      parameter(mxrsp=mxrec*mxspec)
      parameter(mxcsp=mxrect*mxspec)
      parameter(mx2=2*mxspec,mx5=5*mxspec,mx7=7*mxspec)
      parameter(mxp2=2+mxspec,mxp3=3+mxspec)
      parameter(mxp4=4+mxspec,mxp6=6+mxspec)
      parameter(mxp7=7+mxspec,mxp8=8+mxspec,mxp14=mxspec+14)
      parameter(mxpuf6=6*mxpuff)
      parameter(mxlev=mxprfz)
      parameter(mxprfp1=mxprfz+1)
      parameter(mxentp1=mxent+1)
      parameter(mxgrup=mxspec)
      parameter(mxq12=mxspec*(mxpt1+mxarea)*2)
      parameter(mxspar=mxspec*mxarea,mxspln=mxspec*mxlines)
      parameter(mxsppt1=mxspec*mxpt1,mxspvl=mxspec*mxvol)
      parameter(mxspbc=mxspec*mxbc)
c
c --- Specify parameters for sizing GUI:
      parameter(mxavar=1)
      parameter(mxlvar=1)
      parameter(mxpvar=1)
      parameter(mxvvar=1)
c
c --- GENERAL PARAMETER definitions:
c        MXPUFF - Maximum number of active puffs allowed on the
c                 computational grid at one time
c        MXSLUG - Maximum number of active slugs allowed on the
c                 computational grid at one time (can be set to
c                 one if the slug option is not used)
c        MXSPEC - Maximum number of chemical species.  N.B.: Changes
c                 to MXSPEC may also require code changes to BLOCK DATA
c                 and READCF.
c        MXGRUP - Maximum number of Species-Groups.  Results for grouped
c                 species are added together and reported using the
c                 name of the group, rather than the name of one of the
c                 species in the group. (MXGRUP = MXSPEC since specie
c                 names are used as group names whenever group names are
c                 not provided)
c          MXNX - Maximum number of METEOROLOGICAL grid cells in
c                 the X direction
c          MXNY - Maximum number of METEOROLOGICAL grid cells in
c                 the Y direction
c          MXNZ - Maximum number of vertical layers in
c                 the METEOROLOGICAL grid
c         MXNXG - Maximum number of SAMPLING grid cells in
c                 the X direction
c         MXNYG - Maximum number of SAMPLING grid cells in
c                 the Y direction
c         MXREC - Maximum number of non-gridded receptors
c        MXRFOG - Maximum number of distances used when MFOG=1
c                 NOTE:  There are NPT1+NPT2 receptor 'trails', with
c                        MXRFOG receptors on each, so
c                        MXREC >= (NPT1+NPT2)*MXRFOG
c          MXSS - Maximum number of surface meteorological stations
c                 in the CALMET data
c          MXUS - Maximum number of upper air stations in the CALMET
c                 data
c          MXPS - Maximum number of precipitation stations in the
c                 CALMET data
c          MXBC - Maximum number of sources used to represent boundary
c                 conditions (inlux of background mass);  source
c                 segments span the computational domain perimeter
c         MXPT1 - Maximum number of point sources with constant
c                 emission parameters
c         MXPT2 - Maximum number of point sources with time-varying
c                 emission parameters
c        MXAREA - Maximum number of polygon area sources with constant
c                 emission parameters (i.e., non-gridded area sources)
c        MXVERT - Maximum number of vertices in polygon area source
c        MXLINES- Maximum number of line sources
c        MXLNGRP- Maximum number of groups of line sources
c         MXVOL - Maximum number of volume sources
c        MXRISE - Maximum number of points in computed plume rise
c                 tabulation for buoyant area and line sources
c        MXPDEP - Maximum number of particle species dry deposited
c                 (typically set to MXSPEC)
c         MXINT - Maximum number of particle size intervals used
c                 in defining mass-weighted deposition velocities
c          MXOZ - Maximum number of ozone data stations (for use in the
c                 chemistry module)
c          MXAQ - Maximum number of Air Quality data stations (e.g.
c                 H2O2 data stations for aqueous chemistry module)
c        MXHILL - Maximum number of subgrid-scale (CTSG) terrain
c                 features
c        MXTPTS - Maximum number of points used to obtain flow
c                 factors along the trajectory of a puff over the hill
c        MXRECT - Maximum number of complex terrain (CTSG) receptors
c        MXCNTR - Maximum number of hill height contours (CTDM ellipses)
c        MXPRFZ - Maximum number of vertical levels of met. data in
c                 CTDM PROFILE file
c         MXLEV - Maximum number of vertical levels of met. data
c                 allowed in the CTSG module (set to MXPRFZ in the
c                 current implementation of CALPUFF)
c         MXENT - Maximum number of perturbed entrainment coefficients
c                 entered
c         MXNTR - Maximum number of downwind distances for which
c                 numerical plume rise will be reported
c          MXNW - Maximum number of downwind distances for numerical
c                 plume rise integration (should be set equal to
c                 SLAST/DS)
c        MXVALZ - Maximum number of heights above ground at which valley
c                 widths are found for each grid cell
c       MXCOAST - Maximum number of coasts provided in COASTLN.DAT file
c       MXPTCST - Maximum number of points used to store all coastlines
c       MXBNDRY - Maximum number of boundaries provided in FLUXBDY.DAT
c       MXPTBDY - Maximum number of points used to store all boundaries
c      MXMETDAT - Maximum number of CALMET.DAT files used in run
c       MXEMDAT - Maximum number of variable emissions files (each type)
c      MXMETSAV - Maximum number of met periods for which source tables
c                 (e.g. numerical rise) are saved
c         MXQ12 - Maximum number of groups of 12 emission rate scaling
c                 factors.  Factors come in groups of 12,24,36, or 96.
c                 These are specified for source-species combinations,
c                 but not all combinations will be filled.  Default
c                 value of MXQ12 assumes that no more than 24 factors
c                 are provided for each source-species combination for
c                 point and area sources.
c
c --- CONTROL FILE READER definitions:
c          MXSG - Maximum number of input groups in control file
c
c --- FORTRAN I/O unit numbers:
c           IO3 - Restart file (RESTARTB.DAT)   - input  - unformatted
c           IO4 - Restart file (RESTARTE.DAT)   - output - unformatted
c           IO5 - Control file (CALPUFF.INP)    - input  - formatted
c           IO6 - List file (CALPUFF.LST)       - output - formatted
c
c           IO7 - Meteorological data file      - input  - unformatted
c                 (CALMET.DAT)
c
c           IO8 - Concentration output file     - output - unformatted
c                 (CONC.DAT)
c           IO9 - Dry flux output file          - output - unformatted
c                 (DFLX.DAT)
c          IO10 - Wet flux output file          - output - unformatted
c                 (WFLX.DAT)
c          IO11 - Visibility output file        - output - unformatted
c                 (VISB.DAT)
c          IO12 - Fog plume data output file    - output - unformatted
c                 (FOG.DAT)
c          IO13 - 2D Temperature output file    - output - unformatted
c                 (TK2D.DAT)
c          IO14 - 2D Density output file        - output - unformatted
c                 (RHO2D.DAT)
c          IO15 - Boundary Condition file       - input  - unformatted
c                 (BCON.DAT)
c          IO19 - Buoyant line sources file     - input  - free format
c                 (LNEMARB.DAT) with arbitrarily
c                 varying location & emissions
c          IO20 - User-specified deposition     - input  - formatted
c                 velocities (VD.DAT)
c          IO22 - Hourly ozone monitoring data  - input  - formatted
c                 (OZONE.DAT)
c          IO23 - Hourly H2O2 monitoring data   - input  - formatted
c                 (H2O2.DAT)
c          IO24 - User-specified chemical       - input  - formatted
c                 transformation rates
c                 (CHEM.DAT)
c          IO25 - User-specified coast line(s)  - input  - free format
c                 for sub-grid TIBL module
c                 (COASTLN.DAT)
c          IO28 - CTSG hill specifications from - input  - formatted
c                 CTDM terrain processor
c                 (HILL.DAT)
c          IO29 - CTSG receptor specifications  - input  - formatted
c                 from CTDM receptor generator
c                 (RECS.DAT)
c          IO30 - Tracking puff/slug data       - output - formatted
c                 (DEBUG.DAT)
c          IO31 - CTDM "tower" data             - input  - formatted
c                 (PROFILE.DAT)
c          IO32 - CTDM surface layer parameters - input  - formatted
c                 (SURFACE.DAT)
c          IO35 - User-specified boundary lines(s)- input- free format
c                 for mass flux calculations
c                 (FLUXBDY.DAT)
c          IO36 - Mass flux data                - output - formatted
c                 (MASSFLX.DAT)
c          IO37 - Mass balance data             - output - formatted
c                 (MASSBAL.DAT)
c         IOPT2 - 1st Pt. source emissions file - input  - unformatted
c                 (PTEMARB.DAT) with arbitrarily           or free fmt
c                 varying point source emissions
c         IOAR2 - 1st Buoyant area sources file - input  - free format
c                 (BAEMARB.DAT) with arbitrarily
c                 varying location & emissions
c         IOVOL - 1st Volume source file        - input  - unformatted
c                 (VOLEMARB.DAT) with arbitrarily          of free fmt
c                 varying location & emissions
c        IOMESG - Fortran unit number for screen- output - formatted
c                 output (NOTE: This unit is
c                 NOT opened -- it must be a
c                 preconnected unit to the screen
c                 -- Screen output can be suppressed
c                 by the input "IMESG" in the
c                 control file)
c           IOX - Fortran unit number for      - scratch - formatted
c                 temporary file of "doc" records
c                 written to header of output files
c
c
c --- GUI memory control parameters:  variable emissions scaling factors
c     for areas, lines, points, and volumes require much memory in GUI.
c     To reduce GUI memory requirement, set one or more of the
c     following parameters to ZERO when such scaling is not required.
c     These parameters have no effect on CALPUFF, but are read by the
c     GUI at execution time.
c
c        MXAVAR - Using scaled area sources?   (1:yes, 0:no)
c        MXLVAR - Using scaled line sources?   (1:yes, 0:no)
c        MXPVAR - Using scaled point sources?  (1:yes, 0:no)
c        MXVVAR - Using scaled volume sources? (1:yes, 0:no)
c
c
c -----------------------------------------------------------------

 c----------------------------------------------------------------------
c --- COMMON BLOCK /PDF/ -- PDF dispersion variables            CALPUFF
c----------------------------------------------------------------------
c
      logical lpdf
      common/pdf/lpdf,swupf,swdnf,szupb,szdnb,wup,wdn,zup,zdn,
     &           wtup,wtdn,risq,ryz,dhfac,rfacsq
c
c --- COMMON BLOCK /PDF/ Variables:
c          LPDF - logical - PDF computation active when .TRUE.
c         SWUPF - real    - Updraft (sigma-w / full sigma-w)**2
c         SWDNF - real    - Downdraft (sigma-w / full sigma-w)**2
c         SZUPB - real    - Updraft BID**2 term (m2)
c         SZDNB - real    - Downdraft BID**2 term (m2)
c           WUP - real    - Updraft w (indirect path)(m/s)
c           WDN - real    - Downdraft w (direct path)(m/s)
c           ZUP - real    - Updraft puff ht (m)
c           ZDN - real    - Downdraft puff ht (m)
c          WTUP - real    - Updraft path weight (indirect path)
c          WTDN - real    - Downdraft path weight (direct path)
c          RISQ - real    - Initial plume radius (squared) at CBL
c                           top (m^2)
c           RYZ - real    - Growth rate of elliptical plume
c                           crossection (m**2/s**2)
c         DHFAC - real    - Effective rise factor, where effective
c                           rise given by t*dhfac/SQRT(risq+ryz*t^2)
c        RFACSQ - real    - Gradual rise adj to BID**2
c----------------------------------------------------------------------
c --- COMMON BLOCK /PT1/ -- Emission parameters for sources     CALPUFF
c                           with constant emission characeristics
c----------------------------------------------------------------------
      character*16 cnampt1
c
      common/PT1/XPT1GRD(mxpt1),YPT1GRD(mxpt1),HTSTAK(mxpt1),
     1 ELSTAK(mxpt1),DIAM(mxpt1),EXITW(mxpt1),TSTAK(mxpt1),
     2 IDOWNW(mxpt1),QSTAK(mxspec,mxpt1),NPT1,
     3 syipt1(mxpt1),szipt1(mxpt1),fmfpt1(mxpt1),zplatpt1(mxpt1),
     4 NEWPT1(mxpt1),BWIDTH(36,mxpt1),BHT(36,mxpt1),
     5 BLN1(36,mxpt1),XBADJ1(36,mxpt1),YBADJ1(36,mxpt1),
     6 IPTU,ivpt1(mxspec,mxpt1),iq12pt1(mxspec,mxpt1),
     7 NTRPT1(mxpt1),XTRPT1(mxrise,mxpt1),ZTRPT1(mxrise,mxpt1),
     8 RTRPT1(mxrise,mxpt1),HTRPT1(mxrise,mxpt1),
     9 NWKPT1(mxpt1),XWKPT1(mxrise,mxpt1),SYWKPT1(mxrise,mxpt1),
     & SZWKPT1(mxrise,mxpt1),DRWKPT1(mxrise,mxpt1),
     1 NCVPT1(mxpt1),XCVPT1(mxrise,mxpt1),SYCVPT1(mxrise,mxpt1),
     2 SZCVPT1(mxrise,mxpt1),FQCVPT1(mxpt1),
     3 CNAMPT1(mxpt1)
c
c --- COMMON BLOCK /PT1/ Variables:
c        XPT1GRD(mxpt1) - real     - X coordinate of the stack (in met.
c                                    grid units w/ origin at (0.0,0.0))
c        YPT1GRD(mxpt1) - real     - Y coordinate of the stack (in met.
c                                    grid units w/ origin at (0.0,0.0))
c         HTSTAK(mxpt1) - real     - Stack height (m)
c         ELSTAK(mxpt1) - real     - Stack base elevation (m) above
c                                    sea level
c           DIAM(mxpt1) - real     - Stack diameter (m)
c          EXITW(mxpt1) - real     - Exit velocity (m/s)
c          TSTAK(mxpt1) - real     - Exit temperature (deg. K)
c         IDOWNW(mxpt1) - real     - Building downwash flag (0=no, 1=yes)
c   QSTAK(mxspec,mxpt1) - real     - Emission rate (g/s) for each
c                                    pollutant
c                  NPT1 - integer  - Number of sources with constant
c                                    emission parameters
c         SYIPT1(mxpt1) - real     - Initial sigma-y (m)  [optional]
c         SZIPT1(mxpt1) - real     - Initial sigma-z (m)  [optional]
c         FMFPT1(mxpt1) - real     - Momentum flux factor (0 or 1)
c       ZPLATPT1(mxpt1) - real     - Platform height (m AGL) [optional]
c         NEWPT1(mxpt1) - integer  - Number of puffs released by each
c                                    source during the current time step
c      BWIDTH(36,mxpt1) - real     - Wind direction specific building
c                                    widths (m)
c         BHT(36,mxpt1) - real     - Wind direction specific building
c                                    heights (m)
c        BLN1(36,mxpt1) - real     - Wind direction specific building
c                                    lengths (m)
c      XBADJ1(36,mxpt1) - real     - Wind direction specific along-wind
c                                    distance from stack to center of
c                                    upwind face of projected building,
c                                    x-axis lies along the flow (m)
c      YBADJ1(36,mxpt1) - real     - Wind direction specific cross-wind
c                                    distance from stack to center of
c                                    upwind face of projected building,
c                                    x-axis lies along the flow (m)
c                  IPTU - integer  - Units for emission rates in
c                                    control file
c                                    1:   g/s
c                                    2:  kg/hr
c                                    3:  lb/hr
c                                    4:  ton/yr
c                                    5:  Odour Unit * m**3/s
c                                    6:  Odour Unit * m**3/min
c   IVPT1(mxspec,mxpt1) - integer  - IVARY flag defining how emission
c                                    rate scaling factors vary
c                                    0:  NO variation
c                                    1:  Diurnal (24 values)
c                                    2:  Monthly (12 values)
c                                    3:  Hour & Season (96 values)
c                                    4:  Speed & Stability (36 values)
c                                    5:  Temperature (12 values)
c IQ12PT1(mxspec,mxpt1) - integer  - Pointer for starting address in
c                                    VQFAC array to assign scaling
c                                    factors for this source/species
c        CNAMPT1(mxpt1) - c*16 arr - Source names
c
c ---  Numerical Plume Rise & PRIME Downwash Arrays ---
c
c        NTRPT1(mxpt1) - integer  - Number points in trajectory arrays
c XTRPT1(mxrise,mxpt1) - real     - Downwind distance (m) of trajectory
c ZTRPT1(mxrise,mxpt1) - real     - Height (m AGL) of trajectory
c RTRPT1(mxrise,mxpt1) - real     - Plume radius (m)
c HTRPT1(mxrise,mxpt1) - real     - Plume rise (m) without streamline
c                                   modifications (used for BID)
c
c        NWKPT1(mxpt1) - integer  - Number points in wake arrays
c XWKPT1(mxrise,mxpt1) - real     - Downwind distance (m) from primary
c                                   source in wake region
cSYWKPT1(mxrise,mxpt1) - real     - Sigma-y (m) for primary source
cSZWKPT1(mxrise,mxpt1) - real     - Sigma-z (m) for primary source
cDRWKPT1(mxrise,mxpt1) - real     - Plume growth rate expressed as
c                                   d/dx(plume radius) for equivalent
c                                   top-hat
c
c        NCVPT1(mxpt1) - integer  - Number points in cavity arrays
c XCVPT1(mxrise,mxpt1) - real     - Downwind distance (m) from cavity
c                                   source in wake region
cSYCVPT1(mxrise,mxpt1) - real     - Sigma-y (m) for cavity source
cSZCVPT1(mxrise,mxpt1) - real     - Sigma-z (m) for cavity source
c       FQCVPT1(mxpt1) - real     - Fraction of emission rate captured
c                                   in the cavity

c----------------------------------------------------------------------
c --- COMMON BLOCK /PT2/ -- Pt. source emission parameters      CALPUFF
c                           Arbitrarily-varying (PTEMARB)
c----------------------------------------------------------------------
c
      character*12 fname2,label2,cslst2
      character*16 cid2
c
      common/PT2/NPT2,IUTMZ2,NSE2,XNLAT1PT2,XNLAT2PT2,RNLAT0PT2,
     1           RWLON0PT2,MFPT2(mxemdat),IVRS2(mxemdat),
     2           IBSRC2(mxemdat),IESRC2(mxemdat),IBDAT2(mxemdat),
     3           IBTIM2(mxemdat),IEDAT2(mxemdat),IETIM2(mxemdat),
     4           XMWEM2(mxspec),IXREM2(mxspec),TIEM2(8,mxpt2),
     5           BHT2(36,mxpt2),BWD2(36,mxpt2),BLN2(36,mxpt2),
     6           XBADJ2(36,mxpt2),YBADJ2(36,mxpt2),ZPLATPT2(mxpt2),
     7           IBEG2(mxemdat),IEND2(mxemdat),TSTAK2(mxpt2),
     8           EXITW2(mxpt2),SYIPT2(mxpt2),SZIPT2(mxpt2),
     9           QSTAK2(mxspec,mxpt2),NEWPT2(mxpt2),
     1       NTRPT2(mxpt2),XTRPT2(mxrise,mxpt2),ZTRPT2(mxrise,mxpt2),
     2       RTRPT2(mxrise,mxpt2),HTRPT2(mxrise,mxpt2),
     3       NWKPT2(mxpt2),XWKPT2(mxrise,mxpt2),SYWKPT2(mxrise,mxpt2),
     4       SZWKPT2(mxrise,mxpt2),DRWKPT2(mxrise,mxpt2),
     5       NCVPT2(mxpt2),XCVPT2(mxrise,mxpt2),SYCVPT2(mxrise,mxpt2),
     6       SZCVPT2(mxrise,mxpt2),FQCVPT2(mxpt2),
     7           FNAME2,LABEL2(mxemdat),CSLST2(mxspec),CID2(mxpt2)
c
c --- COMMON BLOCK /PT2/ Variables:
c             NPT2 - integer    - Number of pt. sources in the file
c           IUTMZ2 - integer    - UTM zone in which stack coordinates
c                                 are specified
c             NSE2 - integer    - Number of emitted species in the file
c        XNLAT1PT2 - real       - Standard parallel #1 for LC map
c                                 projection (degrees N. Latitude)
c        XNLAT2PT2 - real       - Standard parallel #1 for LC map
c                                 projection (degrees N. Latitude)
c        RNLAT0PT2 - real       - N. Latitude of origin of LC map
c                                 projection (degrees)
c        RWLON0PT2 - real       - W. Longitude of origin of LC map
c                                 projection (degrees)
c   MFPT2(mxemdat) - integer    - Flag for file type
c                                 0: UNFORMATTED
c                                 1: FORMATTED
c   IVRS2(mxemdat) - integer    - Data set version expressed as integer
c                                 (5.4 is 54)
c  IBSRC2(mxemdat) - integer    - Index for first source in a
c                                 PTEMARB.DAT file
c  IESRC2(mxemdat) - integer    - Index for last source in a
c                                 PTEMARB.DAT file
c  IBDAT2(mxemdat) - integer    - Date of the first data record in the
c                                 file  (YYYYJJJ, where YYYY=year,
c                                 JJJ=Julian day)
c  IBTIM2(mxemdat) - integer    - Hour of the first data record in the
c                                 file  (00-23 LST)
c  IEDAT2(mxemdat) - integer    - Date of the last data record in the
c                                 file  (YYYYJJJ, where YYYY=year,
c                                 JJJ=Julian day)
c  IETIM2(mxemdat) - integer    - Hour of the last data record in the
c                                 file  (00-23 LST)
c   XMWEM2(mxspec) - real       - Molecular weight for each species
c   IXREM2(mxspec) - integer    - Cross referencing array of NSE2
c                                 values relating species ordering
c                                 in the emissions file to the
c                                 ordering in the main conc. array
c   TIEM2(8,mxpt2) - real       - Time-invariant data for arbitrarily-
c                                 varying point source emissions
c                                 (1,-) = X coordinate of source (in
c                                         met. grid units -- converted
c                                         from UTM data in PTEMARB file)
c                                 (2,-) = Y coordinate of source (in
c                                         met. grid units -- converted
c                                         from UTM data in PTEMARB file)
c                                 (3,-) = Stack height (m)
c                                 (4,-) = Stack diameter (m)
c                                 (5,-) = Stack base elevation (m)
c                                 (6,-) = Building downwash flag
c                                         0. No downwash
c                                         1. Downwash bldgs on surface
c                                         2. Downwash bldgs raised
c                                 (7,-) = Vertical momentum flux factor
c                                         (0.0 to 1.0) to simulate rain
c                                         hat structures
c                                 (8,-) = User-defined flag (e.g.,
c                                         fuel code)
c  ZPLATPT2(mxpt2) - real       - Platform height for elevated bldgs (m)
c                                 (provided if BDW flag is 2.)
c   BHT2(36,mxpt2) - real       - Array of direction-specific bldg hts
c                                 (above platform if BDW flag is 2.)
c                                 for each 10 deg. from N (m)
c   BWD2(36,mxpt2) - real       - Array of direction-specific building
c                                 widths for each 10 deg. from N (m)
c   BLN2(36,mxpt2) - real       - Wind direction specific building
c                                 lengths (m)
c XBADJ2(36,mxpt2) - real       - Wind direction specific along-wind
c                                 distance from stack to center of
c                                 upwind face of projected building,
c                                 x-axis lies along the flow (m)
c YBADJ2(36,mxpt2) - real       - Wind direction specific cross-wind
c                                 distance from stack to center of
c                                 upwind face of projected building,
c                                 x-axis lies along the flow (m)
c
c ---  Variable data  ---
c        IBEG2(mxemdat) - integer  - Starting time for which emissions
c                                    data in current set of
c                                    records is valid (YYYYJJJHH)
c        IEND2(mxemdat) - integer  - Ending time for which emissions
c                                    data in current set of
c                                    records is valid (YYYYJJJHH)
c         TSTAK2(mxpt2) - real     - Exit temperature (deg. K)
c         EXITW2(mxpt2) - real     - Exit velocity (m/s)
c         SYIPT2(mxpt2) - real     - Initial sigma-y (m)
c         SZIPT2(mxpt2) - real     - Initial sigma-z (m)
c  QSTAK2(mxspec,mxpt2) - real     - Emission rate (g/s) for each
c         NEWPT2(mxpt2) - integer  - Number of puffs released by each
c                                    source during the current time step
c
c ---  Numerical Plume Rise & PRIME Downwash Arrays ---
c
c        NTRPT2(mxpt2) - integer  - Number points in trajectory arrays
c XTRPT2(mxrise,mxpt2) - real     - Downwind distance (m) of trajectory
c ZTRPT2(mxrise,mxpt2) - real     - Height (m AGL) of trajectory
c RTRPT2(mxrise,mxpt2) - real     - Plume radius (m)
c HTRPT2(mxrise,mxpt2) - real     - Plume rise (m) without streamline
c                                   modifications (used for BID)
c
c        NWKPT2(mxpt2) - integer  - Number points in wake arrays
c XWKPT2(mxrise,mxpt2) - real     - Downwind distance (m) in wake
cSYWKPT2(mxrise,mxpt2) - real     - Sigma-y (m) in wake
cSZWKPT2(mxrise,mxpt2) - real     - Sigma-z (m) in wake
cDRWKPT2(mxrise,mxpt2) - real     - Plume growth rate expressed as
c                                   d/dx(plume radius) for equivalent
c                                   top-hat
c
c        NCVPT2(mxpt2) - integer  - Number points in cavity arrays
c XCVPT2(mxrise,mxpt2) - real     - Downwind distance (m) in cavity
cSYCVPT2(mxrise,mxpt2) - real     - Sigma-y (m) in cavity
cSZCVPT2(mxrise,mxpt2) - real     - Sigma-z (m) in cavity
c       FQCVPT2(mxpt2) - real     - Fraction of emission rate captured
c                                   in the cavity
c
c ---  Character data ---
c           FNAME2 - char*12    - Data set name "PTEMARB"
c  LABEL2(mxemdat) - char*12    - Data set label
c   CSLST2(mxspec) - char*12    - Species identifiers
c      CID2(mxpt2) - char*16    - Source identifiers
c----------------------------------------------------------------------
c --- COMMON BLOCK /PUFF/ -- Puff characteristics               CALPUFF
c----------------------------------------------------------------------
c
      common/puff/xpb(mxpuff),ypb(mxpuff),zpb(mxpuff),
     1 zimax(mxpuff),ziold(mxpuff),zitibl(mxpuff),
     2 sigyb(mxpuff),sigzb(mxpuff),xtotb(mxpuff),
     3 tmtotb(mxpuff),zfinal(mxpuff),xfinal(mxpuff),bidfnl(mxpuff),
     4 fb(mxpuff),fm(mxpuff),xbfin(mxpuff),xmfin(mxpuff),zbfin(mxpuff),
     5 zmfin(mxpuff),stipdw(mxpuff),qu(mxspec,mxpuff),qm(mxspec,mxpuff),
     6 irlsnum(mxpuff),isrcnum(mxpuff),isrctyp(mxpuff),
     7 ipufcd(mxpuff),elbase(mxpuff),
     8 tcon(3,2,mxpuff),npuffs,isplit(mxpuff),
     9 idw0(mxpuff),ht0(mxpuff),exitw0(mxpuff),diam0(mxpuff),
     1 ws0(mxpuff),istab0(mxpuff),sqrts0(mxpuff),srat0(mxpuff),
     2 temit0(mxpuff),hb0(mxpuff),hw0(mxpuff),heff20(mxpuff),
     3 iru0(mxpuff),sigv0(mxpuff),sigw0(mxpuff),el0(mxpuff),
     4 plexp0(mxpuff),zly0(mxpuff),r0(mxpuff),
     5 sysrc0(mxpuff),szsrc0(mxpuff),
     6 xshift0(mxpuff),sy0(mxpuff),sz0(mxpuff)
c
c --- COMMON BLOCK /PUFF/ Variables:
c       XPB(mxpuff) - real    - Met. grid X coordinate of puff center
c                               (or youngest end of slug)
c       YPB(mxpuff) - real    - Met. grid Y coordinate of puff center
c                               (or youngest end of slug)
c       ZPB(mxpuff) - real    - Height above ground (m) of puff center
c     ZIMAX(mxpuff) - real    - Highest mixing ht. (m) to which puff
c                               has been exposed
c     ZIOLD(mxpuff) - real    - Previous hour's mixing ht. (m) for the
c                               puff
c    ZITIBL(mxpuff) - real    - Current TIBL height (m) for the puff
c                               <0: no TIBL interaction anticipated
c                               =0: TIBL interaction possible, but puff
c                                   has not crossed coastline
c                               >0: TIBL active
c     SIGYB(mxpuff) - real    - Sigma y (m) for the puff center (or
c                               youngest end of slug) without BID
c     SIGZB(mxpuff) - real    - Sigma z (m) for the puff center (or
c                               youngest end of slug) without BID
c     XTOTB(mxpuff) - real    - Total integrated travel distance (m) of
c                               the puff (or youngest end of slug) at
c                               start of step
c    TMTOTB(mxpuff) - real    - Total integrated travel time (s) of
c                               the puff (or youngest end of slug) at
c                               start of step
c    ZFINAL(mxpuff) - real    - Final effective plume height (m) of
c                               the puff center (or youngest end of
c                               slug)
c                               (i.e., stack height + plume rise)
c    XFINAL(mxpuff) - real    - Distance to final plume rise (m)
c    BIDFNL(mxpuff) - real    - Buoyancy-enhanced sigma, squared (m^2)
c        FB(mxpuff) - real    - Buoyancy flux (m**4/s**3)
c        FM(mxpuff) - real    - Momentum flux (m**4/s**2)
c     XBFIN(mxpuff) - real    - Distance to final buoyant rise (m)
c     XMFIN(mxpuff) - real    - Distance to final momentum rise (m)
c     ZBFIN(mxpuff) - real    - Height of final buoyant rise (m)
c     ZMFIN(mxpuff) - real    - Height of final momentum rise (m)
c    STIPDW(mxpuff) - real    - Stack-tip downwash magnitude (m)
c QU(mxspec,mxpuff) - real    - Pollutant mass (g) in the layer above
c                               the mixing height
c QM(mxspec,mxpuff) - real    - Pollutant mass (g) in the layer below
c                               the mixing height
c   IRLSNUM(mxpuff) - integer - The number of the puff released this
c   ISRCNUM(mxpuff) - integer - step from source #ISRCNUM 
c   ISRCTYP(mxpuff) - integer - of type ISRCTYP
c                               Source Types are:
c                                1 = Point         Constant Emissions
c                                2 = Point         Variable Emissions
c                                3 = Poly. Area    Constant Emissions
c                                4 = Poly. Area    Variable Emissions
c                                5 = Line          Constant Emissions
c                                6 = Line          Variable Emissions
c                                7 = Volume        Constant Emissions
c                                8 = Grid Volume   Variable Emissions
c                                9 = Boundary Condition
c    IPUFCD(mxpuff) - integer - Puff status code:
c                                1 = Puff within mixed layer & Gaussian
c                                2 = Puff within mixed layer & uniform
c                                3 = Puff above mixed layer & Gaussian
c                                4 = Puff above mixed layer & uniform
c                                5 = Puff currently above mixed layer
c                                    (but previously below) & Gaussian
c                                6 = Puff currently above mixed layer
c                                    (but previously below) & uniform
c                               11 = Slug within mixed layer & Gaussian
c                               12 = Slug within mixed layer & uniform
c                               13 = Slug above mixed layer & Gaussian
c                               14 = Slug above mixed layer & uniform
c                               15 = Slug currently above mixed layer
c                                    (but previously below) & Gaussian
c                               16 = Slug currently above mixed layer
c                                    (but previously below) & uniform
c                               99 = Puff/slug off computational grid
c    ELBASE(mxpuff) - real    - Stack base elevation (m) of source
c                               emitting current puff/slug
c  TCON(3,2,mxpuff) - real    - Average puff concentrations
c                               (g/m**3) within each puff
c                                  (1,-,-) = SO4
c                                  (2,-,-) = NOx (NO + NO2 as NO2)
c                                  (3,-,-) = TNO3 (HNO3 + NO3 as NO3)
c                                  (-,1,-) = within mixed layer
c                                  (-,2,-) = above mixed layer
c            NPUFFS - integer - Total number of puffs or slugs
c----------------------------------------------------------------------
c -----   Puff Splitting Information  -----
c----------------------------------------------------------------------
c    ISPLIT(mxpuff) - integer - Flag indicating if puff may be split
c                               0: Do not split this puff
c                               1: Split this puff
c----------------------------------------------------------------------
c -----   Data associated with puff at the time of release  -----
c----------------------------------------------------------------------
c      IDW0(mxpuff) - integer - Downwash flag: 0 = no bldg downwash
c                                              1 = H-S downwash
c                                              2 = S-S downwash
c                                              3 = PRIME downwash
c                                                  (primary source)
c                                              4 = PRIME downwash
c                                                  (cavity source)
c       HT0(mxpuff) - real    - Height at which puff was released (m)
c    EXITW0(mxpuff) - real    - Exit velocity (m/s)
c     DIAM0(mxpuff) - real    - Stack diameter (m)
c       WS0(mxpuff) - real    - Stack height wind speed (m/s)
c    ISTAB0(mxpuff) - real    - Stability class
c    SQRTS0(mxpuff) - real    - SQRT of the stability parameter "S"
c     SRAT0(mxpuff) - real    - Ratio of vector to scalar wind speed
c    TEMIT0(mxpuff) - real    - Duration of emission (s)
c       HB0(mxpuff) - real    - Direction-specific building height (m)
c       HW0(mxpuff) - real    - Direction-specific building width (m)
c    HEFF20(mxpuff) - real    - Height of gradual rise at 2*HB (m)
c      ZLY0(mxpuff) - real    - Effective line length based on sigma-y
c                               at 3*HL
c        R0(mxpuff) - real    - Effective source radius based on sigma-z
c                               at 3*HL
c      IRU0(mxpuff) - integer - Rural(0)/Urban(1) indicator
c     SIGV0(mxpuff) - real    - Sigma-v velocity (m/s)
c     SIGW0(mxpuff) - real    - Sigma-w velocity (m/s)
c       EL0(mxpuff) - real    - Monin-Obukhov length (m)
c    PLEXP0(mxpuff) - real    - Power law wind shear exponent
c    SYSRC0(mxpuff) - real    - Initial sigma-y (m) for source
c    SZSRC0(mxpuff) - real    - Initial sigma-z (m) for source
c----------------------------------------------------------------------
c   XSHIFT0(mxpuff) - real    - Distance from source to the end of
c                               the cavity (+15%) for a point source
c                               with PRIME downwash (m)
c                               [puff contributions are not computed
c                               over this distance]
c       ---   OR   ---
c   XSHIFT0(mxpuff) - real    - Distance of center of element on line
c                               source from upwind edge (m)
c----------------------------------------------------------------------
c       SY0(mxpuff) - real    - Initial sigma-y (m) due to
c                               downwash (line source), or other effects
c       SZ0(mxpuff) - real    - Initial sigma-z (m) due to
c                               downwash (line source), or other effects
c----------------------------------------------------------------------
c----------------------------------------------------------------------
c --- COMMON BLOCK /QA/ -- Model QA parameters                  CALPUFF
c----------------------------------------------------------------------
c
      character*12 ver,level
      character*8 rtime
      character*10 rdate
c
      common/QA/ncommout,rcpu,ver,level,rdate,rtime
c
c --- COMMON BLOCK /QA/ Variables:
c     NCOMMOUT - integer     - Number of comment lines written to
c        RCPU - real         - Computed CPU time of the run
c         VER - character*12 - Version number of CALPUFF
c       LEVEL - character*12 - Level number of CALPUFF
c       RDATE - character*8  - System date at start of run
c                              (MM-DD-YYYY)
c       RTIME - character*8  - System time at start of run
c                              (HH:MM:SS)
c----------------------------------------------------------------------
c --- COMMON BLOCK /SLUG/ -- Slug parameters                    CALPUFF
c----------------------------------------------------------------------
c
      common/slug/xpe(mxpuff),ype(mxpuff),zpe(mxpuff),sigye(mxpuff),
     1 sigze(mxpuff),xtote(mxpuff),tmtote(mxpuff),speed0(mxpuff)
c
c --- COMMON BLOCK /SLUG/ Variables:
c    XPE(mxpuff) - real    - Met. grid X coordinate of
c                            oldest end of slug
c    YPE(mxpuff) - real    - Met. grid Y coordinate of
c                            oldest end of slug
c    ZPE(mxpuff) - real    - Height above ground (m) of
c                            oldest end of slug after rise
c                            (i.e., stack height + plume rise)
c  SIGYE(mxpuff) - real    - Sigma y (m) for the
c                            oldest end of slug without BID
c  SIGZE(mxpuff) - real    - Sigma z (m) for the
c                            oldest end of slug without BID
c  XTOTE(mxpuff) - real    - Total integrated travel distance (m) of
c                            the oldest end of slug
c TMTOTE(mxpuff) - real    - Total integrated travel time (s) of
c                            the oldest end of slug
c----------------------------------------------------------------------
c -----   Data associated with slug at the time of release  -----
c----------------------------------------------------------------------
c SPEED0(mxpuff) - real    - Transport (elongation) speed of fresh
c                            slug (m/s)
c----------------------------------------------------------------------
c --- COMMON BLOCK /SOA/ -- Data used in SOA module             CALPUFF
c
c----------------------------------------------------------------------
c
      logical larom,lbiog
      common/SOA/LBIOG,LAROM,AMO,VC2NX
c
c --- COMMON BLOCK /SOA/ Variables:
c
c           LBIOG - logical - Biogenic species emitted/modeled ?
c           LAROM - logical - Aromatic species emitted/modeled ?
c             AMO - real    - Organic mass of fine particulates (ug/m3)
c           VC2NX - real    - VOC / NOX ratio (after reaction)
c
c----------------------------------------------------------------------
c --- COMMON BLOCK /TIBL/ -- Current TIBL Arrays                CALPUFF
c----------------------------------------------------------------------
c
      parameter (mxtibl=10)
      common/TIBL/ntibl,ixtibl(mxtibl),iytibl(mxtibl),
     &            htibl(mxtibl),tstibl(mxtibl),
     &            x2zi1,x2zi2,xupgrd
c
c --- COMMON BLOCK /TIBL/ Variables:
c
c                NTIBL - integer - Number of sampling sub-steps defined
c   I[X,Y]TIBL(mxtibl) - integer - Cell (i,j) for surface properties
c        HTIBL(mxtibl) - real    - Average TIBL height (m) for sub-step
c       TSTIBL(mxtibl) - real    - Sampling time for sub-step as a 
c                                  fraction of full sampling step
c                x2zi1 - real    - Effective distance (m) from coast to
c                                  start transition to CALMET mixing hts
c                x2zi2 - real    - Effective distance (m) from coast to
c                                  stop transition to CALMET mixing hts
c               xupgrd - real    - Distance (met grid) upwind of source
c                                  to search for a coast segmentc----------------------------------------------------------------------
c --- COMMON BLOCK /VOL1/ -- Volume source data for discrete    CALPUFF
c                            sources with constant emissions
c----------------------------------------------------------------------
      character*16 CNAMVL1
c
      common/VOL1/XVL1GRD(mxvol),YVL1GRD(mxvol),HTVL1(mxvol),
     1 ELVL1(mxvol),SY0VL1(mxvol),SZ0VL1(mxvol),QVL1(mxspec,mxvol),
     2 NEWVL1(mxvol),NVL1,
     3 IVLU,ivvl1(mxspec,mxvol),iq12vl1(mxspec,mxvol),
     4 CNAMVL1(mxvol)
c
c --- COMMON BLOCK /VOL1/ Variables:
c
c         XVL1GRD(mxvol) - real     - X coordinate of a volume
c                                     source in grid units
c                                     (i.e., origin at (0.0,0.0))
c         YVL1GRD(mxvol) - real     - Y coordinate of a volume
c                                     source in grid units
c                                     (i.e., origin at (0.0,0.0))
c           HTVL1(mxvol) - real     - Effective release height (m)
c           ELVL1(mxvol) - real     - Ground elevation (m) above sea
c                                     level
c          SY0VL1(mxvol) - real     - Initial sigma y (m)
c          SZ0VL1(mxvol) - real     - Initial sigma z (m)
c     QVL1(mxspec,mxvol) - real     - Emission rate (g/s) for each
c                                     pollutant
c                   NVL1 - integer  - Number of volume sources
c          NEWVL1(mxvol) - integer  - Number of puffs released by each
c                                     source during the current step
c                   IVLU - integer  - Units for emission rates in
c                                     control file
c                                     1:   g/s
c                                     2:  kg/hr
c                                     3:  lb/hr
c                                     4:  ton/yr
c                                     5:  Odour Unit * m**3/s
c                                     6:  Odour Unit * m**3/min
c    IVVL1(mxspec,mxvol) - integer  - IVARY flag defining how emission
c                                     rate scaling factors vary
c                                     0:  NO variation
c                                     1:  Diurnal (24 values)
c                                     2:  Monthly (12 values)
c                                     3:  Hour & Season (96 values)
c                                     4:  Speed & Stability (36 values)
c                                     5:  Temperature (12 values)
c  IQ12VL1(mxspec,mxvol) - integer  - Pointer for starting address in
c                                     VQFAC array to assign scaling
c                                     factors for this source/species
c         CNAMVL1(mxvol) - c*16 arr - Source names
c----------------------------------------------------------------------
c --- COMMON BLOCK /VOL2/   -- Volume source data for sources   CALPUFF
c                              with variable characterisitics
c                              in VOLEMARB.DAT files
c----------------------------------------------------------------------
c
      character*12 fname4,label4,cslst4
      character*16 cid4
c
      common/VOL2/ NVL2,IUTMZ4,NSE4,XNLAT1VL2,XNLAT2VL2,RNLAT0VL2,
     1             RWLON0VL2,MFVL2(mxemdat),IVRS4(mxemdat),
     2             IBSRC4(mxemdat),IESRC4(mxemdat),IBDAT4(mxemdat),
     3             IBTIM4(mxemdat),IEDAT4(mxemdat),IETIM4(mxemdat),
     4             XMWEM4(mxspec),IXREM4(mxspec),IBEG4(mxemdat),
     5             IEND4(mxemdat),XVL2GRD(mxvol),YVL2GRD(mxvol),
     6             HTVL2(mxvol),ELVL2(mxvol),SY0VL2(mxvol),
     7             SZ0VL2(mxvol),QVL2(mxspec,mxvol),NEWVL2(mxvol),
     8             FNAME4,LABEL4(mxemdat),CSLST4(mxspec),
     9             CID4(mxvol)
c
c --- COMMON BLOCK /VOL2/ Variables:
c             NVL2 - integer    - Number of volume sources
c           IUTMZ4 - integer    - UTM zone in which source coordinates
c                                 are specified
c             NSE4 - integer    - Number of emitted species in the file
c        XNLAT1VL2 - real       - Standard parallel #1 for LC map
c                                 projection (degrees N. Latitude)
c        XNLAT2VL2 - real       - Standard parallel #1 for LC map
c                                 projection (degrees N. Latitude)
c        RNLAT0VL2 - real       - N. Latitude of origin of LC map
c                                 projection (degrees)
c        RWLON0VL2 - real       - W. Longitude of origin of LC map
c                                 projection (degrees)
c   MFVL2(mxemdat) - integer    - Flag for file type
c                                 0: UNFORMATTED
c                                 1: FORMATTED
c   IVRS4(mxemdat) - integer    - Data set version expressed as integer
c                                 (5.4 is 54)
c  IBSRC4(mxemdat) - integer    - Index for first source in a VOLEMARB.DAT
c                                 file
c  IESRC4(mxemdat) - integer    - Index for last source in a VOLEMARB.DAT
c                                 file
c  IBDAT4(mxemdat) - integer    - Date of the first data record in the
c                                 file  (YYYYJJJ, where YYYY=year,
c                                 JJJ=Julian day)
c  IBTIM4(mxemdat) - integer    - Hour of the first data record in the
c                                 file  (00-23 LST)
c  IEDAT4(mxemdat) - integer    - Date of the last data record in the
c                                 file  (YYYYJJJ, where YYYY=year,
c                                 JJJ=Julian day)
c  IETIM4(mxemdat) - integer    - Hour of the last data record in the
c                                 file  (00-23 LST)
c   XMWEM4(mxspec) - real       - Molecular weight for each species
c   IXREM4(mxspec) - integer    - Cross referencing array of NSE4
c                                 values relating species ordering
c                                 in the emissions file to the
c                                 ordering in the main conc. array
c   IBEG4(mxemdat) - integer    - Starting time for which emissions
c                                 data in current set of
c                                 records are valid (YYYYJJJHH)
c   IEND4(mxemdat) - integer    - Ending time for which emissions
c                                 data in current set of
c                                 records are valid (YYYYJJJHH)
c   XVL2GRD(mxvol) - real       - X coordinate of a volume
c                                 source in grid units
c                                 (i.e., origin at (0.0,0.0))
c   YVL2GRD(mxvol) - real       - Y coordinate of a volume
c                                 source in grid units
c                                 (i.e., origin at (0.0,0.0))
c     HTVL2(mxvol) - real       - Effective release height (m)
c     ELVL2(mxvol) - real       - Ground elevation (m) above sea
c                                 level
c    SY0VL2(mxvol) - real       - Initial sigma y (m)
c    SZ0VL2(mxvol) - real       - Initial sigma z (m)
c QVL2(mxspec,mxvol) - real     - Emission rate (g/s) for each
c                                 pollutant
c    NEWVL2(mxvol) - integer    - Number of puffs released by each
c                                 source during the current step
c
c ---  Character data ---
c           FNAME4 - char*12    - Data set name "VOLEMARB"
c  LABEL4(mxemdat) - char*12    - Data set label
c   CSLST4(mxspec) - char*12    - Species identifiers
c      CID4(mxvol) - char*16    - Source identifiers
c----------------------------------------------------------------------
c --- COMMON BLOCK /WAKEDAT/ -- Parameters used in the          CALPUFF
c                               PRIME wake and streamline
c                               subroutines
c----------------------------------------------------------------------
c
      logical lrurl
      common/WAKEDAT/Hb,Wb,xLb,Rb,HR,xLR,xLC,
     &               xbadj,ybadj,Ub,ubkps,Urh,
     &               nwak,xwak(mxrise),szwak(mxrise),sywak(mxrise),
     &               drwak(mxrise),xzvwak,xyvwak,
     &               ncav,xcav(mxrise),szcav(mxrise),sycav(mxrise),
     &               xzvcav,xyvcav,fqcav,cbyqcav,istab,lrurl
c
c --- COMMON BLOCK /WAKEDAT/ Variables:
c
c            HB - real    - Building height (m)
c            WB - real    - Building width (crosswind) - (m)
c           XLB - real    - Building length (alongwind) - (m)
c            RB - real    - Scale length (m)
c            HR - real    - Maximum cavity height (m) above ground
c           XLR - real    - Length of downwind cavity (m) from
c                           downwind face of building
c           XLC - real    - Length of roof cavity (m)
c         XBADJ - real    - Distance along the wind from the stack to
c                           the origin of the building (upwind center
c                           of effective building)
c         YBADJ - real    - Distance crosswind from the stack to
c                           the origin of the building (upwind center
c                           of effective building)
c            Ub - real    - Wind speed (m/s) at the height of bldg
c         ubkps - real    - Wind speed (km/s) used to relate distance
c                           and time when /WAKEDAT/ arrays are computed
c           Urh - real    - Wind speed (m/s) at release height
c
c          NWAK - integer - Number of downwind distances at which
c                           wake properties are tabulated (LE mxntr)
c  XWAK(mxrise) - real    - Downwind distance (m) from primary source
c SZWAK(mxrise) - real    - Sigma-z (m) at position XWAK, without BID
c SYWAK(mxrise) - real    - Sigma-y (m) at position XWAK, without BID
c DRWAK(mxrise) - real    - Plume growth rate at position XWAK expressed
c                           as d/dx(plume radius) for equivalent top-hat
c        XZVWAK - real    - Virtual distance increment (m) that produces
c                           the wake sigma-z at the end of the table
c                           when added to the distance from the source
c        XYVWAK - real    - Virtual distance increment (m) that produces
c                           the wake sigma-y at the end of the table
c                           when added to the distance from the source
c          NCAV - integer - Number of downwind distances at which
c                           wake properties of cavity source are
c                           tabulated (LE mxntr)
c  XCAV(mxrise) - real    - Downwind distance (m) from primary source
c SZCAV(mxrise) - real    - Sigma-z (m) for cavity source
c SYCAV(mxrise) - real    - Sigma-y (m) for cavity source
c        XZVCAV - real    - Virtual distance increment (m) that produces
c                           the cavity sigma-z at the end of the table
c                           when added to the distance from the source
c        XYVCAV - real    - Virtual distance increment (m) that produces
c                           the cavity sigma-y at the end of the table
c                           when added to the distance from the source
c         FQCAV - real    - Fraction of plume mass captured by cavity
c       CBYQCAV - real    - Chi/Q at centerline in the cavity
c         ISTAB - integer - PG stability class
c         LRURL - logical - Rural dispersion when .TRUE.
c----------------------------------------------------------------------
c --- COMMON BLOCK /WAKEDFSN/ -- Parameters used in the        CALPUFF
c                                PRIME turbulence and diffusion
c                                subroutines
c----------------------------------------------------------------------
c
      real rurliz(6),rurliy(6),urbniz(6),urbniy(6)
      common/WAKEDFSN/afac,xbyrmax,wiz0,wiy0,wfz,wfy,
     &                dua_ua,xdecay,xdecayi,
     &                rurliz,rurliy,urbniz,urbniy,
     &                ambiz,ambiy
c
c --- COMMON BLOCK /WAKEDFSN/ Variables:
c
c          AFAC - real    - Diffusion transitions to ambient (with
c                           virtual source) when wake turbulence decays
c                           to AFAC*(ambient turbulence intensity) for
c                           PG classes 4, 5, and 6
c       XBYRMAX - real    - Upper limit on distance from upwind face
c                           of bldg to transition point for ambient
c                           diffusion
c       WIZ,WIY - real    - Base Turbulence intensities in wake
c       WFZ,WFY - real    - Scaling factors for sigmaz and sigmay
c        DUA_UA - real    - [Ua-U]/Ua in wake at downwind face of bldg
c                                U: average speed in wake
c                               Ua: ambient speed
c         DECAY - real    - Exponent for turbulence intensity change
c                           with distance from downwind face of bldg
c        DECAYI - real    - 1/DECAY
c
c --- Ambient turbulence intensities inferred from Briggs (1973)
c --- "Diffusion estimation for small emissions", ATDL-106;
c     RURLIZ(6) - real    - Rural turbulence intensities in z
c     RURLIY(6) - real    - Rural turbulence intensities in y
c     URBNIZ(6) - real    - Urban turbulence intensities in z
c     URBNIY(6) - real    - Urban turbulence intensities in y
c
c --- Current ambient turbulence intensities
c         AMBIZ - real    - Turbulence intensity in z (vertical)
c         AMBIY - real    - Turbulence intensity in y (horizontal)
c----------------------------------------------------------------------
c --- COMMON BLOCK /WETDAT/ -- Wet deposition data              CALPUFF
c----------------------------------------------------------------------
c
      common/WETDAT/wa(2,mxspec)
c
c --- COMMON BLOCK /WETDAT/ Variables:
c
c         WA(2,mxspec) - real   - Array of scavenging coefficients
c                                 (1/sec) for each pollutant and
c                                 precipitation type
c                                 (1,-) = liquid precipitation
c                                 (2,-) = frozen precipitation
c----------------------------------------------------------------------
c --- COMMON BLOCK /WRKSPC/ -- Temporary work arrays            CALPUFF
c----------------------------------------------------------------------
c
      common/WRKSPC/tmp1(mxnx,mxny),nw1,tmp2(mxnx,mxny),nw2,
     1 tmp3(mxrec),tmp4(mxrec),tmp5(mxrect),tmp6(mxrect),
     2 tmp7(mxnxg,mxnyg),tmp8(mxnxg,mxnyg)
c
c --- COMMON BLOCK /WRKSPC/ Variables:
c
c       TMP1(mxnx,mxny) - real    - Work array number 1
c                   NW1 - integer - Length of work array TMP1
c                                   (in words)
c       TMP2(mxnx,mxny) - real    - Work array number 2
c                   NW2 - integer - Length of work array TMP2
c                                   (in words)
c           TMP3(mxrec) - real    - Work array number 3
c           TMP4(mxrec) - real    - Work array number 4
c          TMP5(mxrect) - real    - Work array number 5
c          TMP6(mxrect) - real    - Work array number 6
c     TMP7(mxnxg,mxnyg) - real    - Work array number 7
c     TMP8(mxnxg,mxnyg) - real    - Work array number 8
